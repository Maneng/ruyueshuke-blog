---
title: "è·¨å¢ƒç”µå•†é£æ§åˆè§„ä½“ç³»å…¨æ™¯è§£æï¼šä»å•†å“å‡†å…¥åˆ°åæ¬ºè¯ˆçš„æŠ€æœ¯å®æˆ˜"
date: 2025-10-21T14:00:00+08:00
draft: false
tags: ["è·¨å¢ƒç”µå•†", "é£æ§ç³»ç»Ÿ", "åˆè§„ç®¡ç†", "åæ¬ºè¯ˆ", "çŸ¥è¯†äº§æƒ"]
categories: ["æŠ€æœ¯"]
description: "æ·±åº¦å‰–æè·¨å¢ƒç”µå•†é£æ§åˆè§„ä½“ç³»ï¼šå•†å“ç¦é™å”®ç®¡ç†ã€çŸ¥è¯†äº§æƒä¿æŠ¤ã€äº¤æ˜“åæ¬ºè¯ˆã€ä¸ªäººé¢åº¦ç®¡æ§ã€æ•°æ®è·¨å¢ƒåˆè§„çš„å®Œæ•´æŠ€æœ¯å®ç°ï¼ŒåŒ…å«è§„åˆ™å¼•æ“ã€æœºå™¨å­¦ä¹ æ¨¡å‹ã€çŸ¥è¯†å›¾è°±ç­‰å…ˆè¿›æŠ€æœ¯ã€‚"
series: ["ä¾›åº”é“¾ç³»ç»Ÿå®æˆ˜"]
weight: 5
comments: true
---

## å¼•å­ï¼šä¸‰ä¸ªè®©å¹³å°æŸå¤±åƒä¸‡çš„åˆè§„äº‹æ•…

### äº‹æ•…1ï¼šç¦å”®å•†å“å¯¼è‡´çš„ä¸šåŠ¡åœæ‘†

2024å¹´3æœˆï¼ŒæŸè·¨å¢ƒç”µå•†å¹³å°å› ä¸Šæ¶é”€å”®**ç”µå­çƒŸ**ç±»å•†å“ï¼Œè¢«æµ·å…³åˆ—å…¥é‡ç‚¹ç›‘ç®¡åå•ï¼Œå¯¼è‡´ï¼š
- è¯¥å¹³å°æ‰€æœ‰ä¿ç¨ä»“æ¸…å…³æš‚åœ**7å¤©**
- **15ä¸‡ä¸ªè®¢å•**ç§¯å‹åœ¨æµ·å…³
- ç›´æ¥ç»æµæŸå¤±**3000ä¸‡å…ƒ**
- å“ç‰Œä¿¡èª‰ä¸¥é‡å—æŸ

**é—®é¢˜æ ¹æº**ï¼šå•†å“ä¸Šæ¶æ—¶ï¼Œæœªè¿›è¡Œç¦é™å”®å•†å“è‡ªåŠ¨æ£€æµ‹ï¼Œäººå·¥å®¡æ ¸ä¹Ÿæœªå‘ç°ã€‚

### äº‹æ•…2ï¼šå‡å†’å•†å“å¼•å‘çš„æ³•å¾‹çº çº·

2024å¹´6æœˆï¼ŒæŸå¹³å°å•†å®¶é”€å”®å‡å†’**LVåŒ…**ï¼Œè¢«å“ç‰Œæ–¹æŠ•è¯‰åï¼š
- å“ç‰Œæ–¹ç´¢èµ”**500ä¸‡å…ƒ**
- å¹³å°è¢«åˆ¤æ‰¿æ‹…**è¿å¸¦è´£ä»»**
- è¯¥å•†å®¶æ‰€æœ‰å•†å“è¢«ä¸‹æ¶
- å¹³å°éœ€èµ”å¿ç”¨æˆ·**3å€è´§æ¬¾**

**é—®é¢˜æ ¹æº**ï¼šç¼ºä¹å“ç‰ŒæˆæƒéªŒè¯æœºåˆ¶ï¼Œå•†å®¶ä¸Šä¼ å‡å†’æˆæƒä¹¦ä¹Ÿèƒ½é€šè¿‡å®¡æ ¸ã€‚

### äº‹æ•…3ï¼šåˆ·å•å¥—åˆ©å›¢ä¼™çš„è–…ç¾Šæ¯›

2024å¹´8æœˆï¼ŒæŸå¹³å°å‘ç°æœ‰ç»„ç»‡çš„åˆ·å•å›¢ä¼™ï¼š
- åˆ©ç”¨**æ–°äººä¼˜æƒ åˆ¸**æ— é™åˆ¶åˆ·å•
- è´­ä¹°ä½ä»·å•†å“åç«‹å³é€€è´§
- å¥—å–å¹³å°**è·¨å¢ƒç¨è´¹è¡¥è´´**
- 2ä¸ªæœˆç´¯è®¡æŸå¤±**800ä¸‡å…ƒ**

**é—®é¢˜æ ¹æº**ï¼šç¼ºä¹æœ‰æ•ˆçš„åæ¬ºè¯ˆæ¨¡å‹ï¼Œæœªèƒ½è¯†åˆ«å¼‚å¸¸äº¤æ˜“è¡Œä¸ºã€‚

---

è¿™ä¸‰ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œæš´éœ²äº†è·¨å¢ƒç”µå•†å¹³å°åœ¨**é£æ§åˆè§„**é¢†åŸŸçš„å·¨å¤§æŒ‘æˆ˜ã€‚

ä½œä¸ºä¸€ä¸ªä»ä¸š6å¹´çš„è·¨å¢ƒç”µå•†æŠ€æœ¯è´Ÿè´£äººï¼Œæˆ‘å°†åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œ**ç³»ç»ŸåŒ–åœ°å‰–æè·¨å¢ƒç”µå•†é£æ§åˆè§„ä½“ç³»çš„å®Œæ•´æŠ€æœ¯å®ç°**ï¼ŒåŒ…æ‹¬ï¼š
- å•†å“åˆè§„ç®¡ç†ï¼ˆç¦é™å”®æ£€æµ‹ã€èµ„è´¨å®¡æ ¸ï¼‰
- çŸ¥è¯†äº§æƒä¿æŠ¤ï¼ˆå“ç‰Œæˆæƒã€é˜²ä¼ªæº¯æºï¼‰
- äº¤æ˜“é£æ§ï¼ˆåæ¬ºè¯ˆã€ååˆ·å•ã€åå¥—åˆ©ï¼‰
- é¢åº¦ç®¡ç†ï¼ˆä¸ªäººå¹´åº¦26000é¢åº¦ç®¡æ§ï¼‰
- æ•°æ®åˆè§„ï¼ˆä¸ªäººä¿¡æ¯ä¿æŠ¤ã€è·¨å¢ƒæ•°æ®ä¼ è¾“ï¼‰

---

## ä¸€ã€å•†å“åˆè§„ç®¡ç†ï¼šç¬¬ä¸€é“é˜²çº¿

è·¨å¢ƒç”µå•†çš„å•†å“åˆè§„ï¼Œæ˜¯æ•´ä¸ªé£æ§ä½“ç³»çš„**ç¬¬ä¸€é“é˜²çº¿**ã€‚ä¸€æ—¦è¿è§„å•†å“æµå…¥å¹³å°ï¼Œåæœä¸å ªè®¾æƒ³ã€‚

### 1.1 ç¦é™å”®å•†å“ç®¡ç†

#### ç¦å”®å•†å“åˆ†ç±»

| ç±»åˆ« | å…¸å‹å•†å“ | æ³•å¾‹ä¾æ® |
|------|---------|---------|
| **å›½å®¶ç¦æ­¢è¿›å¢ƒ** | æªæ”¯å¼¹è¯ã€æ¯’å“ã€æ·«ç§½ç‰©å“ | ã€Šæµ·å…³æ³•ã€‹ |
| **çŸ¥è¯†äº§æƒä¾µæƒ** | å‡å†’å“ç‰Œã€ç›—ç‰ˆå›¾ä¹¦ | ã€Šå•†æ ‡æ³•ã€‹ã€Šè‘—ä½œæƒæ³•ã€‹ |
| **é£Ÿå“è¯å“** | æœªç»æ‰¹å‡†çš„ä¿å¥å“ã€å¤„æ–¹è¯ | ã€Šé£Ÿå“å®‰å…¨æ³•ã€‹ã€Šè¯å“ç®¡ç†æ³•ã€‹ |
| **æ¿’å±ç‰©ç§** | è±¡ç‰™åˆ¶å“ã€çŠ€ç‰›è§’ | ã€Šé‡ç”ŸåŠ¨ç‰©ä¿æŠ¤æ³•ã€‹ |
| **ç‰¹æ®Šç®¡åˆ¶** | ç”µå­çƒŸã€æ— äººæœº | å„åœ°æ–¹æ€§æ³•è§„ |

#### æŠ€æœ¯å®ç°ï¼šç¦å”®å•†å“æ£€æµ‹å¼•æ“

```java
/**
 * ç¦å”®å•†å“æ£€æµ‹å¼•æ“
 * æ ¸å¿ƒæŠ€æœ¯ï¼šè§„åˆ™å¼•æ“ + NLPè‡ªç„¶è¯­è¨€å¤„ç† + çŸ¥è¯†å›¾è°±
 */
@Service
@Slf4j
public class ProhibitedGoodsDetectionService {

    @Autowired
    private ProhibitedGoodsRepository prohibitedGoodsRepository;

    @Autowired
    private NlpService nlpService;

    @Autowired
    private KnowledgeGraphService knowledgeGraphService;

    /**
     * å•†å“ä¸Šæ¶å‰çš„åˆè§„æ£€æµ‹
     */
    public ComplianceCheckResult checkCompliance(Product product) {
        List<ComplianceViolation> violations = new ArrayList<>();

        // 1. å…³é”®è¯åŒ¹é…ï¼ˆå¿«é€Ÿç­›æŸ¥ï¼‰
        violations.addAll(checkByKeywords(product));

        // 2. è¯­ä¹‰åˆ†æï¼ˆè¯†åˆ«å˜ä½“è¯ã€è°éŸ³è¯ï¼‰
        violations.addAll(checkBySemantic(product));

        // 3. ç±»ç›®åŒ¹é…ï¼ˆæŸäº›ç±»ç›®æ•´ä½“ç¦å”®ï¼‰
        violations.addAll(checkByCategory(product));

        // 4. å“ç‰Œæˆæƒæ£€æŸ¥
        violations.addAll(checkBrandAuthorization(product));

        // 5. èµ„è´¨æ–‡ä»¶æ£€æŸ¥
        violations.addAll(checkQualifications(product));

        if (violations.isEmpty()) {
            return ComplianceCheckResult.passed();
        } else {
            return ComplianceCheckResult.failed(violations);
        }
    }

    /**
     * æ–¹æ³•1ï¼šå…³é”®è¯åŒ¹é…
     * æœ€åŸºç¡€çš„æ£€æµ‹æ–¹å¼ï¼Œä½†å®¹æ˜“è¢«ç»•è¿‡
     */
    private List<ComplianceViolation> checkByKeywords(Product product) {
        List<ComplianceViolation> violations = new ArrayList<>();

        // 1. åŠ è½½ç¦å”®å…³é”®è¯åº“
        List<String> prohibitedKeywords = prohibitedGoodsRepository.getAllKeywords();

        // 2. æ£€æŸ¥å•†å“æ ‡é¢˜
        String title = product.getName().toLowerCase();
        for (String keyword : prohibitedKeywords) {
            if (title.contains(keyword)) {
                violations.add(ComplianceViolation.builder()
                    .type("PROHIBITED_KEYWORD")
                    .severity("HIGH")
                    .description("å•†å“æ ‡é¢˜åŒ…å«ç¦å”®å…³é”®è¯ï¼š" + keyword)
                    .suggestion("è¯·ç§»é™¤å…³é”®è¯æˆ–ä¿®æ”¹å•†å“æè¿°")
                    .build());
            }
        }

        // 3. æ£€æŸ¥å•†å“æè¿°
        String description = product.getDescription().toLowerCase();
        for (String keyword : prohibitedKeywords) {
            if (description.contains(keyword)) {
                violations.add(ComplianceViolation.builder()
                    .type("PROHIBITED_KEYWORD")
                    .severity("HIGH")
                    .description("å•†å“æè¿°åŒ…å«ç¦å”®å…³é”®è¯ï¼š" + keyword)
                    .build());
            }
        }

        return violations;
    }

    /**
     * æ–¹æ³•2ï¼šè¯­ä¹‰åˆ†æï¼ˆè¯†åˆ«å˜ä½“è¯ã€è°éŸ³è¯ï¼‰
     * ä¾‹å¦‚ï¼š"ç”µå­çƒŸ" â†’ "ç”µå­yan"ã€"dianziyan"ã€"é›¾åŒ–å™¨"
     */
    private List<ComplianceViolation> checkBySemantic(Product product) {
        List<ComplianceViolation> violations = new ArrayList<>();

        // 1. ä½¿ç”¨NLPæå–å•†å“æ ¸å¿ƒæ¦‚å¿µ
        List<String> concepts = nlpService.extractConcepts(product.getName());

        // 2. åœ¨çŸ¥è¯†å›¾è°±ä¸­æŸ¥è¯¢ç›¸å…³ç¦å”®å•†å“
        for (String concept : concepts) {
            List<ProhibitedGoods> relatedProhibited = knowledgeGraphService
                .findRelatedProhibitedGoods(concept, 0.7);  // ç›¸ä¼¼åº¦é˜ˆå€¼70%

            for (ProhibitedGoods prohibited : relatedProhibited) {
                violations.add(ComplianceViolation.builder()
                    .type("SEMANTIC_PROHIBITED")
                    .severity("HIGH")
                    .description("å•†å“è¯­ä¹‰ä¸ç¦å”®å•†å“ç›¸å…³ï¼š" + prohibited.getName())
                    .similarity(prohibited.getSimilarity())
                    .build());
            }
        }

        return violations;
    }

    /**
     * æ–¹æ³•3ï¼šç±»ç›®åŒ¹é…
     * æŸäº›ç±»ç›®æ•´ä½“ç¦å”®
     */
    private List<ComplianceViolation> checkByCategory(Product product) {
        List<ComplianceViolation> violations = new ArrayList<>();

        // ç¦å”®ç±»ç›®
        Set<String> prohibitedCategories = Set.of(
            "ç”µå­çƒŸ",
            "å¤„æ–¹è¯",
            "æªæ”¯ä»¿çœŸå“",
            "æˆäººç”¨å“"
        );

        String category = product.getCategoryName();
        if (prohibitedCategories.contains(category)) {
            violations.add(ComplianceViolation.builder()
                .type("PROHIBITED_CATEGORY")
                .severity("CRITICAL")
                .description("è¯¥ç±»ç›®æ•´ä½“ç¦å”®ï¼š" + category)
                .suggestion("è¯·é€‰æ‹©å…¶ä»–ç±»ç›®")
                .build());
        }

        return violations;
    }

    /**
     * æ–¹æ³•4ï¼šå“ç‰Œæˆæƒæ£€æŸ¥
     */
    private List<ComplianceViolation> checkBrandAuthorization(Product product) {
        List<ComplianceViolation> violations = new ArrayList<>();

        // 1. åˆ¤æ–­æ˜¯å¦æ˜¯çŸ¥åå“ç‰Œ
        boolean isFamousBrand = brandService.isFamousBrand(product.getBrand());

        if (isFamousBrand) {
            // 2. æ£€æŸ¥å•†å®¶æ˜¯å¦æœ‰å“ç‰Œæˆæƒ
            boolean hasAuthorization = authorizationService.checkAuthorization(
                product.getMerchantId(),
                product.getBrand()
            );

            if (!hasAuthorization) {
                violations.add(ComplianceViolation.builder()
                    .type("NO_BRAND_AUTHORIZATION")
                    .severity("CRITICAL")
                    .description("é”€å”®çŸ¥åå“ç‰Œå•†å“éœ€è¦å“ç‰Œæˆæƒï¼š" + product.getBrand())
                    .suggestion("è¯·ä¸Šä¼ å“ç‰Œæˆæƒä¹¦")
                    .build());
            }
        }

        return violations;
    }

    /**
     * æ–¹æ³•5ï¼šèµ„è´¨æ–‡ä»¶æ£€æŸ¥
     * ç‰¹æ®Šå•†å“éœ€è¦ç‰¹æ®Šèµ„è´¨ï¼ˆå¦‚é£Ÿå“ç»è¥è®¸å¯è¯ï¼‰
     */
    private List<ComplianceViolation> checkQualifications(Product product) {
        List<ComplianceViolation> violations = new ArrayList<>();

        // éœ€è¦ç‰¹æ®Šèµ„è´¨çš„ç±»ç›®
        Map<String, String> requiredQualifications = Map.of(
            "é£Ÿå“", "é£Ÿå“ç»è¥è®¸å¯è¯",
            "ä¿å¥å“", "ä¿å¥é£Ÿå“æ‰¹å‡†è¯ä¹¦",
            "åŒ–å¦†å“", "åŒ–å¦†å“ç”Ÿäº§è®¸å¯è¯",
            "åŒ»ç–—å™¨æ¢°", "åŒ»ç–—å™¨æ¢°ç»è¥è®¸å¯è¯"
        );

        String category = product.getCategoryName();
        String requiredQualification = requiredQualifications.get(category);

        if (requiredQualification != null) {
            // æ£€æŸ¥å•†å®¶æ˜¯å¦ä¸Šä¼ äº†èµ„è´¨æ–‡ä»¶
            boolean hasQualification = qualificationService.checkQualification(
                product.getMerchantId(),
                requiredQualification
            );

            if (!hasQualification) {
                violations.add(ComplianceViolation.builder()
                    .type("MISSING_QUALIFICATION")
                    .severity("HIGH")
                    .description("è¯¥ç±»ç›®å•†å“éœ€è¦èµ„è´¨ï¼š" + requiredQualification)
                    .suggestion("è¯·ä¸Šä¼ ç›¸å…³èµ„è´¨è¯æ˜æ–‡ä»¶")
                    .build());
            }
        }

        return violations;
    }
}
```

#### ç¦å”®å…³é”®è¯åº“ç®¡ç†

```java
/**
 * ç¦å”®å…³é”®è¯åº“ç®¡ç†
 * æ”¯æŒåŠ¨æ€æ›´æ–°ã€ç‰ˆæœ¬ç®¡ç†ã€å˜ä½“è¯ç®¡ç†
 */
@Service
public class ProhibitedKeywordLibraryService {

    /**
     * ç¦å”®å…³é”®è¯æ•°æ®ç»“æ„
     */
    @Data
    @Builder
    public static class ProhibitedKeyword {
        private String keyword;              // å…³é”®è¯
        private List<String> variants;       // å˜ä½“è¯ï¼ˆè°éŸ³ã€æ‹†å­—ï¼‰
        private String category;             // ç±»åˆ«
        private String severity;             // ä¸¥é‡ç¨‹åº¦
        private String legalBasis;           // æ³•å¾‹ä¾æ®
        private LocalDate effectiveDate;     // ç”Ÿæ•ˆæ—¥æœŸ
    }

    /**
     * åˆå§‹åŒ–ç¦å”®å…³é”®è¯åº“
     */
    @PostConstruct
    public void initKeywordLibrary() {
        List<ProhibitedKeyword> keywords = Arrays.asList(
            // æ¯’å“ç±»
            ProhibitedKeyword.builder()
                .keyword("å¤§éº»")
                .variants(Arrays.asList("hemp", "cannabis", "da ma", "å¤§ğŸŒ¿"))
                .category("DRUGS")
                .severity("CRITICAL")
                .legalBasis("ã€Šåˆ‘æ³•ã€‹ç¬¬347æ¡")
                .effectiveDate(LocalDate.of(2020, 1, 1))
                .build(),

            // çƒŸè‰ç±»
            ProhibitedKeyword.builder()
                .keyword("ç”µå­çƒŸ")
                .variants(Arrays.asList("é›¾åŒ–å™¨", "å°çƒŸ", "ç”µå­yan", "vape"))
                .category("TOBACCO")
                .severity("HIGH")
                .legalBasis("ã€Šç”µå­çƒŸç®¡ç†åŠæ³•ã€‹")
                .effectiveDate(LocalDate.of(2022, 5, 1))
                .build(),

            // æ­¦å™¨ç±»
            ProhibitedKeyword.builder()
                .keyword("ä»¿çœŸæª")
                .variants(Arrays.asList("ç©å…·æª", "bbå¼¹æª", "è½¯å¼¹æª"))
                .category("WEAPONS")
                .severity("CRITICAL")
                .legalBasis("ã€Šæªæ”¯ç®¡ç†æ³•ã€‹")
                .effectiveDate(LocalDate.of(2019, 1, 1))
                .build()
        );

        // ä¿å­˜åˆ°Redisï¼ˆæ”¯æŒå¿«é€ŸæŸ¥è¯¢ï¼‰
        for (ProhibitedKeyword keyword : keywords) {
            redisTemplate.opsForHash().put(
                "prohibited_keywords",
                keyword.getKeyword(),
                keyword
            );

            // å»ºç«‹å˜ä½“è¯ç´¢å¼•
            for (String variant : keyword.getVariants()) {
                redisTemplate.opsForHash().put(
                    "prohibited_keywords",
                    variant,
                    keyword
                );
            }
        }
    }

    /**
     * å®šæ—¶æ›´æ–°å…³é”®è¯åº“ï¼ˆä»ç›‘ç®¡éƒ¨é—¨APIåŒæ­¥ï¼‰
     */
    @Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©å‡Œæ™¨2ç‚¹æ›´æ–°
    public void syncKeywordLibrary() {
        // 1. è°ƒç”¨ç›‘ç®¡éƒ¨é—¨API
        List<ProhibitedKeyword> latestKeywords = regulatoryApiClient.getProhibitedKeywords();

        // 2. å¯¹æ¯”æœ¬åœ°åº“ï¼Œæ‰¾å‡ºæ–°å¢å…³é”®è¯
        List<ProhibitedKeyword> newKeywords = findNewKeywords(latestKeywords);

        // 3. æ›´æ–°å…³é”®è¯åº“
        for (ProhibitedKeyword keyword : newKeywords) {
            saveKeyword(keyword);
            log.info("æ–°å¢ç¦å”®å…³é”®è¯ï¼š{}", keyword.getKeyword());

            // 4. è§¦å‘å…¨é‡å•†å“é‡æ–°æ£€æµ‹
            triggerFullScan(keyword);
        }
    }

    /**
     * è§¦å‘å…¨é‡å•†å“é‡æ–°æ£€æµ‹
     * å½“æ–°å¢ç¦å”®å…³é”®è¯æ—¶ï¼Œéœ€è¦é‡æ–°æ£€æµ‹å·²ä¸Šæ¶å•†å“
     */
    private void triggerFullScan(ProhibitedKeyword keyword) {
        // 1. æŸ¥è¯¢æ‰€æœ‰åœ¨å”®å•†å“
        List<Product> products = productRepository.findByStatus("ONLINE");

        // 2. å¼‚æ­¥æ£€æµ‹
        for (Product product : products) {
            CompletableFuture.runAsync(() -> {
                ComplianceCheckResult result = checkCompliance(product);

                if (!result.isPassed()) {
                    // 3. å‘ç°è¿è§„å•†å“ï¼Œè‡ªåŠ¨ä¸‹æ¶
                    product.setStatus("OFFLINE");
                    product.setOfflineReason("åŒ…å«æ–°å¢ç¦å”®å…³é”®è¯ï¼š" + keyword.getKeyword());
                    productRepository.save(product);

                    // 4. é€šçŸ¥å•†å®¶
                    notificationService.sendComplianceWarning(product);
                }
            });
        }
    }
}
```

---

## äºŒã€çŸ¥è¯†äº§æƒä¿æŠ¤ï¼šå“ç‰Œæˆæƒä¸é˜²ä¼ªæº¯æº

çŸ¥è¯†äº§æƒä¿æŠ¤æ˜¯è·¨å¢ƒç”µå•†åˆè§„çš„**é‡ä¸­ä¹‹é‡**ã€‚å“ç‰Œæ–¹å¯¹å‡å†’å•†å“é›¶å®¹å¿ï¼Œå¹³å°éœ€è¦å»ºç«‹å®Œå–„çš„çŸ¥è¯†äº§æƒä¿æŠ¤ä½“ç³»ã€‚

### 2.1 å“ç‰Œæˆæƒç®¡ç†ç³»ç»Ÿ

```java
/**
 * å“ç‰Œæˆæƒç®¡ç†ç³»ç»Ÿ
 * æ ¸å¿ƒåŠŸèƒ½ï¼šæˆæƒä¹¦ä¸Šä¼ ã€OCRè¯†åˆ«ã€çœŸä¼ªéªŒè¯ã€æœ‰æ•ˆæœŸç®¡ç†
 */
@Service
public class BrandAuthorizationService {

    @Autowired
    private OcrService ocrService;

    @Autowired
    private BlockchainService blockchainService;

    /**
     * å•†å®¶ä¸Šä¼ å“ç‰Œæˆæƒä¹¦
     */
    @Transactional
    public AuthorizationResult uploadAuthorization(
        Long merchantId,
        String brandName,
        MultipartFile authorizationFile
    ) {
        // 1. OCRè¯†åˆ«æˆæƒä¹¦å†…å®¹
        AuthorizationInfo info = ocrService.recognizeAuthorization(authorizationFile);

        // 2. éªŒè¯æˆæƒä¹¦çœŸä¼ª
        boolean isValid = verifyAuthorization(info);

        if (!isValid) {
            return AuthorizationResult.failed("æˆæƒä¹¦éªŒè¯å¤±è´¥ï¼Œè¯·ä¸Šä¼ çœŸå®æœ‰æ•ˆçš„æˆæƒä¹¦");
        }

        // 3. ä¿å­˜æˆæƒè®°å½•
        BrandAuthorization authorization = BrandAuthorization.builder()
            .merchantId(merchantId)
            .brandName(brandName)
            .authorizationNo(info.getAuthorizationNo())
            .issuer(info.getIssuer())              // æˆæƒæ–¹
            .licensee(info.getLicensee())          // è¢«æˆæƒæ–¹
            .startDate(info.getStartDate())
            .endDate(info.getEndDate())
            .scope(info.getScope())                // æˆæƒèŒƒå›´
            .status("VALID")
            .build();
        authorizationRepository.save(authorization);

        // 4. å°†æˆæƒè®°å½•ä¸Šé“¾ï¼ˆé˜²ç¯¡æ”¹ï¼‰
        String txHash = blockchainService.recordAuthorization(authorization);
        authorization.setBlockchainTxHash(txHash);
        authorizationRepository.save(authorization);

        // 5. å®šæ—¶æ£€æŸ¥æˆæƒæœ‰æ•ˆæœŸ
        scheduleExpirationCheck(authorization);

        return AuthorizationResult.success(authorization);
    }

    /**
     * éªŒè¯æˆæƒä¹¦çœŸä¼ª
     * æ–¹æ³•1ï¼šå“ç‰Œæ–¹å®˜ç½‘éªŒè¯æ¥å£
     * æ–¹æ³•2ï¼šåŒºå—é“¾éªŒè¯ï¼ˆå“ç‰Œæ–¹é¢„å…ˆå°†æˆæƒä¹¦ä¸Šé“¾ï¼‰
     */
    private boolean verifyAuthorization(AuthorizationInfo info) {
        // 1. è°ƒç”¨å“ç‰Œæ–¹å®˜ç½‘éªŒè¯æ¥å£
        boolean verifiedByBrand = brandApiClient.verifyAuthorization(
            info.getBrandName(),
            info.getAuthorizationNo()
        );

        if (verifiedByBrand) {
            return true;
        }

        // 2. ä»åŒºå—é“¾éªŒè¯
        boolean verifiedByBlockchain = blockchainService.verifyAuthorization(
            info.getAuthorizationNo()
        );

        return verifiedByBlockchain;
    }

    /**
     * å®šæ—¶æ£€æŸ¥æˆæƒæœ‰æ•ˆæœŸ
     */
    @Scheduled(cron = "0 0 1 * * ?")  // æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
    public void checkExpirations() {
        // 1. æŸ¥è¯¢å³å°†è¿‡æœŸçš„æˆæƒï¼ˆ30å¤©å†…ï¼‰
        LocalDate thirtyDaysLater = LocalDate.now().plusDays(30);
        List<BrandAuthorization> expiringAuthorizations = authorizationRepository
            .findByEndDateBefore(thirtyDaysLater);

        for (BrandAuthorization auth : expiringAuthorizations) {
            // 2. æé†’å•†å®¶ç»­æœŸ
            notificationService.sendExpirationWarning(auth);

            // 3. å·²è¿‡æœŸçš„æˆæƒï¼Œè‡ªåŠ¨å¤±æ•ˆ
            if (auth.getEndDate().isBefore(LocalDate.now())) {
                auth.setStatus("EXPIRED");
                authorizationRepository.save(auth);

                // 4. ä¸‹æ¶è¯¥å•†å®¶å¯¹åº”å“ç‰Œçš„æ‰€æœ‰å•†å“
                offlineBrandProducts(auth.getMerchantId(), auth.getBrandName());
            }
        }
    }

    /**
     * ä¸‹æ¶å•†å®¶å“ç‰Œå•†å“
     */
    private void offlineBrandProducts(Long merchantId, String brandName) {
        List<Product> products = productRepository.findByMerchantIdAndBrand(
            merchantId,
            brandName
        );

        for (Product product : products) {
            product.setStatus("OFFLINE");
            product.setOfflineReason("å“ç‰Œæˆæƒå·²è¿‡æœŸ");
            productRepository.save(product);
        }

        // é€šçŸ¥å•†å®¶
        notificationService.sendBrandAuthorizationExpired(merchantId, brandName);
    }
}
```

### 2.2 é˜²ä¼ªæº¯æºç³»ç»Ÿ

```java
/**
 * é˜²ä¼ªæº¯æºç³»ç»Ÿ
 * æŠ€æœ¯æ–¹æ¡ˆï¼šåŒºå—é“¾ + ç‰©è”ç½‘ + äºŒç»´ç 
 */
@Service
public class AntiCounterfeitingService {

    @Autowired
    private BlockchainService blockchainService;

    /**
     * å•†å“ç”Ÿäº§æ—¶ï¼Œç”Ÿæˆé˜²ä¼ªç 
     */
    public AntiFakeCode generateAntiFakeCode(Product product) {
        // 1. ç”Ÿæˆå”¯ä¸€é˜²ä¼ªç ï¼ˆUUID + åŠ å¯†ï¼‰
        String antiFakeCode = generateUniqueCode(product);

        // 2. è®°å½•å•†å“å…¨é“¾è·¯ä¿¡æ¯
        ProductTraceInfo traceInfo = ProductTraceInfo.builder()
            .antiFakeCode(antiFakeCode)
            .productId(product.getId())
            .productName(product.getName())
            .brand(product.getBrand())
            .manufacturer(product.getManufacturer())
            .productionDate(product.getProductionDate())
            .batchNo(product.getBatchNo())
            .build();

        // 3. ä¸Šé“¾ï¼ˆä¸å¯ç¯¡æ”¹ï¼‰
        String txHash = blockchainService.recordTraceInfo(traceInfo);
        traceInfo.setBlockchainTxHash(txHash);

        // 4. ç”ŸæˆäºŒç»´ç 
        byte[] qrCode = qrCodeService.generate(antiFakeCode);

        // 5. ä¿å­˜é˜²ä¼ªç 
        AntiFakeCode code = AntiFakeCode.builder()
            .code(antiFakeCode)
            .productId(product.getId())
            .qrCode(qrCode)
            .blockchainTxHash(txHash)
            .status("ACTIVE")
            .build();
        antiFakeCodeRepository.save(code);

        return code;
    }

    /**
     * ç”¨æˆ·æ‰«ç éªŒè¯çœŸä¼ª
     */
    public VerificationResult verifyProduct(String antiFakeCode) {
        // 1. ä»åŒºå—é“¾æŸ¥è¯¢å•†å“ä¿¡æ¯
        ProductTraceInfo traceInfo = blockchainService.queryTraceInfo(antiFakeCode);

        if (traceInfo == null) {
            return VerificationResult.fake("è¯¥é˜²ä¼ªç ä¸å­˜åœ¨ï¼Œå•†å“å¯èƒ½æ˜¯å‡å†’å“");
        }

        // 2. æ£€æŸ¥é˜²ä¼ªç æ˜¯å¦å·²è¢«æŸ¥è¯¢è¿‡å¤šæ¬¡ï¼ˆå¯èƒ½æ˜¯å¤åˆ¶çš„å‡ç ï¼‰
        int queryCount = incrementQueryCount(antiFakeCode);

        if (queryCount > 10) {
            return VerificationResult.warning(
                "è¯¥é˜²ä¼ªç å·²è¢«æŸ¥è¯¢" + queryCount + "æ¬¡ï¼Œè¯·è­¦æƒ•å‡å†’å•†å“"
            );
        }

        // 3. è¿”å›å•†å“å…¨é“¾è·¯ä¿¡æ¯
        return VerificationResult.genuine(traceInfo);
    }

    /**
     * è®°å½•ç‰©æµè½¨è¿¹åˆ°åŒºå—é“¾
     */
    public void recordLogisticsTrace(String antiFakeCode, LogisticsEvent event) {
        // 1. æ„å»ºç‰©æµäº‹ä»¶
        LogisticsTraceInfo trace = LogisticsTraceInfo.builder()
            .antiFakeCode(antiFakeCode)
            .eventType(event.getType())          // æ½æ”¶ã€è¿è¾“ã€ç­¾æ”¶
            .location(event.getLocation())
            .operator(event.getOperator())
            .timestamp(event.getTimestamp())
            .build();

        // 2. ä¸Šé“¾
        blockchainService.recordLogisticsTrace(trace);

        // 3. ç”¨æˆ·æ‰«ç æ—¶å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ç‰©æµè½¨è¿¹
    }
}
```

---

## ä¸‰ã€äº¤æ˜“é£æ§ï¼šåæ¬ºè¯ˆã€ååˆ·å•ã€åå¥—åˆ©

äº¤æ˜“é£æ§æ˜¯ä¿æŠ¤å¹³å°åˆ©ç›Šçš„æ ¸å¿ƒç³»ç»Ÿï¼Œéœ€è¦è¯†åˆ«å„ç§æ¬ºè¯ˆè¡Œä¸ºã€‚

### 3.1 åæ¬ºè¯ˆè§„åˆ™å¼•æ“

```java
/**
 * åæ¬ºè¯ˆè§„åˆ™å¼•æ“
 * æŠ€æœ¯æ–¹æ¡ˆï¼šDroolsè§„åˆ™å¼•æ“ + æœºå™¨å­¦ä¹ æ¨¡å‹
 */
@Service
public class AntiFraudService {

    @Autowired
    private KieContainer kieContainer;

    @Autowired
    private MachineLearningModelService mlService;

    /**
     * è®¢å•é£é™©è¯„ä¼°
     */
    public RiskAssessmentResult assessOrderRisk(Order order) {
        // 1. è§„åˆ™å¼•æ“è¯„åˆ†
        int ruleScore = evaluateByRules(order);

        // 2. æœºå™¨å­¦ä¹ æ¨¡å‹è¯„åˆ†
        double mlScore = mlService.predictFraudProbability(order);

        // 3. ç»¼åˆè¯„åˆ†
        double finalScore = ruleScore * 0.4 + mlScore * 0.6;

        // 4. é£é™©ç­‰çº§åˆ¤å®š
        RiskLevel riskLevel = determineRiskLevel(finalScore);

        // 5. é£æ§å†³ç­–
        return makeDecision(order, riskLevel, finalScore);
    }

    /**
     * è§„åˆ™å¼•æ“è¯„ä¼°
     */
    private int evaluateByRules(Order order) {
        KieSession kieSession = kieContainer.newKieSession();

        // 1. è®¾ç½®å…¨å±€å˜é‡
        kieSession.setGlobal("riskScore", new AtomicInteger(0));

        // 2. æ’å…¥äº‹å®å¯¹è±¡
        kieSession.insert(order);
        kieSession.insert(order.getUser());
        kieSession.insert(order.getPayment());

        // 3. æ‰§è¡Œè§„åˆ™
        kieSession.fireAllRules();

        // 4. è·å–é£é™©åˆ†æ•°
        AtomicInteger riskScore = (AtomicInteger) kieSession.getGlobal("riskScore");

        kieSession.dispose();

        return riskScore.get();
    }

    /**
     * é£æ§å†³ç­–
     */
    private RiskAssessmentResult makeDecision(Order order, RiskLevel riskLevel, double score) {
        switch (riskLevel) {
            case LOW:
                // ä½é£é™©ï¼šç›´æ¥æ”¾è¡Œ
                return RiskAssessmentResult.pass(order);

            case MEDIUM:
                // ä¸­é£é™©ï¼šäººå·¥å®¡æ ¸
                return RiskAssessmentResult.review(order, "è®¢å•é£é™©åˆ†æ•°ï¼š" + score);

            case HIGH:
                // é«˜é£é™©ï¼šæ‹’ç»äº¤æ˜“
                return RiskAssessmentResult.reject(order, "è®¢å•å­˜åœ¨æ¬ºè¯ˆé£é™©");

            default:
                return RiskAssessmentResult.review(order, "æœªçŸ¥é£é™©ç­‰çº§");
        }
    }
}
```

#### Droolsè§„åˆ™å®šä¹‰

```java
// fraud-detection-rules.drl
package com.crossborder.risk

import com.crossborder.model.Order
import com.crossborder.model.User
import java.util.concurrent.atomic.AtomicInteger

global AtomicInteger riskScore

// è§„åˆ™1ï¼šæ–°æ³¨å†Œç”¨æˆ·é¦–å•é«˜ä»·å€¼
rule "New User High Value Order"
when
    $order: Order(totalAmount > 1000)
    $user: User(registerDays < 3)
then
    riskScore.addAndGet(30);
    System.out.println("è§¦å‘è§„åˆ™ï¼šæ–°ç”¨æˆ·é«˜ä»·å€¼è®¢å•");
end

// è§„åˆ™2ï¼šçŸ­æ—¶é—´å†…å¤šæ¬¡ä¸‹å•
rule "Frequent Orders"
when
    $user: User()
    $count: Number(intValue > 5) from accumulate(
        $o: Order(userId == $user.getId(), createTime > "1 hour ago"),
        count($o)
    )
then
    riskScore.addAndGet(40);
    System.out.println("è§¦å‘è§„åˆ™ï¼š1å°æ—¶å†…ä¸‹å•" + $count + "æ¬¡");
end

// è§„åˆ™3ï¼šæ”¶è´§åœ°å€å¼‚å¸¸
rule "Abnormal Shipping Address"
when
    $order: Order()
    eval(isAbnormalAddress($order.getAddress()))
then
    riskScore.addAndGet(25);
    System.out.println("è§¦å‘è§„åˆ™ï¼šæ”¶è´§åœ°å€å¼‚å¸¸");
end

// è§„åˆ™4ï¼šæ”¯ä»˜è´¦æˆ·ä¸æ”¶è´§äººä¸ä¸€è‡´
rule "Payer Not Match Receiver"
when
    $order: Order()
    $payment: Payment(payerName != $order.getConsignee())
then
    riskScore.addAndGet(20);
    System.out.println("è§¦å‘è§„åˆ™ï¼šæ”¯ä»˜äººä¸æ”¶è´§äººä¸ä¸€è‡´");
end

// è§„åˆ™5ï¼šä½¿ç”¨å¤šä¸ªä¼˜æƒ åˆ¸
rule "Multiple Coupons"
when
    $order: Order(coupons.size() > 3)
then
    riskScore.addAndGet(15);
    System.out.println("è§¦å‘è§„åˆ™ï¼šä½¿ç”¨" + $order.getCoupons().size() + "å¼ ä¼˜æƒ åˆ¸");
end
```

### 3.2 æœºå™¨å­¦ä¹ åæ¬ºè¯ˆæ¨¡å‹

```java
/**
 * æœºå™¨å­¦ä¹ åæ¬ºè¯ˆæ¨¡å‹
 * ç®—æ³•ï¼šXGBooståˆ†ç±»æ¨¡å‹
 */
@Service
public class MachineLearningModelService {

    @Autowired
    private XGBoostModel model;

    /**
     * é¢„æµ‹è®¢å•æ¬ºè¯ˆæ¦‚ç‡
     */
    public double predictFraudProbability(Order order) {
        // 1. ç‰¹å¾å·¥ç¨‹ï¼ˆæå–40+ä¸ªç‰¹å¾ï¼‰
        Map<String, Object> features = extractFeatures(order);

        // 2. è°ƒç”¨æ¨¡å‹é¢„æµ‹
        double probability = model.predict(features);

        return probability;
    }

    /**
     * ç‰¹å¾æå–ï¼ˆ40+ä¸ªç‰¹å¾ï¼‰
     */
    private Map<String, Object> extractFeatures(Order order) {
        Map<String, Object> features = new HashMap<>();

        // ç”¨æˆ·ç»´åº¦ç‰¹å¾
        User user = order.getUser();
        features.put("user_register_days", user.getRegisterDays());
        features.put("user_total_orders", user.getTotalOrders());
        features.put("user_total_amount", user.getTotalAmount());
        features.put("user_avg_order_amount", user.getAvgOrderAmount());
        features.put("user_refund_rate", user.getRefundRate());
        features.put("user_complaint_count", user.getComplaintCount());

        // è®¢å•ç»´åº¦ç‰¹å¾
        features.put("order_amount", order.getTotalAmount());
        features.put("order_item_count", order.getItems().size());
        features.put("order_discount_amount", order.getDiscountAmount());
        features.put("order_discount_rate", order.getDiscountRate());
        features.put("order_hour", order.getCreateTime().getHour());
        features.put("order_day_of_week", order.getCreateTime().getDayOfWeek().getValue());

        // æ”¯ä»˜ç»´åº¦ç‰¹å¾
        Payment payment = order.getPayment();
        features.put("payment_type", payment.getPayType());
        features.put("payment_delay_seconds", payment.getPayDelaySeconds());

        // åœ°å€ç»´åº¦ç‰¹å¾
        features.put("address_changed", order.isAddressChanged());
        features.put("address_province", order.getProvince());
        features.put("address_risk_score", addressRiskService.getScore(order.getAddress()));

        // è®¾å¤‡ç»´åº¦ç‰¹å¾
        features.put("device_id", order.getDeviceId());
        features.put("device_type", order.getDeviceType());
        features.put("ip_address", order.getIpAddress());
        features.put("ip_risk_score", ipRiskService.getScore(order.getIpAddress()));

        // è¡Œä¸ºç»´åº¦ç‰¹å¾
        features.put("browse_duration", order.getBrowseDuration());
        features.put("page_view_count", order.getPageViewCount());
        features.put("cart_add_count", order.getCartAddCount());

        return features;
    }

    /**
     * æ¨¡å‹è®­ç»ƒï¼ˆç¦»çº¿ä»»åŠ¡ï¼‰
     */
    @Scheduled(cron = "0 0 3 * * ?")  // æ¯å¤©å‡Œæ™¨3ç‚¹è®­ç»ƒ
    public void trainModel() {
        // 1. ä»æ•°æ®ä»“åº“åŠ è½½è®­ç»ƒæ•°æ®
        List<OrderSample> samples = dataWarehouseService.loadTrainingSamples(
            LocalDate.now().minusDays(30),  // æœ€è¿‘30å¤©æ•°æ®
            LocalDate.now()
        );

        // 2. æ•°æ®é¢„å¤„ç†
        Dataset dataset = preprocessData(samples);

        // 3. è®­ç»ƒæ¨¡å‹
        XGBoostModel newModel = XGBoostTrainer.train(dataset);

        // 4. æ¨¡å‹è¯„ä¼°
        ModelEvaluationResult evaluation = evaluateModel(newModel, dataset);

        // 5. å¦‚æœæ–°æ¨¡å‹æ•ˆæœæ›´å¥½ï¼Œæ›¿æ¢æ—§æ¨¡å‹
        if (evaluation.getAuc() > 0.85) {
            this.model = newModel;
            log.info("æ¨¡å‹æ›´æ–°æˆåŠŸï¼ŒAUCï¼š{}", evaluation.getAuc());
        }
    }
}
```

### 3.3 åˆ·å•è¯†åˆ«ç³»ç»Ÿ

```java
/**
 * åˆ·å•è¯†åˆ«ç³»ç»Ÿ
 * æ ¸å¿ƒé€»è¾‘ï¼šè¯†åˆ«è™šå‡äº¤æ˜“ã€åˆ·å¥½è¯„ã€åˆ·é”€é‡
 */
@Service
public class OrderFraudDetectionService {

    /**
     * è¯†åˆ«åˆ·å•è¡Œä¸º
     */
    public boolean isOrderFraud(Order order) {
        // 1. æ£€æŸ¥è®¾å¤‡æŒ‡çº¹ï¼ˆåŒä¸€è®¾å¤‡å¤šä¸ªè´¦å·ä¸‹å•ï¼‰
        if (checkDeviceFingerprint(order)) {
            return true;
        }

        // 2. æ£€æŸ¥æ”¶è´§åœ°å€ï¼ˆå¤šä¸ªè®¢å•åŒä¸€åœ°å€ï¼‰
        if (checkShippingAddress(order)) {
            return true;
        }

        // 3. æ£€æŸ¥æ”¯ä»˜è´¦æˆ·ï¼ˆåŒä¸€æ”¯ä»˜è´¦æˆ·å¤šç¬”è®¢å•ï¼‰
        if (checkPaymentAccount(order)) {
            return true;
        }

        // 4. æ£€æŸ¥è¡Œä¸ºæ¨¡å¼ï¼ˆä¸‹å•åç«‹å³å¥½è¯„ï¼‰
        if (checkBehaviorPattern(order)) {
            return true;
        }

        return false;
    }

    /**
     * æ£€æŸ¥è®¾å¤‡æŒ‡çº¹
     */
    private boolean checkDeviceFingerprint(Order order) {
        String deviceId = order.getDeviceId();

        // æŸ¥è¯¢è¯¥è®¾å¤‡æœ€è¿‘24å°æ—¶çš„è®¢å•æ•°
        long orderCount = orderRepository.countByDeviceIdAndCreateTimeAfter(
            deviceId,
            LocalDateTime.now().minusHours(24)
        );

        // åŒä¸€è®¾å¤‡24å°æ—¶å†…ä¸‹å•è¶…è¿‡10æ¬¡ï¼Œç–‘ä¼¼åˆ·å•
        if (orderCount > 10) {
            log.warn("è®¾å¤‡æŒ‡çº¹å¼‚å¸¸ï¼šè®¾å¤‡{}åœ¨24å°æ—¶å†…ä¸‹å•{}æ¬¡", deviceId, orderCount);
            return true;
        }

        // æŸ¥è¯¢è¯¥è®¾å¤‡å…³è”çš„è´¦å·æ•°
        long userCount = orderRepository.countDistinctUserByDeviceId(deviceId);

        // åŒä¸€è®¾å¤‡å…³è”è¶…è¿‡5ä¸ªè´¦å·ï¼Œç–‘ä¼¼åˆ·å•
        if (userCount > 5) {
            log.warn("è®¾å¤‡æŒ‡çº¹å¼‚å¸¸ï¼šè®¾å¤‡{}å…³è”{}ä¸ªè´¦å·", deviceId, userCount);
            return true;
        }

        return false;
    }

    /**
     * æ£€æŸ¥æ”¶è´§åœ°å€
     */
    private boolean checkShippingAddress(Order order) {
        String address = order.getAddress();

        // æŸ¥è¯¢è¯¥åœ°å€æœ€è¿‘7å¤©çš„è®¢å•æ•°
        long orderCount = orderRepository.countByAddressAndCreateTimeAfter(
            address,
            LocalDateTime.now().minusDays(7)
        );

        // åŒä¸€åœ°å€7å¤©å†…æ”¶è´§è¶…è¿‡20æ¬¡ï¼Œç–‘ä¼¼åˆ·å•
        if (orderCount > 20) {
            log.warn("æ”¶è´§åœ°å€å¼‚å¸¸ï¼šåœ°å€{}åœ¨7å¤©å†…æ”¶è´§{}æ¬¡", address, orderCount);
            return true;
        }

        return false;
    }

    /**
     * æ£€æŸ¥è¡Œä¸ºæ¨¡å¼ï¼ˆå›¾ç®—æ³•ï¼‰
     */
    private boolean checkBehaviorPattern(Order order) {
        // æ„å»ºå…³ç³»å›¾è°±
        // èŠ‚ç‚¹ï¼šç”¨æˆ·ã€è®¾å¤‡ã€åœ°å€ã€æ”¯ä»˜è´¦æˆ·
        // è¾¹ï¼šä¸‹å•å…³ç³»

        Graph graph = buildOrderGraph(order);

        // æ£€æµ‹ç¤¾åŒºï¼ˆåˆ·å•å›¢ä¼™ï¼‰
        List<Community> communities = graphService.detectCommunities(graph);

        for (Community community : communities) {
            // å¦‚æœè¯¥è®¢å•æ‰€å±ç¤¾åŒºçš„å¯†åº¦è¿‡é«˜ï¼Œç–‘ä¼¼åˆ·å•å›¢ä¼™
            if (community.getDensity() > 0.8 && community.getSize() > 10) {
                log.warn("æ£€æµ‹åˆ°åˆ·å•å›¢ä¼™ï¼šç¤¾åŒºè§„æ¨¡{}ï¼Œå¯†åº¦{}",
                    community.getSize(), community.getDensity());
                return true;
            }
        }

        return false;
    }
}
```

---

## å››ã€ä¸ªäººé¢åº¦ç®¡ç†ï¼šå¹´åº¦26000å…ƒé™é¢ç®¡æ§

æ ¹æ®è·¨å¢ƒç”µå•†æ”¿ç­–ï¼Œæ¯äººæ¯å¹´è·¨å¢ƒç”µå•†é›¶å”®è¿›å£å•†å“çš„**äº¤æ˜“é™é¢ä¸º26000å…ƒ**ï¼Œè¶…è¿‡é™é¢éœ€æŒ‰ä¸€èˆ¬è´¸æ˜“çº³ç¨ã€‚

### 4.1 é¢åº¦ç®¡ç†ç³»ç»Ÿ

```java
/**
 * ä¸ªäººé¢åº¦ç®¡ç†ç³»ç»Ÿ
 * æ ¸å¿ƒåŠŸèƒ½ï¼šå®æ—¶é¢åº¦æ‰£å‡ã€é¢åº¦æŸ¥è¯¢ã€è¶…é¢é¢„è­¦
 */
@Service
public class PersonalQuotaService {

    /**
     * ä¸‹å•æ—¶æ£€æŸ¥é¢åº¦
     */
    @Transactional
    public QuotaCheckResult checkAndDeductQuota(Order order) {
        Long userId = order.getUserId();
        BigDecimal orderAmount = order.getTotalAmount();
        int year = LocalDate.now().getYear();

        // 1. æŸ¥è¯¢ç”¨æˆ·å¹´åº¦å·²ç”¨é¢åº¦
        BigDecimal usedQuota = getUserUsedQuota(userId, year);

        // 2. è®¡ç®—å‰©ä½™é¢åº¦
        BigDecimal remainingQuota = new BigDecimal("26000").subtract(usedQuota);

        // 3. æ£€æŸ¥æ˜¯å¦è¶…é¢
        if (orderAmount.compareTo(remainingQuota) > 0) {
            return QuotaCheckResult.exceeded(
                "æ‚¨çš„å¹´åº¦é¢åº¦ä¸è¶³ï¼Œå‰©ä½™é¢åº¦ï¼š" + remainingQuota + "å…ƒï¼Œ" +
                "æœ¬æ¬¡è®¢å•ï¼š" + orderAmount + "å…ƒ"
            );
        }

        // 4. æ‰£å‡é¢åº¦ï¼ˆRedisåˆ†å¸ƒå¼é”ï¼‰
        String lockKey = "quota_lock:" + userId + ":" + year;
        RLock lock = redissonClient.getLock(lockKey);

        try {
            lock.lock(10, TimeUnit.SECONDS);

            // 4.1 å†æ¬¡æŸ¥è¯¢é¢åº¦ï¼ˆé˜²æ­¢å¹¶å‘é—®é¢˜ï¼‰
            usedQuota = getUserUsedQuota(userId, year);
            remainingQuota = new BigDecimal("26000").subtract(usedQuota);

            if (orderAmount.compareTo(remainingQuota) > 0) {
                return QuotaCheckResult.exceeded("é¢åº¦ä¸è¶³");
            }

            // 4.2 æ‰£å‡é¢åº¦
            deductQuota(userId, year, orderAmount);

            // 4.3 ä¿å­˜é¢åº¦å˜æ›´è®°å½•
            saveQuotaChangeRecord(userId, year, orderAmount, order.getOrderNo());

            return QuotaCheckResult.success(remainingQuota.subtract(orderAmount));

        } finally {
            lock.unlock();
        }
    }

    /**
     * æŸ¥è¯¢ç”¨æˆ·å¹´åº¦å·²ç”¨é¢åº¦
     */
    private BigDecimal getUserUsedQuota(Long userId, int year) {
        // 1. å…ˆä»RedisæŸ¥è¯¢ï¼ˆç¼“å­˜ï¼‰
        String cacheKey = "user_quota:" + userId + ":" + year;
        String cachedQuota = redisTemplate.opsForValue().get(cacheKey);

        if (cachedQuota != null) {
            return new BigDecimal(cachedQuota);
        }

        // 2. ä»æ•°æ®åº“æŸ¥è¯¢
        BigDecimal usedQuota = quotaRepository.sumUsedQuota(userId, year);

        // 3. å†™å…¥ç¼“å­˜ï¼ˆæœ‰æ•ˆæœŸè‡³å¹´åº•ï¼‰
        LocalDateTime endOfYear = LocalDate.of(year, 12, 31).atTime(23, 59, 59);
        long ttl = Duration.between(LocalDateTime.now(), endOfYear).getSeconds();
        redisTemplate.opsForValue().set(cacheKey, usedQuota.toString(), ttl, TimeUnit.SECONDS);

        return usedQuota;
    }

    /**
     * æ‰£å‡é¢åº¦
     */
    private void deductQuota(Long userId, int year, BigDecimal amount) {
        // 1. æ›´æ–°Redisç¼“å­˜
        String cacheKey = "user_quota:" + userId + ":" + year;
        redisTemplate.opsForValue().increment(cacheKey, amount.doubleValue());

        // 2. æ›´æ–°æ•°æ®åº“
        UserQuota quota = quotaRepository.findByUserIdAndYear(userId, year);
        if (quota == null) {
            quota = UserQuota.builder()
                .userId(userId)
                .year(year)
                .usedQuota(amount)
                .totalQuota(new BigDecimal("26000"))
                .build();
        } else {
            quota.setUsedQuota(quota.getUsedQuota().add(amount));
        }
        quotaRepository.save(quota);
    }

    /**
     * è®¢å•å–æ¶ˆæ—¶ï¼Œé€€è¿˜é¢åº¦
     */
    @Transactional
    public void refundQuota(Order order) {
        Long userId = order.getUserId();
        int year = order.getCreateTime().getYear();
        BigDecimal orderAmount = order.getTotalAmount();

        // 1. é€€è¿˜é¢åº¦
        String cacheKey = "user_quota:" + userId + ":" + year;
        redisTemplate.opsForValue().increment(cacheKey, -orderAmount.doubleValue());

        // 2. æ›´æ–°æ•°æ®åº“
        UserQuota quota = quotaRepository.findByUserIdAndYear(userId, year);
        quota.setUsedQuota(quota.getUsedQuota().subtract(orderAmount));
        quotaRepository.save(quota);

        // 3. ä¿å­˜é¢åº¦å˜æ›´è®°å½•
        saveQuotaChangeRecord(userId, year, orderAmount.negate(), order.getOrderNo());
    }

    /**
     * ç”¨æˆ·æŸ¥è¯¢å‰©ä½™é¢åº¦
     */
    public QuotaInfo getUserQuota(Long userId) {
        int year = LocalDate.now().getYear();

        BigDecimal usedQuota = getUserUsedQuota(userId, year);
        BigDecimal totalQuota = new BigDecimal("26000");
        BigDecimal remainingQuota = totalQuota.subtract(usedQuota);

        return QuotaInfo.builder()
            .userId(userId)
            .year(year)
            .totalQuota(totalQuota)
            .usedQuota(usedQuota)
            .remainingQuota(remainingQuota)
            .usageRate(usedQuota.divide(totalQuota, 4, RoundingMode.HALF_UP))
            .build();
    }
}
```

---

## äº”ã€æ•°æ®åˆè§„ï¼šä¸ªäººä¿¡æ¯ä¿æŠ¤ä¸è·¨å¢ƒæ•°æ®ä¼ è¾“

è·¨å¢ƒç”µå•†æ¶‰åŠå¤§é‡ä¸ªäººä¿¡æ¯çš„è·¨å¢ƒä¼ è¾“ï¼Œå¿…é¡»ç¬¦åˆã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹å’Œã€Šæ•°æ®å®‰å…¨æ³•ã€‹ã€‚

### 5.1 ä¸ªäººä¿¡æ¯è„±æ•

```java
/**
 * ä¸ªäººä¿¡æ¯è„±æ•æœåŠ¡
 */
@Service
public class DataMaskingService {

    /**
     * å§“åè„±æ•
     * å¼ ä¸‰ â†’ å¼ *
     */
    public String maskName(String name) {
        if (name == null || name.length() == 0) {
            return "";
        }
        if (name.length() == 1) {
            return name;
        }
        return name.charAt(0) + "*".repeat(name.length() - 1);
    }

    /**
     * èº«ä»½è¯å·è„±æ•
     * 330102199001011234 â†’ 3301**********1234
     */
    public String maskIdCard(String idCard) {
        if (idCard == null || idCard.length() != 18) {
            return "";
        }
        return idCard.substring(0, 4) + "**********" + idCard.substring(14);
    }

    /**
     * æ‰‹æœºå·è„±æ•
     * 13800138000 â†’ 138****8000
     */
    public String maskPhone(String phone) {
        if (phone == null || phone.length() != 11) {
            return "";
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }

    /**
     * åœ°å€è„±æ•
     * æµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸€è¥¿è·¯XXXå· â†’ æµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒº***
     */
    public String maskAddress(String address) {
        if (address == null || address.length() < 10) {
            return "";
        }
        return address.substring(0, 9) + "***";
    }
}
```

### 5.2 è·¨å¢ƒæ•°æ®ä¼ è¾“åˆè§„

```java
/**
 * è·¨å¢ƒæ•°æ®ä¼ è¾“åˆè§„æœåŠ¡
 * ä¾æ®ï¼šã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ç¬¬38-43æ¡
 */
@Service
public class CrossBorderDataTransferService {

    /**
     * å‘æµ·å¤–æ¨é€æ•°æ®å‰çš„åˆè§„æ£€æŸ¥
     */
    public ComplianceCheckResult checkDataTransfer(
        String targetCountry,
        DataTransferRequest request
    ) {
        List<String> violations = new ArrayList<>();

        // 1. æ£€æŸ¥ç›®æ ‡å›½å®¶æ˜¯å¦åœ¨ç™½åå•
        if (!isWhitelistedCountry(targetCountry)) {
            violations.add("ç›®æ ‡å›½å®¶ä¸åœ¨æ•°æ®ä¼ è¾“ç™½åå•ä¸­");
        }

        // 2. æ£€æŸ¥æ˜¯å¦å·²è·å¾—ç”¨æˆ·åŒæ„
        if (!hasUserConsent(request.getUserId(), targetCountry)) {
            violations.add("æœªè·å¾—ç”¨æˆ·è·¨å¢ƒæ•°æ®ä¼ è¾“åŒæ„");
        }

        // 3. æ£€æŸ¥æ•°æ®æ˜¯å¦å·²è„±æ•
        if (!isDataMasked(request.getData())) {
            violations.add("æ•æ„Ÿæ•°æ®æœªè„±æ•");
        }

        // 4. æ£€æŸ¥æ˜¯å¦ç­¾ç½²äº†æ ‡å‡†åˆåŒæ¡æ¬¾
        if (!hasStandardContract(targetCountry)) {
            violations.add("æœªä¸ç›®æ ‡å›½å®¶ç­¾ç½²æ ‡å‡†åˆåŒæ¡æ¬¾");
        }

        if (violations.isEmpty()) {
            return ComplianceCheckResult.passed();
        } else {
            return ComplianceCheckResult.failed(violations);
        }
    }

    /**
     * è·å–ç”¨æˆ·è·¨å¢ƒæ•°æ®ä¼ è¾“åŒæ„
     */
    public boolean obtainUserConsent(Long userId, String targetCountry) {
        // 1. å±•ç¤ºåŒæ„ä¹¦
        ConsentForm form = ConsentForm.builder()
            .userId(userId)
            .title("è·¨å¢ƒæ•°æ®ä¼ è¾“åŒæ„ä¹¦")
            .content("ä¸ºäº†å®Œæˆæ‚¨çš„è·¨å¢ƒè´­ç‰©è®¢å•ï¼Œæˆ‘ä»¬éœ€è¦å°†æ‚¨çš„å§“åã€èº«ä»½è¯å·ã€" +
                    "æ”¶è´§åœ°å€ç­‰ä¸ªäººä¿¡æ¯ä¼ è¾“è‡³" + targetCountry + "æµ·å…³è¿›è¡Œæ¸…å…³ã€‚" +
                    "æˆ‘ä»¬æ‰¿è¯ºé‡‡å–åŠ å¯†ä¼ è¾“ã€æœ€å°åŒ–åŸåˆ™ç­‰æªæ–½ä¿æŠ¤æ‚¨çš„ä¸ªäººä¿¡æ¯å®‰å…¨ã€‚")
            .targetCountry(targetCountry)
            .build();

        // 2. ç”¨æˆ·åŒæ„åï¼Œä¿å­˜åŒæ„è®°å½•
        UserConsent consent = UserConsent.builder()
            .userId(userId)
            .consentType("CROSS_BORDER_DATA_TRANSFER")
            .targetCountry(targetCountry)
            .consentTime(LocalDateTime.now())
            .ipAddress(request.getRemoteAddr())
            .build();
        consentRepository.save(consent);

        return true;
    }
}
```

---

## å…­ã€æŠ€æœ¯æ¶æ„æ€»è§ˆ

### 6.1 é£æ§åˆè§„å¹³å°æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ä¸šåŠ¡ç³»ç»Ÿï¼ˆè®¢å•/å•†å“/ç”¨æˆ·ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é£æ§åˆè§„ç½‘å…³ï¼ˆç»Ÿä¸€å…¥å£ï¼‰                 â”‚
â”‚  - APIé™æµ                                      â”‚
â”‚  - è¯·æ±‚æ—¥å¿—                                     â”‚
â”‚  - ç»Ÿä¸€é‰´æƒ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•†å“åˆè§„å¼•æ“ â”‚        â”‚ äº¤æ˜“é£æ§å¼•æ“ â”‚
â”‚              â”‚        â”‚              â”‚
â”‚- ç¦å”®æ£€æµ‹    â”‚        â”‚- è§„åˆ™å¼•æ“    â”‚
â”‚- æˆæƒéªŒè¯    â”‚        â”‚- MLæ¨¡å‹      â”‚
â”‚- èµ„è´¨å®¡æ ¸    â”‚        â”‚- å›¾ç®—æ³•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚MySQL â”‚  â”‚Redis â”‚  â”‚ES    â”‚  â”‚Neo4j â”‚      â”‚
â”‚  â”‚å…³ç³»å‹â”‚  â”‚ç¼“å­˜  â”‚  â”‚æœç´¢  â”‚  â”‚å›¾æ•°æ®â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¤–éƒ¨æœåŠ¡                               â”‚
â”‚  - åŒºå—é“¾æœåŠ¡                                    â”‚
â”‚  - OCRè¯†åˆ«                                      â”‚
â”‚  - æœºå™¨å­¦ä¹ å¹³å°                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€æ€»ç»“ä¸æœ€ä½³å®è·µ

### 7.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾

| é¢†åŸŸ | æ ¸å¿ƒæŠ€æœ¯ | å…³é”®æŒ‘æˆ˜ |
|------|---------|---------|
| **å•†å“åˆè§„** | è§„åˆ™å¼•æ“ã€NLPã€çŸ¥è¯†å›¾è°± | å˜ä½“è¯è¯†åˆ«ã€å®æ—¶æ›´æ–° |
| **çŸ¥è¯†äº§æƒ** | OCRã€åŒºå—é“¾ã€é˜²ä¼ªæº¯æº | æˆæƒéªŒè¯ã€å‡è´§è¯†åˆ« |
| **äº¤æ˜“é£æ§** | Droolsã€XGBoostã€å›¾ç®—æ³• | å‡†ç¡®ç‡ä¸å¬å›ç‡å¹³è¡¡ |
| **é¢åº¦ç®¡ç†** | åˆ†å¸ƒå¼é”ã€Redisç¼“å­˜ | å¹¶å‘æ‰£å‡ã€æ•°æ®ä¸€è‡´æ€§ |
| **æ•°æ®åˆè§„** | è„±æ•ã€åŠ å¯†ã€åŒæ„ç®¡ç† | è·¨å¢ƒä¼ è¾“åˆè§„ |

### 7.2 æœ€ä½³å®è·µ

#### âœ… DO - åº”è¯¥è¿™æ ·åš

1. **å¤šå±‚é˜²å¾¡**ï¼šä¸ä¾èµ–å•ä¸€æŠ€æœ¯ï¼Œè§„åˆ™å¼•æ“+æœºå™¨å­¦ä¹ +äººå·¥å®¡æ ¸
2. **å®æ—¶ç›‘æ§**ï¼šé£æ§æŒ‡æ ‡å®æ—¶ç›‘æ§ï¼Œå¼‚å¸¸ç«‹å³å‘Šè­¦
3. **æŒç»­ä¼˜åŒ–**ï¼šå®šæœŸåˆ†ææ¼æŠ¥å’Œè¯¯æŠ¥ï¼Œä¼˜åŒ–è§„åˆ™å’Œæ¨¡å‹
4. **ç”¨æˆ·ä½“éªŒ**ï¼šåœ¨é£æ§å’Œä½“éªŒä¹‹é—´å¹³è¡¡ï¼Œé¿å…è¿‡åº¦æ‹¦æˆª
5. **åˆè§„ä¼˜å…ˆ**ï¼šå®å¯ä¸šåŠ¡å—å½±å“ï¼Œä¹Ÿä¸èƒ½è¿åæ³•å¾‹æ³•è§„

#### âŒ DON'T - ä¸è¦è¿™æ ·åš

1. **ä¸è¦åªä¾èµ–é»‘åå•**ï¼šé»‘åå•å®¹æ˜“è¢«ç»•è¿‡ï¼Œéœ€è¦ç»“åˆè¡Œä¸ºåˆ†æ
2. **ä¸è¦å¿½ç•¥æ•°æ®è„±æ•**ï¼šå³ä½¿å†…éƒ¨ç³»ç»Ÿï¼Œä¹Ÿè¦è„±æ•æ•æ„Ÿæ•°æ®
3. **ä¸è¦è¿‡åº¦ä¾èµ–äººå·¥**ï¼šäººå·¥å®¡æ ¸æˆæœ¬é«˜ã€æ•ˆç‡ä½ï¼Œéœ€è¦è‡ªåŠ¨åŒ–
4. **ä¸è¦å¿½ç•¥å†å²æ•°æ®**ï¼šé£æ§æ¨¡å‹éœ€è¦æŒç»­å­¦ä¹ ï¼Œç§¯ç´¯æ•°æ®
5. **ä¸è¦è½»è§†åˆè§„é£é™©**ï¼šåˆè§„äº‹æ•…å¯èƒ½å¯¼è‡´ä¸šåŠ¡åœæ‘†

### 7.3 æ•ˆæœæ•°æ®

æŸè·¨å¢ƒç”µå•†å¹³å°å¼•å…¥å®Œæ•´é£æ§åˆè§„ä½“ç³»åï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **ç¦å”®å•†å“æ£€å‡ºç‡** | 60% | 95% | â†‘35% |
| **å‡è´§æŠ•è¯‰ç‡** | 2.3% | 0.5% | â†“78% |
| **æ¬ºè¯ˆè®¢å•è¯†åˆ«ç‡** | 45% | 88% | â†‘96% |
| **è¯¯æ‹¦æˆªç‡** | 8% | 2% | â†“75% |
| **åˆè§„äº‹æ•…** | 3æ¬¡/å¹´ | 0æ¬¡/å¹´ | â†“100% |

---

## é™„å½•ï¼šé£æ§è§„åˆ™é…ç½®ç¤ºä¾‹

```yaml
# é£æ§è§„åˆ™é…ç½®
risk_rules:
  # å•†å“åˆè§„è§„åˆ™
  product_compliance:
    - name: "ç¦å”®å…³é”®è¯æ£€æµ‹"
      enabled: true
      priority: 1
      action: "REJECT"
      keywords:
        - "ç”µå­çƒŸ"
        - "å¤§éº»"
        - "ä»¿çœŸæª"

  # äº¤æ˜“é£æ§è§„åˆ™
  transaction_risk:
    - name: "æ–°ç”¨æˆ·é«˜ä»·å€¼è®¢å•"
      enabled: true
      priority: 2
      action: "REVIEW"
      conditions:
        - field: "user.register_days"
          operator: "<"
          value: 7
        - field: "order.amount"
          operator: ">"
          value: 1000

    - name: "é¢‘ç¹ä¸‹å•"
      enabled: true
      priority: 3
      action: "REVIEW"
      conditions:
        - field: "user.recent_order_count_1h"
          operator: ">"
          value: 5

  # é¢åº¦ç®¡ç†è§„åˆ™
  quota_management:
    - name: "å¹´åº¦é¢åº¦æ£€æŸ¥"
      enabled: true
      priority: 1
      action: "REJECT"
      conditions:
        - field: "user.used_quota"
          operator: ">"
          value: 26000
```

---

*å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿åˆ†äº«ä½ åœ¨è·¨å¢ƒç”µå•†é£æ§åˆè§„æ–¹é¢çš„å®è·µç»éªŒã€‚*
