---
title: "ã€æ€»ä½“è§„åˆ’ã€‘Springæ¡†æ¶ç¬¬ä¸€æ€§åŸç†ç³»åˆ—æ–‡ç« "
date: 2025-11-03T16:00:00+08:00
draft: true
description: "Springæ¡†æ¶ç¬¬ä¸€æ€§åŸç†ç³»åˆ—æ–‡ç« çš„æ€»ä½“è§„åˆ’å’Œè¿›åº¦è¿½è¸ª"
---

# Springæ¡†æ¶ç¬¬ä¸€æ€§åŸç†ç³»åˆ—æ–‡ç«  - æ€»ä½“è§„åˆ’

## ğŸ“‹ ç³»åˆ—ç›®æ ‡

ä»ç¬¬ä¸€æ€§åŸç†å‡ºå‘,ç”¨æ¸è¿›å¼å¤æ‚åº¦æ¨¡å‹,ç³»ç»ŸåŒ–æ‹†è§£Springæ¡†æ¶,å›ç­”"ä¸ºä»€ä¹ˆéœ€è¦Spring"è€Œéç®€å•æè¿°"Springæ˜¯ä»€ä¹ˆ"ã€‚

**æ ¸å¿ƒä»·å€¼**:
- ç†è§£Springè§£å†³çš„æ ¹æœ¬é—®é¢˜
- æŒæ¡ä»ä¾èµ–æ³¨å…¥åˆ°å¾®æœåŠ¡çš„æ¼”è¿›é€»è¾‘
- å»ºç«‹SpringæŠ€æœ¯æ ˆçš„ç³»ç»Ÿæ€è€ƒæ¡†æ¶
- åŸ¹å…»ç¬¬ä¸€æ€§åŸç†æ€ç»´æ–¹å¼

**ä¸ä¼ ç»ŸSpringæ•™ç¨‹çš„å·®å¼‚**:
- ä¼ ç»Ÿæ•™ç¨‹: å‘Šè¯‰ä½ æ€ä¹ˆç”¨æ³¨è§£ã€é…ç½®æ–‡ä»¶
- æœ¬ç³»åˆ—: å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆéœ€è¦IoCã€ä¸ºä»€ä¹ˆéœ€è¦AOPã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨é…ç½®

---

## ğŸ¯ å¤æ‚åº¦å±‚çº§æ¨¡å‹ï¼ˆSpringè§†è§’ï¼‰

```
Level 0: æœ€ç®€æ¨¡å‹ï¼ˆæ— æ¡†æ¶ï¼‰
  â””â”€ 1ä¸ªJavaç±» + mainæ–¹æ³•ï¼Œæ‰‹åŠ¨newå¯¹è±¡

Level 1: å¼•å…¥ä¾èµ–ç®¡ç† â† æ ¸å¿ƒè·ƒè¿
  â””â”€ å¯¹è±¡é—´ä¾èµ–/ç”Ÿå‘½å‘¨æœŸç®¡ç†/IoCå®¹å™¨

Level 2: å¼•å…¥é¢å‘åˆ‡é¢ â† æ¨ªåˆ‡å…³æ³¨ç‚¹
  â””â”€ äº‹åŠ¡ç®¡ç†/æ—¥å¿—è®°å½•/æƒé™æ§åˆ¶/AOP

Level 3: å¼•å…¥ä¼ä¸šçº§ç‰¹æ€§ â† Webåº”ç”¨
  â””â”€ MVCæ¶æ„/è¯·æ±‚å¤„ç†/æ•°æ®è®¿é—®/Spring Boot

Level 4: å¼•å…¥è‡ªåŠ¨åŒ– â† çº¦å®šä¼˜äºé…ç½®
  â””â”€ è‡ªåŠ¨é…ç½®/Starter/å†…åµŒå®¹å™¨/ç›‘æ§

Level 5: å¼•å…¥åˆ†å¸ƒå¼ â† å¾®æœåŠ¡æ¶æ„
  â””â”€ æœåŠ¡æ³¨å†Œ/é…ç½®ä¸­å¿ƒ/ç†”æ–­é™çº§/é“¾è·¯è¿½è¸ª

Level 6: å¼•å…¥äº‘åŸç”Ÿ â† ç³»ç»Ÿè¾¹ç•Œ
  â””â”€ å®¹å™¨åŒ–/Kubernetes/æœåŠ¡ç½‘æ ¼/ç»ˆå±€æ€è€ƒ
```

---

## ğŸ“š ç³»åˆ—æ–‡ç« åˆ—è¡¨ï¼ˆ6ç¯‡ï¼‰

### âœ… æ–‡ç« 1ï¼šã€ŠSpringç¬¬ä¸€æ€§åŸç†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ¡†æ¶ï¼Ÿã€‹
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**å®é™…å­—æ•°**: 16,000å­—
**å®Œæˆæ—¶é—´**: 2025-11-03
**æ–‡ä»¶å**: `2025-11-03-why-we-need-spring.md`

**æ ¸å¿ƒå†…å®¹**:
- å¼•å­: ä¸€ä¸ªç”µå•†è®¢å•åˆ›å»ºçš„ä¸¤ç§å®ç°ï¼ˆçº¯Java vs Springï¼‰
- ç¬¬ä¸€æ€§åŸç†æ‹†è§£: å¯¹è±¡ Ã— ä¾èµ–å…³ç³» Ã— ç”Ÿå‘½å‘¨æœŸ
- äº”å¤§å¤æ‚åº¦æ¥æº: ä¾èµ–ç®¡ç†ã€é…ç½®ã€æ¨ªåˆ‡å…³æ³¨ç‚¹ã€é‡å¤ä»£ç ã€æµ‹è¯•
- ä¸ºä»€ä¹ˆSpringèƒ½æˆä¸ºJavaç”Ÿæ€çš„åŸºçŸ³ï¼Ÿ
- å¤æ‚åº¦ç®¡ç†çš„æ–¹æ³•è®º

**å¤§çº²è¦ç‚¹**:
```
ä¸€ã€å¼•å­: è®¢å•æœåŠ¡çš„ä¸¤ç§å®ç°ï¼ˆ4000å­—ï¼‰
  1.1 åœºæ™¯A: çº¯Javaå®ç°ï¼ˆæ‰‹åŠ¨newã€ç¡¬ç¼–ç ä¾èµ–ï¼‰
  1.2 åœºæ™¯B: Springå®ç°ï¼ˆä¾èµ–æ³¨å…¥ã€é…ç½®åˆ†ç¦»ï¼‰
  1.3 æ•°æ®å¯¹æ¯”è¡¨æ ¼ï¼ˆä»£ç è¡Œæ•°ã€è€¦åˆåº¦ã€å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§ï¼‰

äºŒã€ç¬¬ä¸€æ€§åŸç†æ‹†è§£ï¼ˆ3000å­—ï¼‰
  2.1 è½¯ä»¶å¼€å‘çš„æœ¬è´¨å…¬å¼
  2.2 ä¾èµ–ç®¡ç†é—®é¢˜
  2.3 å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé—®é¢˜
  2.4 æ¨ªåˆ‡å…³æ³¨ç‚¹é—®é¢˜

ä¸‰ã€å¤æ‚åº¦æ¥æºåˆ†æï¼ˆ5000å­—ï¼‰
  3.1 ä¾èµ–å¤æ‚åº¦ï¼ˆæ‰‹åŠ¨ç®¡ç† vs IoCå®¹å™¨ï¼‰
  3.2 é…ç½®å¤æ‚åº¦ï¼ˆç¡¬ç¼–ç  vs å¤–éƒ¨é…ç½®ï¼‰
  3.3 åˆ‡é¢å¤æ‚åº¦ï¼ˆä»£ç é‡å¤ vs AOPï¼‰
  3.4 æµ‹è¯•å¤æ‚åº¦ï¼ˆå¼ºè€¦åˆ vs ä¾èµ–æ³¨å…¥ï¼‰

å››ã€ä¸ºä»€ä¹ˆæ˜¯Springï¼Ÿï¼ˆ2000å­—ï¼‰
  4.1 å¯¹æ¯”å…¶ä»–æ¡†æ¶ï¼ˆEJBã€Guiceã€CDIï¼‰
  4.2 Springçš„æ ¸å¿ƒä¼˜åŠ¿
  4.3 Springç”Ÿæ€çš„æ¼”è¿›

äº”ã€æ€»ç»“ä¸æ–¹æ³•è®ºï¼ˆ2000å­—ï¼‰
```

---

### âœ… æ–‡ç« 2ï¼šã€ŠIoCå®¹å™¨ï¼šä»æ‰‹åŠ¨newåˆ°è‡ªåŠ¨è£…é…çš„æ¼”è¿›ã€‹
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**å®é™…å­—æ•°**: 17,000å­—
**å®Œæˆæ—¶é—´**: 2025-11-03
**æ–‡ä»¶å**: `2025-11-03-ioc-container-evolution.md`

**æ ¸å¿ƒå†…å®¹**:
- åœºæ™¯0: å¦‚æœæ²¡æœ‰å®¹å™¨ï¼ˆæ‰‹åŠ¨newå¯¹è±¡ï¼‰
- åœºæ™¯1: å¼•å…¥ç®€å•å·¥å‚ï¼ˆå·¥å‚æ¨¡å¼ï¼‰
- åœºæ™¯2: å¼•å…¥ä¾èµ–æ³¨å…¥ï¼ˆæ„é€ å™¨/setteræ³¨å…¥ï¼‰
- åœºæ™¯3: å¼•å…¥IoCå®¹å™¨ï¼ˆBeanFactory/ApplicationContextï¼‰
- åœºæ™¯4: å¼•å…¥è‡ªåŠ¨è£…é…ï¼ˆ@Autowired/@ComponentScanï¼‰
- æ€»ç»“: IoCå®¹å™¨è§£å†³äº†ä»€ä¹ˆé—®é¢˜

**æŠ€æœ¯æ·±åº¦**:
- æ‰‹å†™ä¸€ä¸ªç®€åŒ–ç‰ˆIoCå®¹å™¨ï¼ˆ200è¡Œä»£ç ï¼‰
- Spring IoCå®¹å™¨çš„æ ¸å¿ƒæ¥å£è®¾è®¡
- Beançš„ç”Ÿå‘½å‘¨æœŸï¼ˆå®ä¾‹åŒ–â†’å±æ€§å¡«å……â†’åˆå§‹åŒ–â†’é”€æ¯ï¼‰
- å¾ªç¯ä¾èµ–çš„ä¸‰çº§ç¼“å­˜è§£å†³æ–¹æ¡ˆ
- ä¸åŒæ³¨å…¥æ–¹å¼çš„å¯¹æ¯”ï¼ˆæ„é€ å™¨ vs Setter vs å­—æ®µæ³¨å…¥ï¼‰

---

### âœ… æ–‡ç« 3ï¼šã€ŠAOPï¼šä»ä»£ç é‡å¤åˆ°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‹
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**å®é™…å­—æ•°**: 16,000å­—
**å®Œæˆæ—¶é—´**: 2025-11-03
**æ–‡ä»¶å**: `2025-11-03-aop-aspect-oriented-programming.md`

**æ ¸å¿ƒå†…å®¹**:
- æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å›°å¢ƒï¼ˆäº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ï¼‰
- åŠ¨æ€ä»£ç†çš„ä¸¤ç§å®ç°ï¼ˆJDKåŠ¨æ€ä»£ç† vs CGLIBï¼‰
- Spring AOPçš„å®ç°åŸç†
- AspectJçš„å®Œæ•´AOPèƒ½åŠ›
- å®æˆ˜æ¡ˆä¾‹: è‡ªå®šä¹‰æ³¨è§£+AOPå®ç°ç»Ÿä¸€æ—¥å¿—

**æŠ€æœ¯æ·±åº¦**:
- æ‰‹å†™JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†
- ProxyFactoryBeançš„å·¥ä½œåŸç†
- @Around/@Before/@Afterçš„æ‰§è¡Œé¡ºåº
- AOPæ€§èƒ½å½±å“åˆ†æ
- ä½•æ—¶ä½¿ç”¨AOPï¼Œä½•æ—¶ä¸è¯¥ç”¨

---

### â³ æ–‡ç« 4ï¼šã€ŠSpring Bootï¼šçº¦å®šä¼˜äºé…ç½®çš„å¨åŠ›ã€‹
**çŠ¶æ€**: â³ å¾…å†™ä½œ
**é¢„è®¡å­—æ•°**: 18,000å­—
**è§„åˆ’å®Œæˆæ—¶é—´**: 2025-11-XX
**æ–‡ä»¶å**: `2025-11-XX-spring-boot-convention-over-configuration.md`

**æ ¸å¿ƒå†…å®¹**:
- ä¼ ç»ŸSpringçš„é…ç½®åœ°ç‹±ï¼ˆXMLé…ç½®ã€Java Configï¼‰
- Spring Bootçš„ä¸‰å¤§æ³•å®ï¼ˆè‡ªåŠ¨é…ç½®ã€Starterã€å†…åµŒå®¹å™¨ï¼‰
- è‡ªåŠ¨é…ç½®çš„åŸç†ï¼ˆ@EnableAutoConfigurationã€spring.factoriesã€æ¡ä»¶è£…é…ï¼‰
- æ‰‹å†™ä¸€ä¸ªè‡ªå®šä¹‰Starter
- Actuatorç›‘æ§ä¸å¥åº·æ£€æŸ¥

**æŠ€æœ¯æ·±åº¦**:
- @SpringBootApplicationæ³¨è§£æ‹†è§£
- è‡ªåŠ¨é…ç½®çš„åŠ è½½æµç¨‹ï¼ˆAutoConfigurationImportSelectorï¼‰
- æ¡ä»¶æ³¨è§£çš„å®Œæ•´ä½“ç³»ï¼ˆ@ConditionalOnClass/@ConditionalOnBeanç­‰ï¼‰
- é…ç½®ä¼˜å…ˆçº§ï¼ˆapplication.ymlã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ï¼‰
- ä»0åˆ°1åˆ›å»ºä¸€ä¸ªç”Ÿäº§çº§Spring Bootåº”ç”¨

---

### â³ æ–‡ç« 5ï¼šã€ŠSpring Cloudï¼šä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¶æ„æ¼”è¿›ã€‹
**çŠ¶æ€**: â³ å¾…å†™ä½œ
**é¢„è®¡å­—æ•°**: 19,000å­—
**è§„åˆ’å®Œæˆæ—¶é—´**: 2025-11-XX
**æ–‡ä»¶å**: `2025-11-XX-spring-cloud-microservices.md`

**æ ¸å¿ƒå†…å®¹**:
- å•ä½“åº”ç”¨çš„å›°å¢ƒï¼ˆéƒ¨ç½²æ…¢ã€æ‰©å±•éš¾ã€æŠ€æœ¯æ ˆç»‘å®šï¼‰
- å¾®æœåŠ¡çš„äº”å¤§æ ¸å¿ƒé—®é¢˜ï¼ˆæœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ã€é“¾è·¯è¿½è¸ªï¼‰
- Spring Cloudç»„ä»¶ä½“ç³»ï¼ˆGatewayã€Nacosã€OpenFeignã€Sentinelã€SkyWalkingï¼‰
- å¾®æœåŠ¡æ‹†åˆ†çš„ç¬¬ä¸€æ€§åŸç†ï¼ˆåº·å¨å®šå¾‹ã€é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰
- å¾®æœåŠ¡çš„ä»£ä»·ä¸æƒè¡¡

**æŠ€æœ¯æ·±åº¦**:
- æœåŠ¡æ³¨å†Œä¸å‘ç°çš„å®ç°åŸç†ï¼ˆNacos AP/CPæ¨¡å¼ï¼‰
- é…ç½®ä¸­å¿ƒçš„åŠ¨æ€åˆ·æ–°ï¼ˆ@RefreshScopeï¼‰
- OpenFeignçš„å£°æ˜å¼HTTPå®¢æˆ·ç«¯åŸç†
- Sentinelçš„é™æµç®—æ³•ï¼ˆä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ã€æ»‘åŠ¨çª—å£ï¼‰
- åˆ†å¸ƒå¼äº‹åŠ¡çš„å››ç§æ–¹æ¡ˆï¼ˆ2PCã€TCCã€Sagaã€æœ¬åœ°æ¶ˆæ¯è¡¨ï¼‰

---

### â³ æ–‡ç« 6ï¼šã€ŠSpringæºç è§£æï¼šä»ä½¿ç”¨è€…åˆ°è´¡çŒ®è€…ã€‹
**çŠ¶æ€**: â³ å¾…å†™ä½œ
**é¢„è®¡å­—æ•°**: 15,000å­—
**è§„åˆ’å®Œæˆæ—¶é—´**: 2025-11-XX
**æ–‡ä»¶å**: `2025-11-XX-spring-source-code-analysis.md`

**æ ¸å¿ƒå†…å®¹**:
- å¦‚ä½•é˜…è¯»Springæºç ï¼ˆå·¥å…·ã€æ–¹æ³•ã€æŠ€å·§ï¼‰
- IoCå®¹å™¨å¯åŠ¨æµç¨‹æºç å‰–æ
- AOPä»£ç†åˆ›å»ºæµç¨‹æºç å‰–æ
- @Transactionaläº‹åŠ¡ç®¡ç†æºç å‰–æ
- Springè®¾è®¡æ¨¡å¼ç²¾åï¼ˆå·¥å‚ã€æ¨¡æ¿ã€ç­–ç•¥ã€è§‚å¯Ÿè€…ã€ä»£ç†ï¼‰
- ç»ˆå±€æ€è€ƒ: Springçš„æœªæ¥ï¼ˆGraalVMã€äº‘åŸç”Ÿã€å“åº”å¼ç¼–ç¨‹ï¼‰

**æŠ€æœ¯æ·±åº¦**:
- AbstractApplicationContext.refresh()æ–¹æ³•è¯¦è§£
- BeanPostProcessorçš„æ‰©å±•ç‚¹
- TransactionInterceptorçš„æ‹¦æˆªå™¨é“¾
- Spring 5.0+çš„å“åº”å¼ç¼–ç¨‹ï¼ˆWebFluxï¼‰
- Spring Nativeçš„åŸç”Ÿç¼–è¯‘ä¼˜åŒ–

---

## ğŸ“– æ–‡ç« 1ï¼šã€ŠSpringç¬¬ä¸€æ€§åŸç†ã€‹- è¯¦ç»†å¤§çº²

### ä¸€ã€å¼•å­ï¼šè®¢å•æœåŠ¡çš„ä¸¤ç§å®ç°ï¼ˆ4000å­—ï¼‰

**ç›®æ ‡**: é€šè¿‡å¯¹æ¯”å»ºç«‹"Springç¡®å®è§£å†³äº†æ ¸å¿ƒé—®é¢˜"çš„ç›´è§‚æ„Ÿå—

#### 1.1 åœºæ™¯Aï¼šçº¯Javaå®ç°ï¼ˆæ— æ¡†æ¶ï¼‰

```java
// è®¢å•æœåŠ¡å®ç°ï¼ˆçº¯Javaï¼Œçº¦150è¡Œï¼‰
public class OrderService {
    private UserService userService;
    private ProductService productService;
    private InventoryService inventoryService;
    private PaymentService paymentService;

    // æ‰‹åŠ¨newä¾èµ–ï¼ˆç¡¬ç¼–ç ï¼‰
    public OrderService() {
        this.userService = new UserService();
        this.productService = new ProductService();
        this.inventoryService = new InventoryService();
        this.paymentService = new PaymentService();
    }

    // åˆ›å»ºè®¢å•ï¼ˆæ··æ‚äº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼‰
    public Order createOrder(OrderRequest request) {
        // 1. æ—¥å¿—è®°å½•ï¼ˆé‡å¤ä»£ç ï¼‰
        System.out.println("å¼€å§‹åˆ›å»ºè®¢å•: " + request);
        long start = System.currentTimeMillis();

        try {
            // 2. æƒé™æ£€æŸ¥ï¼ˆé‡å¤ä»£ç ï¼‰
            User user = userService.getUser(request.getUserId());
            if (!user.hasPermission("CREATE_ORDER")) {
                throw new PermissionException("æ— æƒé™åˆ›å»ºè®¢å•");
            }

            // 3. å‚æ•°æ ¡éªŒï¼ˆé‡å¤ä»£ç ï¼‰
            if (request.getProductId() == null) {
                throw new ValidationException("å•†å“IDä¸èƒ½ä¸ºç©º");
            }

            // 4. æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼ˆé‡å¤ä»£ç ï¼‰
            Connection conn = null;
            try {
                conn = getConnection();
                conn.setAutoCommit(false);

                // ä¸šåŠ¡é€»è¾‘
                Product product = productService.getProduct(request.getProductId());
                boolean success = inventoryService.deduct(product.getId(), request.getQuantity());
                if (!success) {
                    throw new BusinessException("åº“å­˜ä¸è¶³");
                }

                Order order = new Order();
                order.setUserId(user.getId());
                order.setProductId(product.getId());
                order.setAmount(product.getPrice() * request.getQuantity());

                saveOrder(order, conn);

                conn.commit();
                return order;

            } catch (Exception e) {
                if (conn != null) {
                    conn.rollback();
                }
                throw e;
            } finally {
                if (conn != null) {
                    conn.close();
                }
            }

        } finally {
            // 5. æ—¥å¿—è®°å½•ï¼ˆé‡å¤ä»£ç ï¼‰
            long end = System.currentTimeMillis();
            System.out.println("è®¢å•åˆ›å»ºå®Œæˆï¼Œè€—æ—¶: " + (end - start) + "ms");
        }
    }
}

æ¶‰åŠé—®é¢˜ï¼š
- ç¡¬ç¼–ç ä¾èµ–ï¼ˆnew UserService()æ— æ³•æ›¿æ¢å®ç°ï¼‰
- æ¨ªåˆ‡å…³æ³¨ç‚¹æ··æ‚ï¼ˆäº‹åŠ¡ã€æ—¥å¿—ã€æƒé™æ•£è½åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼‰
- ä»£ç é‡å¤ï¼ˆæ¯ä¸ªæ–¹æ³•éƒ½è¦å†™äº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ï¼‰
- éš¾ä»¥æµ‹è¯•ï¼ˆæ— æ³•mockä¾èµ–ï¼‰
- é…ç½®ç¡¬ç¼–ç ï¼ˆæ•°æ®åº“è¿æ¥ã€è¶…æ—¶æ—¶é—´å†™æ­»åœ¨ä»£ç é‡Œï¼‰
```

#### 1.2 åœºæ™¯Bï¼šSpringå®ç°ï¼ˆä¾èµ–æ³¨å…¥+AOPï¼‰

```java
// è®¢å•æœåŠ¡å®ç°ï¼ˆSpringï¼Œçº¦30è¡Œï¼‰
@Service
@Transactional
public class OrderService {

    @Autowired
    private UserService userService;

    @Autowired
    private ProductService productService;

    @Autowired
    private InventoryService inventoryService;

    @Autowired
    private PaymentService paymentService;

    @RequirePermission("CREATE_ORDER")
    @Loggable
    public Order createOrder(@Valid OrderRequest request) {
        // çº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘ï¼ˆäº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ç”±Springç®¡ç†ï¼‰
        User user = userService.getUser(request.getUserId());
        Product product = productService.getProduct(request.getProductId());

        boolean success = inventoryService.deduct(product.getId(), request.getQuantity());
        if (!success) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }

        Order order = new Order();
        order.setUserId(user.getId());
        order.setProductId(product.getId());
        order.setAmount(product.getPrice() * request.getQuantity());

        return orderRepository.save(order);
    }
}

ä¼˜åŠ¿ï¼š
- ä¾èµ–æ³¨å…¥ï¼ˆ@Autowiredè‡ªåŠ¨è£…é…ï¼Œæ˜“äºæµ‹è¯•å’Œæ›¿æ¢ï¼‰
- äº‹åŠ¡ç®¡ç†ï¼ˆ@Transactionalå£°æ˜å¼äº‹åŠ¡ï¼‰
- æ—¥å¿—è®°å½•ï¼ˆ@Loggableè‡ªå®šä¹‰AOPï¼‰
- æƒé™æ§åˆ¶ï¼ˆ@RequirePermissionè‡ªå®šä¹‰AOPï¼‰
- å‚æ•°æ ¡éªŒï¼ˆ@Valid JSR-303æ ¡éªŒï¼‰
- ä»£ç é‡å‡å°‘80%ï¼ˆ150è¡Œ â†’ 30è¡Œï¼‰
```

#### 1.3 æ•°æ®å¯¹æ¯”è¡¨æ ¼

| å¯¹æ¯”ç»´åº¦ | çº¯Javaå®ç° | Springå®ç° | å·®å¼‚ |
|---------|-----------|-----------|------|
| ä»£ç è¡Œæ•° | 150è¡Œ | 30è¡Œ | å‡å°‘80% |
| ä¾èµ–ç®¡ç† | æ‰‹åŠ¨newï¼ˆç¡¬ç¼–ç ï¼‰ | ä¾èµ–æ³¨å…¥ï¼ˆè§£è€¦ï¼‰ | è´¨çš„é£è·ƒ |
| äº‹åŠ¡ç®¡ç† | æ‰‹åŠ¨try-catch-rollback | @Transactionalå£°æ˜å¼ | 10å€ç®€åŒ– |
| æ—¥å¿—è®°å½• | é‡å¤ä»£ç  | @Loggable AOP | å¤ç”¨ |
| æƒé™æ§åˆ¶ | é‡å¤ä»£ç  | @RequirePermission AOP | å¤ç”¨ |
| å‚æ•°æ ¡éªŒ | æ‰‹åŠ¨ifåˆ¤æ–­ | @Validæ³¨è§£ | ç®€åŒ– |
| å¯æµ‹è¯•æ€§ | éš¾ï¼ˆå¼ºä¾èµ–ï¼‰ | æ˜“ï¼ˆmockæ³¨å…¥ï¼‰ | 10å€æå‡ |
| é…ç½®çµæ´»æ€§ | ç¡¬ç¼–ç  | å¤–éƒ¨é…ç½®æ–‡ä»¶ | çµæ´» |
| å¼€å‘æ•ˆç‡ | ä½ï¼ˆå†™å¤§é‡é‡å¤ä»£ç ï¼‰ | é«˜ï¼ˆä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼‰ | 5å€æå‡ |

**æ ¸å¿ƒç»“è®º**:
- Springé€šè¿‡IoCå’ŒAOPï¼Œå°†å¼€å‘è€…ä»80%çš„æ¡†æ¶ä»£ç ä¸­è§£æ”¾å‡ºæ¥
- ä¸šåŠ¡ä»£ç ä¸æ¡†æ¶ä»£ç åˆ†ç¦»ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»
- ä»£ç é‡å‡å°‘ï¼Œä½†è´¨é‡æå‡ï¼ˆå¯æµ‹è¯•ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•ï¼‰

---

### äºŒã€ç¬¬ä¸€æ€§åŸç†æ‹†è§£ï¼ˆ3000å­—ï¼‰

**ç›®æ ‡**: å»ºç«‹æ€è€ƒæ¡†æ¶ï¼Œå›ç­”"æœ¬è´¨æ˜¯ä»€ä¹ˆ"

#### 2.1 è½¯ä»¶å¼€å‘çš„æœ¬è´¨å…¬å¼

```
è½¯ä»¶å¼€å‘ = å¯¹è±¡ï¼ˆObjectsï¼‰Ã— ä¾èµ–å…³ç³»ï¼ˆDependenciesï¼‰Ã— ç”Ÿå‘½å‘¨æœŸï¼ˆLifecycleï¼‰
           â†“                    â†“                        â†“
         What                 How                      When
```

**ä¸‰ä¸ªåŸºæœ¬é—®é¢˜**:
1. **å¯¹è±¡ï¼ˆWhatï¼‰** - ç³»ç»Ÿç”±å“ªäº›å¯¹è±¡ç»„æˆï¼Ÿ
2. **ä¾èµ–å…³ç³»ï¼ˆHowï¼‰** - å¯¹è±¡ä¹‹é—´å¦‚ä½•åä½œï¼Ÿ
3. **ç”Ÿå‘½å‘¨æœŸï¼ˆWhenï¼‰** - å¯¹è±¡ä½•æ—¶åˆ›å»ºã€ä½•æ—¶é”€æ¯ï¼Ÿ

#### 2.2 ä¾èµ–ç®¡ç†é—®é¢˜ï¼šä»æ‰‹åŠ¨newåˆ°ä¾èµ–æ³¨å…¥

**å­é—®é¢˜æ‹†è§£**:
- âœ… è°æ¥åˆ›å»ºå¯¹è±¡ï¼Ÿï¼ˆå·¥å‚ vs å®¹å™¨ï¼‰
- âœ… è°æ¥ç®¡ç†ä¾èµ–ï¼Ÿï¼ˆæ‰‹åŠ¨æ³¨å…¥ vs è‡ªåŠ¨è£…é…ï¼‰
- âœ… å¦‚ä½•æ›¿æ¢å®ç°ï¼Ÿï¼ˆç¡¬ç¼–ç  vs æ¥å£+é…ç½®ï¼‰
- âœ… å¦‚ä½•è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Ÿï¼ˆmock vs çœŸå®å¯¹è±¡ï¼‰

**æ ¸å¿ƒæ´å¯Ÿ**:
> ä¾èµ–ç®¡ç†çš„æœ¬è´¨æ˜¯**æ§åˆ¶åè½¬ï¼ˆIoCï¼‰**: å°†å¯¹è±¡åˆ›å»ºå’Œä¾èµ–ç®¡ç†çš„æ§åˆ¶æƒä»ä¸šåŠ¡ä»£ç è½¬ç§»åˆ°å®¹å™¨

**æ¡ˆä¾‹æ¨å¯¼ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–æ³¨å…¥ï¼Ÿ**
```
åœºæ™¯ï¼šè®¢å•æœåŠ¡ä¾èµ–æ”¯ä»˜æœåŠ¡

æ–¹å¼1ï¼šæ‰‹åŠ¨newï¼ˆç¡¬ç¼–ç ï¼‰
public class OrderService {
    private PaymentService paymentService = new AlipayPaymentService();
}
é—®é¢˜ï¼š
â”œâ”€ å¼ºè€¦åˆï¼šæ— æ³•åˆ‡æ¢åˆ°å¾®ä¿¡æ”¯ä»˜
â”œâ”€ éš¾æµ‹è¯•ï¼šæ— æ³•mock PaymentService
â””â”€ é…ç½®ç¡¬ç¼–ç ï¼šæ”¯ä»˜é…ç½®å†™æ­»åœ¨ä»£ç é‡Œ

æ–¹å¼2ï¼šä¾èµ–æ³¨å…¥ï¼ˆè§£è€¦ï¼‰
public class OrderService {
    @Autowired
    private PaymentService paymentService;  // æ¥å£
}
ä¼˜åŠ¿ï¼š
â”œâ”€ å¼±è€¦åˆï¼šé…ç½®æ–‡ä»¶å†³å®šä½¿ç”¨æ”¯ä»˜å®è¿˜æ˜¯å¾®ä¿¡
â”œâ”€ æ˜“æµ‹è¯•ï¼šå¯ä»¥æ³¨å…¥MockPaymentService
â””â”€ é…ç½®å¤–éƒ¨åŒ–ï¼šæ”¯ä»˜é…ç½®åœ¨application.yml
```

**ä¾èµ–æ³¨å…¥çš„ç¬¬ä¸€æ€§åŸç†**:
```
å¥½ä»£ç  = ä¸šåŠ¡é€»è¾‘ Ã— ä¾èµ–è§£è€¦ Ã— å¯æµ‹è¯•æ€§ Ã— å¯ç»´æŠ¤æ€§
         ï¼ˆæ ¸å¿ƒä»·å€¼ï¼‰ ï¼ˆIoCï¼‰   ï¼ˆDIï¼‰      ï¼ˆé…ç½®åˆ†ç¦»ï¼‰

å…¬å¼å±•å¼€ï¼š
ä¸šåŠ¡é€»è¾‘ï¼šä¸“æ³¨äºä¸šåŠ¡ä»·å€¼ï¼Œä¸è¢«æ¡†æ¶ä»£ç å¹²æ‰°
ä¾èµ–è§£è€¦ï¼šé¢å‘æ¥å£ç¼–ç¨‹ï¼Œå®ç°å¯æ›¿æ¢
å¯æµ‹è¯•æ€§ï¼šä¾èµ–å¯æ³¨å…¥ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•
å¯ç»´æŠ¤æ€§ï¼šé…ç½®å¤–éƒ¨åŒ–ï¼Œä¿®æ”¹æ— éœ€é‡æ–°ç¼–è¯‘
```

#### 2.3 å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼šè°æ¥ç®¡ç†Beanï¼Ÿ

**ç”Ÿå‘½å‘¨æœŸçš„å¤æ‚åº¦**:
```
å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»º â†’ åˆå§‹åŒ– â†’ ä½¿ç”¨ â†’ é”€æ¯

æ‰‹åŠ¨ç®¡ç†çš„é—®é¢˜ï¼š
â”œâ”€ ä½•æ—¶åˆ›å»ºï¼Ÿï¼ˆé¥¿æ±‰ vs æ‡’æ±‰ï¼‰
â”œâ”€ å•ä¾‹ vs å¤šä¾‹ï¼Ÿï¼ˆçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰
â”œâ”€ åˆå§‹åŒ–é¡ºåºï¼Ÿï¼ˆAä¾èµ–Bï¼ŒBä¾èµ–Cï¼‰
â”œâ”€ å¾ªç¯ä¾èµ–ï¼Ÿï¼ˆAä¾èµ–Bï¼ŒBä¾èµ–Aï¼‰
â””â”€ ä½•æ—¶é”€æ¯ï¼Ÿï¼ˆèµ„æºæ³„æ¼é£é™©ï¼‰

Springå®¹å™¨çš„ç®¡ç†ï¼š
â”œâ”€ è‡ªåŠ¨åˆ›å»ºï¼šå®¹å™¨å¯åŠ¨æ—¶æ‰«æå¹¶åˆ›å»ºBean
â”œâ”€ è‡ªåŠ¨è£…é…ï¼šæ ¹æ®ç±»å‹æˆ–åç§°è‡ªåŠ¨æ³¨å…¥ä¾èµ–
â”œâ”€ ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼š@PostConstruct / @PreDestroy
â”œâ”€ å¾ªç¯ä¾èµ–è§£å†³ï¼šä¸‰çº§ç¼“å­˜æœºåˆ¶
â””â”€ è‡ªåŠ¨é”€æ¯ï¼šå®¹å™¨å…³é—­æ—¶é”€æ¯æ‰€æœ‰Bean
```

**Beanç”Ÿå‘½å‘¨æœŸè¯¦è§£**:
```java
// Spring Beanå®Œæ•´ç”Ÿå‘½å‘¨æœŸ
1. å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰
   â””â”€ è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡

2. å±æ€§å¡«å……ï¼ˆPopulate Propertiesï¼‰
   â””â”€ æ³¨å…¥@Autowiredä¾èµ–

3. Beanåç§°è®¾ç½®ï¼ˆBeanNameAwareï¼‰
   â””â”€ setBeanName()

4. Beanå·¥å‚è®¾ç½®ï¼ˆBeanFactoryAwareï¼‰
   â””â”€ setBeanFactory()

5. å‰ç½®å¤„ç†ï¼ˆBeanPostProcessor.postProcessBeforeInitializationï¼‰
   â””â”€ ä¾‹å¦‚ï¼š@PostConstructæ³¨è§£å¤„ç†

6. åˆå§‹åŒ–ï¼ˆInitializationï¼‰
   â””â”€ InitializingBean.afterPropertiesSet()
   â””â”€ è‡ªå®šä¹‰init-method

7. åç½®å¤„ç†ï¼ˆBeanPostProcessor.postProcessAfterInitializationï¼‰
   â””â”€ ä¾‹å¦‚ï¼šAOPä»£ç†åˆ›å»º

8. ä½¿ç”¨ï¼ˆIn Useï¼‰
   â””â”€ Beanå¯ä»¥è¢«ä½¿ç”¨

9. é”€æ¯ï¼ˆDestructionï¼‰
   â””â”€ @PreDestroy
   â””â”€ DisposableBean.destroy()
   â””â”€ è‡ªå®šä¹‰destroy-method
```

#### 2.4 æ¨ªåˆ‡å…³æ³¨ç‚¹é—®é¢˜ï¼šä»£ç é‡å¤æ€ä¹ˆåŠï¼Ÿ

**æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å›°å¢ƒ**:
```
ä¸šåŠ¡ç³»ç»Ÿçš„å…³æ³¨ç‚¹ï¼š
â”œâ”€ æ ¸å¿ƒå…³æ³¨ç‚¹ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ï¼šè®¢å•åˆ›å»ºã€æ”¯ä»˜å¤„ç†
â””â”€ æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆæŠ€æœ¯æ€§åŠŸèƒ½ï¼‰ï¼šäº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ã€ç¼“å­˜ã€ç›‘æ§

ä¼ ç»ŸOOPçš„é—®é¢˜ï¼š
  æ¨ªåˆ‡å…³æ³¨ç‚¹æ•£è½åœ¨å„ä¸ªä¸šåŠ¡æ–¹æ³•ä¸­
  â”œâ”€ ä»£ç é‡å¤ï¼ˆæ¯ä¸ªæ–¹æ³•éƒ½å†™äº‹åŠ¡ã€æ—¥å¿—ï¼‰
  â”œâ”€ éš¾ä»¥ç»´æŠ¤ï¼ˆä¿®æ”¹äº‹åŠ¡é€»è¾‘éœ€è¦æ”¹æ‰€æœ‰æ–¹æ³•ï¼‰
  â””â”€ ä¸šåŠ¡ä»£ç æ··æ‚ï¼ˆçœ‹ä¸æ¸…æ ¸å¿ƒé€»è¾‘ï¼‰

AOPçš„è§£å†³æ–¹æ¡ˆï¼š
  æ¨ªåˆ‡å…³æ³¨ç‚¹æŠ½å–ä¸ºåˆ‡é¢ï¼ˆAspectï¼‰
  â”œâ”€ å£°æ˜å¼äº‹åŠ¡ï¼š@Transactional
  â”œâ”€ å£°æ˜å¼æ—¥å¿—ï¼š@Loggable
  â”œâ”€ å£°æ˜å¼æƒé™ï¼š@RequirePermission
  â””â”€ åŠ¨æ€ä»£ç†ï¼šè¿è¡Œæ—¶ç»‡å…¥åˆ‡é¢é€»è¾‘
```

**AOPçš„ç¬¬ä¸€æ€§åŸç†**:
```
é—®é¢˜ï¼šå¦‚ä½•åœ¨ä¸ä¿®æ”¹åŸå§‹ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºåŠŸèƒ½ï¼Ÿ

ç­”æ¡ˆï¼šä»£ç†æ¨¡å¼ + åŠ¨æ€ç»‡å…¥

ä»£ç†æ¨¡å¼ï¼š
  Client â†’ Proxy â†’ RealSubject
           â†‘
        å¢å¼ºé€»è¾‘ï¼ˆäº‹åŠ¡ã€æ—¥å¿—ï¼‰

åŠ¨æ€ç»‡å…¥ï¼š
  ç¼–è¯‘æ—¶ï¼šAspectJï¼ˆä¿®æ”¹å­—èŠ‚ç ï¼‰
  è¿è¡Œæ—¶ï¼šSpring AOPï¼ˆåŠ¨æ€ä»£ç†ï¼‰
    â”œâ”€ JDKåŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰
    â””â”€ CGLIBä»£ç†ï¼ˆåŸºäºç»§æ‰¿ï¼‰
```

---

### ä¸‰ã€å¤æ‚åº¦æ¥æºåˆ†æï¼ˆ5000å­—ï¼‰

**ç›®æ ‡**: æ·±åº¦å‰–æSpringè§£å†³çš„5å¤§å¤æ‚åº¦é—®é¢˜

#### 3.1 ä¾èµ–å¤æ‚åº¦ï¼šæ‰‹åŠ¨ç®¡ç† vs IoCå®¹å™¨

**æ‰‹åŠ¨ç®¡ç†ä¾èµ–çš„å›°å¢ƒ**:
```java
// åœºæ™¯ï¼šè®¢å•æœåŠ¡ä¾èµ–5ä¸ªå…¶ä»–æœåŠ¡
public class OrderService {
    private UserService userService;
    private ProductService productService;
    private InventoryService inventoryService;
    private PaymentService paymentService;
    private NotificationService notificationService;

    // é—®é¢˜1ï¼šæ„é€ å‡½æ•°è†¨èƒ€
    public OrderService() {
        // æ¯ä¸ªä¾èµ–éƒ½è¦æ‰‹åŠ¨newï¼Œä¸”éœ€è¦ä¼ å…¥å®ƒä»¬çš„ä¾èµ–
        this.userService = new UserService(new UserRepository());
        this.productService = new ProductService(new ProductRepository());
        this.inventoryService = new InventoryService(
            new InventoryRepository(),
            new RedisClient()
        );
        this.paymentService = new AlipayPaymentService(
            new AlipayConfig()
        );
        this.notificationService = new EmailNotificationService(
            new EmailConfig()
        );
    }

    // é—®é¢˜2ï¼šä¾èµ–å±‚çº§æ·±
    // OrderService â†’ InventoryService â†’ RedisClient â†’ JedisPool
    // æ¯å¢åŠ ä¸€å±‚ï¼Œæ„é€ å‡½æ•°éƒ½è¦æ”¹

    // é—®é¢˜3ï¼šé…ç½®ç¡¬ç¼–ç 
    // AlipayConfigã€EmailConfigå†™æ­»åœ¨ä»£ç é‡Œ

    // é—®é¢˜4ï¼šæ— æ³•åˆ‡æ¢å®ç°
    // æƒ³æ¢æˆå¾®ä¿¡æ”¯ä»˜ï¼Ÿéœ€è¦ä¿®æ”¹ä»£ç å¹¶é‡æ–°ç¼–è¯‘
}
```

**IoCå®¹å™¨çš„è§£å†³æ–¹æ¡ˆ**:
```java
// Spring IoCå®¹å™¨ç®¡ç†ä¾èµ–
@Service
public class OrderService {

    @Autowired
    private UserService userService;

    @Autowired
    private ProductService productService;

    @Autowired
    private InventoryService inventoryService;

    @Autowired
    private PaymentService paymentService;  // æ¥å£

    @Autowired
    private NotificationService notificationService;  // æ¥å£

    // ä¼˜åŠ¿ï¼š
    // 1. å®¹å™¨è‡ªåŠ¨åˆ›å»ºå’Œæ³¨å…¥ä¾èµ–
    // 2. ä¾èµ–å±‚çº§ç”±å®¹å™¨ç®¡ç†ï¼Œä¸šåŠ¡ä»£ç æ— æ„ŸçŸ¥
    // 3. é…ç½®å¤–éƒ¨åŒ–ï¼ˆapplication.ymlï¼‰
    // 4. å®ç°å¯æ›¿æ¢ï¼ˆé…ç½®æ–‡ä»¶å†³å®šæ³¨å…¥å“ªä¸ªå®ç°ç±»ï¼‰
}

// é…ç½®æ–‡ä»¶åˆ‡æ¢å®ç°
# application.yml
payment:
  type: alipay  # åˆ‡æ¢ä¸º wechat æ— éœ€ä¿®æ”¹ä»£ç 
```

**ä¾èµ–å¤æ‚åº¦å¯¹æ¯”**:
| ç»´åº¦ | æ‰‹åŠ¨ç®¡ç† | IoCå®¹å™¨ | å·®å¼‚ |
|------|---------|---------|------|
| ä¾èµ–åˆ›å»º | newå…³é”®å­—ï¼ˆç¡¬ç¼–ç ï¼‰ | @Autowiredè‡ªåŠ¨æ³¨å…¥ | è§£è€¦ |
| é…ç½®æ–¹å¼ | ä»£ç ä¸­newï¼ˆç¡¬ç¼–ç ï¼‰ | application.yml | å¤–éƒ¨åŒ– |
| å®ç°åˆ‡æ¢ | ä¿®æ”¹ä»£ç +é‡æ–°ç¼–è¯‘ | ä¿®æ”¹é…ç½®æ–‡ä»¶ | æ— ä¾µå…¥ |
| å•å…ƒæµ‹è¯• | éš¾ï¼ˆæ— æ³•mockï¼‰ | æ˜“ï¼ˆæ³¨å…¥mockå¯¹è±¡ï¼‰ | 10å€ |
| ä¾èµ–å±‚çº§ | æ‰‹åŠ¨ç»´æŠ¤ï¼ˆæ˜“å‡ºé”™ï¼‰ | å®¹å™¨è‡ªåŠ¨ç®¡ç† | è‡ªåŠ¨åŒ– |

#### 3.2 é…ç½®å¤æ‚åº¦ï¼šç¡¬ç¼–ç  vs å¤–éƒ¨é…ç½®

**é…ç½®ç¡¬ç¼–ç çš„é—®é¢˜**:
```java
// é—®é¢˜ï¼šæ•°æ®åº“é…ç½®ç¡¬ç¼–ç 
public class DataSourceConfig {
    public DataSource getDataSource() {
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");  // ç¡¬ç¼–ç 
        ds.setUsername("root");  // ç¡¬ç¼–ç 
        ds.setPassword("123456");  // ç¡¬ç¼–ç ï¼ˆå®‰å…¨é£é™©ï¼‰
        ds.setMaximumPoolSize(20);
        return ds;
    }
}

é—®é¢˜æ¸…å•ï¼š
â”œâ”€ ç¯å¢ƒåˆ‡æ¢å›°éš¾ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸åŒé…ç½®ï¼‰
â”œâ”€ å®‰å…¨é£é™©ï¼ˆå¯†ç æ˜æ–‡å†™åœ¨ä»£ç é‡Œï¼‰
â”œâ”€ ä¿®æ”¹éœ€è¦é‡æ–°ç¼–è¯‘
â””â”€ é…ç½®åˆ†æ•£ï¼ˆæ•°æ®åº“ã€Redisã€MQé…ç½®æ•£è½å„å¤„ï¼‰
```

**Springé…ç½®å¤–éƒ¨åŒ–**:
```yaml
# application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb_dev
    username: root
    password: ${DB_PASSWORD}  # ç¯å¢ƒå˜é‡ï¼ˆå®‰å…¨ï¼‰
    hikari:
      maximum-pool-size: 10

# application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/mydb_prod
    username: app_user
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 50
```

```java
// é…ç½®ç±»ï¼šè¯»å–å¤–éƒ¨é…ç½®
@Configuration
public class DataSourceConfig {

    @Bean
    @ConfigurationProperties(prefix = "spring.datasource.hikari")
    public DataSource dataSource() {
        return DataSourceBuilder.create().build();
    }
}
```

**é…ç½®ä¼˜å…ˆçº§**ï¼ˆä»é«˜åˆ°ä½ï¼‰:
```
1. å‘½ä»¤è¡Œå‚æ•°ï¼šjava -jar app.jar --server.port=8081
2. ç¯å¢ƒå˜é‡ï¼šexport SERVER_PORT=8081
3. application-{profile}.yml
4. application.yml
5. @PropertySourceæŒ‡å®šçš„æ–‡ä»¶
6. é»˜è®¤å€¼
```

#### 3.3 åˆ‡é¢å¤æ‚åº¦ï¼šä»£ç é‡å¤ vs AOP

**æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä»£ç é‡å¤**:
```java
// é—®é¢˜ï¼šäº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ä»£ç é‡å¤
public class OrderService {

    public Order createOrder(OrderRequest request) {
        // ===== é‡å¤ä»£ç 1ï¼šæ—¥å¿— =====
        log.info("å¼€å§‹åˆ›å»ºè®¢å•: {}", request);
        long start = System.currentTimeMillis();

        try {
            // ===== é‡å¤ä»£ç 2ï¼šæƒé™ =====
            User user = getCurrentUser();
            if (!user.hasPermission("CREATE_ORDER")) {
                throw new PermissionException();
            }

            // ===== é‡å¤ä»£ç 3ï¼šå‚æ•°æ ¡éªŒ =====
            if (request.getProductId() == null) {
                throw new ValidationException();
            }

            // ===== é‡å¤ä»£ç 4ï¼šäº‹åŠ¡ =====
            Connection conn = getConnection();
            try {
                conn.setAutoCommit(false);

                // ===== æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆåªå 20%ï¼‰ =====
                Order order = new Order();
                order.setUserId(request.getUserId());
                order.setProductId(request.getProductId());
                saveOrder(order, conn);

                conn.commit();
                return order;
            } catch (Exception e) {
                conn.rollback();
                throw e;
            }

        } finally {
            // ===== é‡å¤ä»£ç 5ï¼šæ—¥å¿— =====
            log.info("è®¢å•åˆ›å»ºå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
        }
    }

    // å…¶ä»–æ–¹æ³•ï¼ˆupdateOrderã€cancelOrderï¼‰ä¹Ÿæœ‰åŒæ ·çš„é‡å¤ä»£ç 
}

ç»Ÿè®¡ï¼š
  æ€»ä»£ç ï¼š100è¡Œ
  æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼š20è¡Œï¼ˆ20%ï¼‰
  æ¡†æ¶ä»£ç ï¼ˆäº‹åŠ¡ã€æ—¥å¿—ã€æƒé™ï¼‰ï¼š80è¡Œï¼ˆ80%ï¼‰
```

**AOPçš„è§£å†³æ–¹æ¡ˆ**:
```java
// ä¸šåŠ¡ä»£ç ï¼šçº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘
@Service
@Transactional
public class OrderService {

    @RequirePermission("CREATE_ORDER")
    @Loggable
    public Order createOrder(@Valid OrderRequest request) {
        // 100%ä¸šåŠ¡é€»è¾‘ï¼Œæ— ä»»ä½•æ¡†æ¶ä»£ç 
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        return orderRepository.save(order);
    }
}

// åˆ‡é¢ä»£ç ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹æŠ½å–ä¸ºåˆ‡é¢
@Aspect
@Component
public class LoggingAspect {

    @Around("@annotation(loggable)")
    public Object logMethod(ProceedingJoinPoint pjp, Loggable loggable) {
        log.info("å¼€å§‹æ‰§è¡Œ: {}", pjp.getSignature());
        long start = System.currentTimeMillis();
        try {
            Object result = pjp.proceed();
            log.info("æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
            return result;
        } catch (Throwable e) {
            log.error("æ‰§è¡Œå¼‚å¸¸", e);
            throw e;
        }
    }
}

ç»Ÿè®¡ï¼š
  ä¸šåŠ¡ä»£ç ï¼š20è¡Œï¼ˆ100%ä¸šåŠ¡é€»è¾‘ï¼‰
  åˆ‡é¢ä»£ç ï¼š15è¡Œï¼ˆå¤ç”¨äºæ‰€æœ‰æ–¹æ³•ï¼‰
  ä»£ç å‡å°‘ï¼šä»100è¡Œ â†’ 20è¡Œï¼ˆå‡å°‘80%ï¼‰
```

**AOPçš„å®ç°åŸç†**:
```java
// 1. JDKåŠ¨æ€ä»£ç†ï¼ˆåŸºäºæ¥å£ï¼‰
public class JdkProxyExample {
    public static void main(String[] args) {
        UserService target = new UserServiceImpl();

        UserService proxy = (UserService) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy, method, args) -> {
                System.out.println("Before: " + method.getName());
                Object result = method.invoke(target, args);
                System.out.println("After: " + method.getName());
                return result;
            }
        );

        proxy.createUser();  // ä»£ç†å¯¹è±¡å¢å¼ºäº†æ–¹æ³•
    }
}

// 2. CGLIBä»£ç†ï¼ˆåŸºäºç»§æ‰¿ï¼Œä¸éœ€è¦æ¥å£ï¼‰
public class CglibProxyExample {
    public static void main(String[] args) {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(UserService.class);
        enhancer.setCallback(new MethodInterceptor() {
            @Override
            public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) {
                System.out.println("Before: " + method.getName());
                Object result = proxy.invokeSuper(obj, args);
                System.out.println("After: " + method.getName());
                return result;
            }
        });

        UserService proxy = (UserService) enhancer.create();
        proxy.createUser();
    }
}
```

#### 3.4 æµ‹è¯•å¤æ‚åº¦ï¼šå¼ºè€¦åˆ vs ä¾èµ–æ³¨å…¥

**å¼ºè€¦åˆä»£ç éš¾ä»¥æµ‹è¯•**:
```java
// é—®é¢˜ï¼šOrderServiceå¼ºä¾èµ–PaymentService
public class OrderService {
    private PaymentService paymentService = new AlipayPaymentService();

    public Order createOrder(OrderRequest request) {
        // ...
        boolean success = paymentService.pay(order.getAmount());
        // ...
    }
}

// å•å…ƒæµ‹è¯•å›°å¢ƒ
public class OrderServiceTest {
    @Test
    public void testCreateOrder() {
        OrderService service = new OrderService();

        // é—®é¢˜ï¼šæ— æ³•mock PaymentService
        // æµ‹è¯•æ—¶ä¼šçœŸå®è°ƒç”¨æ”¯ä»˜å®æ¥å£ï¼ˆä¸å¯æ¥å—ï¼‰
        // æ— æ³•æ¨¡æ‹Ÿæ”¯ä»˜å¤±è´¥çš„åœºæ™¯

        service.createOrder(request);
    }
}
```

**ä¾èµ–æ³¨å…¥è®©æµ‹è¯•å˜ç®€å•**:
```java
// OrderServiceï¼šä¾èµ–æ³¨å…¥
@Service
public class OrderService {

    @Autowired
    private PaymentService paymentService;  // æ¥å£ï¼Œå¯æ›¿æ¢

    public Order createOrder(OrderRequest request) {
        // ...
        boolean success = paymentService.pay(order.getAmount());
        // ...
    }
}

// å•å…ƒæµ‹è¯•ï¼šæ³¨å…¥Mockå¯¹è±¡
@SpringBootTest
public class OrderServiceTest {

    @Autowired
    private OrderService orderService;

    @MockBean  // Spring Bootæä¾›çš„mockæ³¨è§£
    private PaymentService paymentService;

    @Test
    public void testCreateOrder_Success() {
        // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
        when(paymentService.pay(anyDouble())).thenReturn(true);

        Order order = orderService.createOrder(request);

        assertNotNull(order);
        verify(paymentService).pay(anyDouble());
    }

    @Test
    public void testCreateOrder_PaymentFailed() {
        // æ¨¡æ‹Ÿæ”¯ä»˜å¤±è´¥
        when(paymentService.pay(anyDouble())).thenReturn(false);

        assertThrows(PaymentException.class, () -> {
            orderService.createOrder(request);
        });
    }
}
```

**å¯æµ‹è¯•æ€§å¯¹æ¯”**:
| ç»´åº¦ | å¼ºè€¦åˆ | ä¾èµ–æ³¨å…¥ | å·®å¼‚ |
|------|-------|---------|------|
| Mockèƒ½åŠ› | æ— æ³•mockä¾èµ– | å¯ä»¥æ³¨å…¥Mockå¯¹è±¡ | è´¨çš„é£è·ƒ |
| æµ‹è¯•éš”ç¦» | ä¾èµ–çœŸå®æœåŠ¡ï¼ˆæ•°æ®åº“ã€ç¬¬ä¸‰æ–¹APIï¼‰ | éš”ç¦»ä¾èµ–ï¼Œåªæµ‹è¯•å½“å‰ç±» | çº¯ç²¹ |
| æµ‹è¯•é€Ÿåº¦ | æ…¢ï¼ˆè°ƒç”¨çœŸå®æœåŠ¡ï¼‰ | å¿«ï¼ˆå†…å­˜ä¸­mockï¼‰ | 100å€ |
| æµ‹è¯•è¦†ç›– | éš¾ä»¥æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯ | å¯ä»¥æ¨¡æ‹Ÿä»»ä½•åœºæ™¯ | å®Œæ•´ |

---

### å››ã€ä¸ºä»€ä¹ˆæ˜¯Springï¼Ÿï¼ˆ2000å­—ï¼‰

#### 4.1 å¯¹æ¯”å…¶ä»–ä¾èµ–æ³¨å…¥æ¡†æ¶

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|-----|------|---------|
| **Spring** | ç”Ÿæ€å®Œå–„ã€åŠŸèƒ½å¼ºå¤§ã€ç¤¾åŒºæ´»è·ƒ | å­¦ä¹ æ›²çº¿é™¡å³­ | ä¼ä¸šçº§åº”ç”¨ |
| **Google Guice** | è½»é‡ã€å¯åŠ¨å¿« | ç”Ÿæ€ä¸å¦‚Spring | å°å‹åº”ç”¨ |
| **CDI** | JavaEEæ ‡å‡† | ä¾èµ–JavaEEå®¹å™¨ | JavaEEåº”ç”¨ |
| **Dagger** | ç¼–è¯‘æ—¶ä¾èµ–æ³¨å…¥ã€æ€§èƒ½é«˜ | Androidä¸“ç”¨ | Androidå¼€å‘ |

#### 4.2 Springçš„æ ¸å¿ƒä¼˜åŠ¿

**ä¼˜åŠ¿1ï¼šç”Ÿæ€å®Œå–„**
```
Springç”Ÿæ€ç³»ç»Ÿï¼š
â”œâ”€â”€ Spring Frameworkï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ Spring Bootï¼ˆå¿«é€Ÿå¼€å‘ï¼‰
â”œâ”€â”€ Spring Cloudï¼ˆå¾®æœåŠ¡ï¼‰
â”œâ”€â”€ Spring Dataï¼ˆæ•°æ®è®¿é—®ï¼‰
â”œâ”€â”€ Spring Securityï¼ˆå®‰å…¨ï¼‰
â”œâ”€â”€ Spring Batchï¼ˆæ‰¹å¤„ç†ï¼‰
â””â”€â”€ Spring Integrationï¼ˆé›†æˆï¼‰

å¯¹æ¯”ï¼š
  Guiceï¼šåªæœ‰ä¾èµ–æ³¨å…¥ï¼Œæ²¡æœ‰ç”Ÿæ€
  Springï¼šä»å¼€å‘åˆ°éƒ¨ç½²çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ
```

**ä¼˜åŠ¿2ï¼šçº¦å®šä¼˜äºé…ç½®**
```
ä¼ ç»ŸSpringï¼ˆXMLé…ç½®ï¼‰ï¼š
  éœ€è¦é…ç½®æ¯ä¸ªBeanã€æ¯ä¸ªä¾èµ–å…³ç³»

Spring Bootï¼ˆçº¦å®šä¼˜äºé…ç½®ï¼‰ï¼š
  @SpringBootApplication â†’ è‡ªåŠ¨æ‰«æ
  application.yml â†’ è‡ªåŠ¨é…ç½®
  Starter â†’ ä¸€é”®å¼•å…¥æ•´å¥—ç»„ä»¶
```

**ä¼˜åŠ¿3ï¼šç¤¾åŒºæ´»è·ƒ**
```
æ•°æ®å¯¹æ¯”ï¼ˆ2024ï¼‰ï¼š
â”œâ”€â”€ GitHub Starsï¼šSpring Framework 54k+ï¼ŒGuice 12k
â”œâ”€â”€ Stack Overflowé—®é¢˜æ•°ï¼šSpring 100ä¸‡+ï¼ŒGuice 5ä¸‡
â”œâ”€â”€ ä¼ä¸šé‡‡ç”¨ç‡ï¼šSpring 80%+ï¼ŒGuice <10%
â””â”€â”€ æ›´æ–°é¢‘ç‡ï¼šSpringæ¯å¹´2ä¸ªå¤§ç‰ˆæœ¬ï¼ŒGuiceä¸æ´»è·ƒ
```

---

### äº”ã€æ€»ç»“ä¸æ–¹æ³•è®ºï¼ˆ2000å­—ï¼‰

#### 5.1 ç¬¬ä¸€æ€§åŸç†æ€ç»´çš„åº”ç”¨

**ä»æœ¬è´¨é—®é¢˜å‡ºå‘**:
```
é—®é¢˜ï¼šæˆ‘åº”è¯¥å­¦Springå—ï¼Ÿ

é”™è¯¯æ€è·¯ï¼ˆä»ç°è±¡å‡ºå‘ï¼‰ï¼š
â”œâ”€ å¤§å®¶éƒ½åœ¨ç”¨Spring
â”œâ”€ æ‹›è˜è¦æ±‚å¿…é¡»ä¼šSpring
â””â”€ æˆ‘ä¹Ÿè¦å­¦

æ­£ç¡®æ€è·¯ï¼ˆä»æœ¬è´¨å‡ºå‘ï¼‰ï¼š
â”œâ”€ Springè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
â”‚   â”œâ”€ ä¾èµ–ç®¡ç†ï¼ˆIoCï¼‰
â”‚   â”œâ”€ æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆAOPï¼‰
â”‚   â”œâ”€ é…ç½®ç®¡ç†ï¼ˆå¤–éƒ¨åŒ–é…ç½®ï¼‰
â”‚   â””â”€ ä¼ä¸šçº§ç‰¹æ€§ï¼ˆäº‹åŠ¡ã€å®‰å…¨ã€æ•°æ®è®¿é—®ï¼‰
â”œâ”€ è¿™äº›é—®é¢˜æˆ‘ä¼šé‡åˆ°å—ï¼Ÿ
â”‚   â””â”€ å†™ä¼ä¸šçº§åº”ç”¨å¿…ç„¶é‡åˆ°
â”œâ”€ æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ
â”‚   â””â”€ Springæ˜¯æœ€æˆç†Ÿçš„æ–¹æ¡ˆ
â””â”€ ç»“è®ºï¼šç†è§£åŸç†åå†å­¦Spring
```

#### 5.2 æ¸è¿›å¼å­¦ä¹ è·¯å¾„

**ä¸è¦ä¸€æ¬¡æ€§å­¦æ‰€æœ‰å†…å®¹**:
```
é˜¶æ®µ1ï¼šç†è§£IoCï¼ˆ1-2å‘¨ï¼‰
â”œâ”€ æ‰‹å†™ä¸€ä¸ªç®€å•çš„IoCå®¹å™¨
â”œâ”€ ç†è§£ä¾èµ–æ³¨å…¥çš„ä»·å€¼
â””â”€ æŒæ¡@Autowiredã€@Component

é˜¶æ®µ2ï¼šç†è§£AOPï¼ˆ1-2å‘¨ï¼‰
â”œâ”€ æ‰‹å†™JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†
â”œâ”€ ç†è§£@Aspectã€@Around
â””â”€ å®ç°ä¸€ä¸ªè‡ªå®šä¹‰æ—¥å¿—åˆ‡é¢

é˜¶æ®µ3ï¼šSpring Bootï¼ˆ2-3å‘¨ï¼‰
â”œâ”€ ç†è§£è‡ªåŠ¨é…ç½®åŸç†
â”œâ”€ æŒæ¡application.ymlé…ç½®
â””â”€ å¼€å‘ä¸€ä¸ªå®Œæ•´çš„RESTful API

é˜¶æ®µ4ï¼šSpring Cloudï¼ˆ4-6å‘¨ï¼‰
â”œâ”€ ç†è§£å¾®æœåŠ¡æ¶æ„
â”œâ”€ æŒæ¡æœåŠ¡æ³¨å†Œä¸å‘ç°
â””â”€ å®ç°ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®

ä¸è¦è·³çº§ï¼ˆåŸºç¡€ä¸ç‰¢åœ°åŠ¨å±±æ‘‡ï¼‰
```

#### 5.3 ç»™ä»ä¸šè€…çš„å»ºè®®

**æŠ€æœ¯è§†è§’ï¼šæ„å»ºä»€ä¹ˆèƒ½åŠ›ï¼Ÿ**
```
L1ï¼ˆå¿…å¤‡èƒ½åŠ›ï¼‰ï¼š
â”œâ”€ ç†è§£IoCå’ŒDIåŸç†
â”œâ”€ æŒæ¡Spring Bootå¼€å‘
â”œâ”€ ç†Ÿæ‚‰å¸¸ç”¨æ³¨è§£ï¼ˆ@Autowiredã€@Transactionalï¼‰
â””â”€ èƒ½ç‹¬ç«‹å¼€å‘Webåº”ç”¨

L2ï¼ˆè¿›é˜¶èƒ½åŠ›ï¼‰ï¼š
â”œâ”€ ç†è§£AOPåŸç†å’Œåº”ç”¨
â”œâ”€ æŒæ¡Spring MVCæµç¨‹
â”œâ”€ ç†Ÿæ‚‰Spring Data JPA
â””â”€ èƒ½è¿›è¡Œæ€§èƒ½è°ƒä¼˜

L3ï¼ˆé«˜çº§èƒ½åŠ›ï¼‰ï¼š
â”œâ”€ é˜…è¯»Springæºç 
â”œâ”€ æŒæ¡Spring Cloudå¾®æœåŠ¡
â”œâ”€ èƒ½è®¾è®¡å¾®æœåŠ¡æ¶æ„
â””â”€ èƒ½è§£å†³å¤æ‚é—®é¢˜

å»ºè®®ï¼šä»L1å¼€å§‹ï¼Œé€æ­¥ç§¯ç´¯L2ã€L3èƒ½åŠ›
```

---

## ğŸ“Š è¿›åº¦è¿½è¸ª

### æ€»ä½“è¿›åº¦
- âœ… è§„åˆ’æ–‡æ¡£ï¼šå·²å®Œæˆï¼ˆ2025-11-03ï¼‰
- âœ… æ–‡ç« 1ï¼šå·²å®Œæˆï¼ˆ2025-11-03ï¼Œ16,000å­—ï¼‰
- âœ… æ–‡ç« 2ï¼šå·²å®Œæˆï¼ˆ2025-11-03ï¼Œ17,000å­—ï¼‰
- âœ… æ–‡ç« 3ï¼šå·²å®Œæˆï¼ˆ2025-11-03ï¼Œ16,000å­—ï¼‰
- â³ æ–‡ç« 4ï¼šå¾…å†™ä½œ
- â³ æ–‡ç« 5ï¼šå¾…å†™ä½œ
- â³ æ–‡ç« 6ï¼šå¾…å†™ä½œ

**å½“å‰è¿›åº¦**ï¼š3/6ï¼ˆ50%ï¼‰
**ç´¯è®¡å­—æ•°**ï¼š49,000å­—ï¼ˆä¸å«è§„åˆ’ï¼‰
**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š2025-12-XX

### å·²å®Œæˆ
- âœ… 2025-11-03ï¼šåˆ›å»ºæ€»ä½“è§„åˆ’æ–‡æ¡£
- âœ… 2025-11-03ï¼šå®Œæˆæ–‡ç« 1ã€ŠSpringç¬¬ä¸€æ€§åŸç†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ¡†æ¶ï¼Ÿã€‹ï¼ˆ16,000å­—ï¼‰
- âœ… 2025-11-03ï¼šå®Œæˆæ–‡ç« 2ã€ŠIoCå®¹å™¨æ·±åº¦è§£æï¼šä»æ‰‹åŠ¨newåˆ°è‡ªåŠ¨è£…é…çš„æ¼”è¿›ã€‹ï¼ˆ17,000å­—ï¼‰
- âœ… 2025-11-03ï¼šå®Œæˆæ–‡ç« 3ã€ŠAOPæ·±åº¦è§£æï¼šä»ä»£ç é‡å¤åˆ°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‹ï¼ˆ16,000å­—ï¼‰

---

## ğŸ¨ å†™ä½œé£æ ¼æŒ‡å—

### 1. è¯­è¨€é£æ ¼
- âœ… ç”¨"ä¸ºä»€ä¹ˆ"å¼•å¯¼ï¼Œè€Œé"æ˜¯ä»€ä¹ˆ"å †ç Œ
- âœ… ç”¨ç±»æ¯”é™ä½ç†è§£é—¨æ§›ï¼ˆå¯¹æ¯”çº¯Java vs Springï¼‰
- âœ… ç”¨æ•°æ®å¢å¼ºè¯´æœåŠ›ï¼ˆä»£ç è¡Œæ•°å¯¹æ¯”ã€æ€§èƒ½æ•°æ®ï¼‰
- âœ… ç”¨æ¡ˆä¾‹æå‡å¯è¯»æ€§ï¼ˆçœŸå®ä¸šåŠ¡åœºæ™¯ï¼‰

### 2. ç»“æ„é£æ ¼
- âœ… é‡‘å­—å¡”åŸç†ï¼ˆç»“è®ºå…ˆè¡Œï¼‰
- âœ… æ¸è¿›å¼å¤æ‚åº¦ï¼ˆä»ç®€å•åˆ°å¤æ‚ï¼‰
- âœ… å¯¹æ¯”å¼è®ºè¯ï¼ˆæ‰‹åŠ¨ç®¡ç† vs Springï¼‰
- âœ… å¤šå±‚æ¬¡æ‹†è§£ï¼ˆä¸è¶…è¿‡3å±‚ï¼‰

### 3. æ¡ˆä¾‹é£æ ¼
- âœ… çœŸå®æ¡ˆä¾‹ï¼ˆè®¢å•æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ï¼‰
- âœ… å®Œæ•´æ¨å¯¼ï¼ˆä»é—®é¢˜åˆ°è§£å†³æ–¹æ¡ˆï¼‰
- âœ… å¤šè§’åº¦åˆ†æï¼ˆä¾èµ–ã€é…ç½®ã€æµ‹è¯•ã€æ€§èƒ½ï¼‰

---

## ğŸ“ å†™ä½œæ£€æŸ¥æ¸…å•

### æ¯ç¯‡æ–‡ç« å®Œæˆå‰æ£€æŸ¥
- [ ] æ˜¯å¦ä»"ä¸ºä»€ä¹ˆ"å‡ºå‘ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å…·ä½“æ•°å­—æ”¯æ’‘ï¼Ÿï¼ˆä»£ç è¡Œæ•°ã€æ€§èƒ½æå‡ï¼‰
- [ ] æ˜¯å¦æœ‰çœŸå®æ¡ˆä¾‹ï¼Ÿï¼ˆä¸šåŠ¡åœºæ™¯ï¼‰
- [ ] æ˜¯å¦æœ‰ç±»æ¯”é™ä½é—¨æ§›ï¼Ÿï¼ˆå¯¹æ¯”çº¯Java vs Springï¼‰
- [ ] æ˜¯å¦æœ‰å¯¹æ¯”çªå‡ºå·®å¼‚ï¼Ÿï¼ˆæ‰‹åŠ¨ç®¡ç† vs è‡ªåŠ¨åŒ–ï¼‰
- [ ] æ˜¯å¦æœ‰æ¨å¯¼è¿‡ç¨‹ï¼Ÿï¼ˆä»é—®é¢˜åˆ°è§£å†³æ–¹æ¡ˆï¼‰
- [ ] æ˜¯å¦æœ‰æƒè¡¡åˆ†æï¼Ÿï¼ˆä¸åŒæ–¹æ¡ˆçš„ä¼˜åŠ£ï¼‰
- [ ] æ˜¯å¦æœ‰å¯æ“ä½œå»ºè®®ï¼Ÿï¼ˆå­¦ä¹ è·¯å¾„ã€æœ€ä½³å®è·µï¼‰
- [ ] æ˜¯å¦ç¬¦åˆæ¸è¿›å¼å¤æ‚åº¦æ¨¡å‹ï¼Ÿ
- [ ] æ˜¯å¦ä¿æŒé€»è¾‘è¿è´¯æ€§ï¼Ÿ

---

## ğŸ“š å‚è€ƒèµ„æ–™

### ç»å…¸ä¹¦ç±
- ã€ŠSpringå®æˆ˜ï¼ˆç¬¬5ç‰ˆï¼‰ã€‹- Craig Walls
- ã€ŠSpring Bootç¼–ç¨‹æ€æƒ³ã€‹- å°é©¬å“¥
- ã€Šæ·±å…¥ç†è§£Spring Cloudä¸å¾®æœåŠ¡æ„å»ºã€‹- æ–¹å¿—æœ‹
- ã€ŠSpringæºç æ·±åº¦è§£æã€‹- éƒä½³

### å®˜æ–¹æ–‡æ¡£
- Spring Framework Reference Documentation
- Spring Boot Reference Documentation
- Spring Cloud Documentation

### å¼€æºé¡¹ç›®
- Spring Frameworkæºç 
- Spring Bootæºç 
- Spring Cloud Alibaba

---

## ğŸ”„ è¿­ä»£è®¡åˆ’

### ç¬¬ä¸€ç‰ˆï¼ˆåŸºç¡€ç‰ˆï¼‰
- å®Œæˆ6ç¯‡æ–‡ç« å¤§çº²
- å®Œæˆæ–‡ç« 1åˆç¨¿
- å¾æ±‚åé¦ˆ

### ç¬¬äºŒç‰ˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰
- æ ¹æ®åé¦ˆä¼˜åŒ–å†…å®¹
- è¡¥å……æ›´å¤šæ¡ˆä¾‹
- å®Œæˆå…¨éƒ¨6ç¯‡

### ç¬¬ä¸‰ç‰ˆï¼ˆç²¾åç‰ˆï¼‰
- æç‚¼æ–¹æ³•è®º
- åˆ¶ä½œæ€ç»´å¯¼å›¾
- å‘å¸ƒç³»åˆ—æ–‡ç« 

---

---

## ğŸ“– æ–‡ç« 2ï¼šã€ŠIoCå®¹å™¨æ¼”è¿›ã€‹- è¯¦ç»†å¤§çº²

### ä¸€ã€å¼•å­ï¼šä¾èµ–ç®¡ç†çš„å›°å¢ƒï¼ˆ3500å­—ï¼‰

**ç›®æ ‡**: é€šè¿‡5ä¸ªåœºæ™¯çš„æ¸è¿›æ¼”åŒ–ï¼Œç›´è§‚å±•ç¤ºIoCå®¹å™¨çš„å¿…è¦æ€§

#### 1.1 åœºæ™¯0ï¼šæœ€ç®€å•çš„è®¢å•æœåŠ¡ï¼ˆæ— ä¾èµ–ï¼‰

```java
// æœ€ç®€å•çš„è®¢å•æœåŠ¡ï¼ˆå•ä¸€èŒè´£ï¼Œæ— å¤–éƒ¨ä¾èµ–ï¼‰
public class OrderService {
    public Order createOrder(Long userId, Long productId) {
        Order order = new Order();
        order.setUserId(userId);
        order.setProductId(productId);
        order.setCreateTime(new Date());
        return order;
    }
}

// ä½¿ç”¨ï¼šç›´æ¥new
public class Main {
    public static void main(String[] args) {
        OrderService service = new OrderService();
        Order order = service.createOrder(1L, 100L);
    }
}

ç‰¹ç‚¹ï¼š
- ç®€å•ç›´æ¥
- æ— ä¾èµ–ç®¡ç†é—®é¢˜
- é€‚åˆå°å‹è„šæœ¬å’Œå·¥å…·
```

#### 1.2 åœºæ™¯1ï¼šå¼•å…¥ä¾èµ–ï¼ˆæ‰‹åŠ¨newï¼‰

```java
// è®¢å•æœåŠ¡ä¾èµ–ç”¨æˆ·æœåŠ¡å’Œäº§å“æœåŠ¡
public class OrderService {
    private UserService userService;
    private ProductService productService;

    // é—®é¢˜1ï¼šæ„é€ å‡½æ•°ä¸­ç¡¬ç¼–ç ä¾èµ–
    public OrderService() {
        this.userService = new UserService();
        this.productService = new ProductService();
    }

    public Order createOrder(Long userId, Long productId) {
        // éªŒè¯ç”¨æˆ·å­˜åœ¨
        User user = userService.getUser(userId);
        if (user == null) {
            throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        }

        // éªŒè¯äº§å“å­˜åœ¨
        Product product = productService.getProduct(productId);
        if (product == null) {
            throw new BusinessException("äº§å“ä¸å­˜åœ¨");
        }

        Order order = new Order();
        order.setUserId(userId);
        order.setProductId(productId);
        order.setAmount(product.getPrice());
        return order;
    }
}

// UserServiceä¹Ÿæœ‰ä¾èµ–
public class UserService {
    private UserRepository userRepository;

    public UserService() {
        // é—®é¢˜2ï¼šä¾èµ–å±‚çº§åŠ æ·±
        this.userRepository = new UserRepository();
    }
}

é—®é¢˜æ¸…å•ï¼š
â”œâ”€ å¼ºè€¦åˆï¼šOrderServiceç¡¬ç¼–ç ä¾èµ–UserServiceå’ŒProductService
â”œâ”€ éš¾ä»¥æµ‹è¯•ï¼šæ— æ³•æ³¨å…¥Mockå¯¹è±¡
â”œâ”€ ä¾èµ–é“¾ï¼šOrderService â†’ UserService â†’ UserRepositoryï¼ˆå±‚å±‚newï¼‰
â”œâ”€ å•ä¾‹å›°å¢ƒï¼šæ¯æ¬¡newéƒ½åˆ›å»ºæ–°å¯¹è±¡ï¼Œæµªè´¹èµ„æº
â””â”€ é…ç½®åˆ†æ•£ï¼šæ¯ä¸ªç±»çš„æ„é€ å‡½æ•°éƒ½è¦ç®¡ç†ä¾èµ–
```

#### 1.3 åœºæ™¯2ï¼šå¼•å…¥å·¥å‚æ¨¡å¼

```java
// æœåŠ¡å·¥å‚ï¼šç»Ÿä¸€ç®¡ç†å¯¹è±¡åˆ›å»º
public class ServiceFactory {
    private static UserService userService;
    private static ProductService productService;
    private static OrderService orderService;

    // é—®é¢˜ï¼šæ‰‹åŠ¨ç®¡ç†å•ä¾‹
    public static UserService getUserService() {
        if (userService == null) {
            userService = new UserService();
        }
        return userService;
    }

    public static ProductService getProductService() {
        if (productService == null) {
            productService = new ProductService();
        }
        return productService;
    }

    public static OrderService getOrderService() {
        if (orderService == null) {
            // é—®é¢˜ï¼šæ‰‹åŠ¨æ³¨å…¥ä¾èµ–
            orderService = new OrderService(
                getUserService(),
                getProductService()
            );
        }
        return orderService;
    }
}

// OrderServiceæ”¹ä¸ºæ„é€ å™¨æ³¨å…¥
public class OrderService {
    private final UserService userService;
    private final ProductService productService;

    // é€šè¿‡æ„é€ å™¨æ³¨å…¥ä¾èµ–
    public OrderService(UserService userService, ProductService productService) {
        this.userService = userService;
        this.productService = productService;
    }
}

// ä½¿ç”¨ï¼šä»å·¥å‚è·å–
public class Main {
    public static void main(String[] args) {
        OrderService service = ServiceFactory.getOrderService();
        Order order = service.createOrder(1L, 100L);
    }
}

æ”¹è¿›ï¼š
âœ… è§£è€¦ï¼šOrderServiceä¸å†ç›´æ¥newä¾èµ–
âœ… å•ä¾‹ï¼šå·¥å‚ç»Ÿä¸€ç®¡ç†å•ä¾‹
âœ… å¯æµ‹è¯•ï¼šå¯ä»¥é€šè¿‡æ„é€ å™¨æ³¨å…¥Mockå¯¹è±¡

ä»å­˜åœ¨çš„é—®é¢˜ï¼š
âŒ å·¥å‚ä»£ç è†¨èƒ€ï¼šæ¯å¢åŠ ä¸€ä¸ªæœåŠ¡ï¼Œå°±è¦å†™ä¸€ä¸ªé™æ€æ–¹æ³•
âŒ ä¾èµ–å…³ç³»ç¡¬ç¼–ç ï¼šä¾èµ–å…³ç³»å†™æ­»åœ¨å·¥å‚ä»£ç é‡Œ
âŒ æ— ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šæ²¡æœ‰åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒ
âŒ çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼šæ‡’æ±‰å¼å•ä¾‹éœ€è¦åŒé‡æ£€æŸ¥é”
```

#### 1.4 åœºæ™¯3ï¼šå¼•å…¥ç®€å•IoCå®¹å™¨ï¼ˆæ‰‹å†™ï¼‰

```java
// ç®€å•çš„IoCå®¹å™¨ï¼ˆ200è¡Œä»£ç ï¼‰
public class SimpleIoCContainer {
    // Beanå®šä¹‰ï¼šç±»å‹ â†’ Beanå®ä¾‹
    private Map<Class<?>, Object> singletonBeans = new ConcurrentHashMap<>();

    // æ³¨å†ŒBean
    public <T> void registerBean(Class<T> clazz) {
        try {
            // 1. å®ä¾‹åŒ–
            T instance = clazz.getDeclaredConstructor().newInstance();

            // 2. ä¾èµ–æ³¨å…¥ï¼ˆæ„é€ å™¨æ³¨å…¥ï¼‰
            Constructor<?>[] constructors = clazz.getConstructors();
            if (constructors.length > 0) {
                Constructor<?> constructor = constructors[0];
                Class<?>[] paramTypes = constructor.getParameterTypes();
                Object[] params = new Object[paramTypes.length];

                for (int i = 0; i < paramTypes.length; i++) {
                    params[i] = getBean(paramTypes[i]);  // é€’å½’è·å–ä¾èµ–
                }

                instance = (T) constructor.newInstance(params);
            }

            // 3. å­˜å…¥å®¹å™¨
            singletonBeans.put(clazz, instance);

        } catch (Exception e) {
            throw new RuntimeException("åˆ›å»ºBeanå¤±è´¥: " + clazz.getName(), e);
        }
    }

    // è·å–Bean
    public <T> T getBean(Class<T> clazz) {
        return (T) singletonBeans.get(clazz);
    }
}

// ä½¿ç”¨ç®€å•IoCå®¹å™¨
public class Main {
    public static void main(String[] args) {
        SimpleIoCContainer container = new SimpleIoCContainer();

        // æ³¨å†ŒBeanï¼ˆæŒ‰ä¾èµ–é¡ºåºï¼‰
        container.registerBean(UserRepository.class);
        container.registerBean(ProductRepository.class);
        container.registerBean(UserService.class);
        container.registerBean(ProductService.class);
        container.registerBean(OrderService.class);

        // è·å–Beanï¼ˆè‡ªåŠ¨æ³¨å…¥äº†ä¾èµ–ï¼‰
        OrderService service = container.getBean(OrderService.class);
        Order order = service.createOrder(1L, 100L);
    }
}

æ”¹è¿›ï¼š
âœ… è‡ªåŠ¨ä¾èµ–æ³¨å…¥ï¼šå®¹å™¨é€’å½’æ³¨å…¥ä¾èµ–
âœ… å•ä¾‹ç®¡ç†ï¼šå®¹å™¨ç»Ÿä¸€ç®¡ç†å•ä¾‹
âœ… ä»£ç ç®€æ´ï¼šä¸šåŠ¡ä»£ç æ— éœ€å…³å¿ƒä¾èµ–åˆ›å»º

ä»å­˜åœ¨çš„é—®é¢˜ï¼š
âŒ å¾ªç¯ä¾èµ–ï¼šAä¾èµ–Bï¼ŒBä¾èµ–Aä¼šæ­»å¾ªç¯
âŒ æ³¨å†Œé¡ºåºï¼šå¿…é¡»æŒ‰ä¾èµ–é¡ºåºæ³¨å†Œï¼ˆä¸å¤Ÿæ™ºèƒ½ï¼‰
âŒ æ— ä½œç”¨åŸŸï¼šåªæ”¯æŒå•ä¾‹ï¼Œä¸æ”¯æŒåŸå‹ï¼ˆæ¯æ¬¡newæ–°å¯¹è±¡ï¼‰
âŒ æ— ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼šæ²¡æœ‰åˆå§‹åŒ–/é”€æ¯é’©å­
âŒ æ— å­—æ®µæ³¨å…¥ï¼šåªæ”¯æŒæ„é€ å™¨æ³¨å…¥
```

#### 1.5 åœºæ™¯4ï¼šSpring IoCå®¹å™¨ï¼ˆå®Œæ•´æ–¹æ¡ˆï¼‰

```java
// Spring Beanå®šä¹‰ï¼ˆæ³¨è§£æ–¹å¼ï¼‰
@Component
public class UserService {
    @Autowired
    private UserRepository userRepository;

    @PostConstruct
    public void init() {
        System.out.println("UserServiceåˆå§‹åŒ–");
    }

    @PreDestroy
    public void destroy() {
        System.out.println("UserServiceé”€æ¯");
    }
}

@Component
public class OrderService {
    @Autowired
    private UserService userService;

    @Autowired
    private ProductService productService;

    public Order createOrder(Long userId, Long productId) {
        // ä¸šåŠ¡é€»è¾‘
    }
}

// Springå®¹å™¨å¯åŠ¨
@Configuration
@ComponentScan(basePackages = "com.example")
public class AppConfig {
}

public class Main {
    public static void main(String[] args) {
        // åˆ›å»ºSpringå®¹å™¨
        ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

        // è·å–Beanï¼ˆä¾èµ–å·²è‡ªåŠ¨æ³¨å…¥ï¼‰
        OrderService service = context.getBean(OrderService.class);
        Order order = service.createOrder(1L, 100L);
    }
}

Springçš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š
âœ… è‡ªåŠ¨æ‰«æï¼š@ComponentScanè‡ªåŠ¨å‘ç°Bean
âœ… è‡ªåŠ¨æ³¨å…¥ï¼š@Autowiredè‡ªåŠ¨æ³¨å…¥ä¾èµ–
âœ… å¾ªç¯ä¾èµ–ï¼šä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–
âœ… ç”Ÿå‘½å‘¨æœŸï¼š@PostConstruct/@PreDestroyå›è°ƒ
âœ… å¤šç§ä½œç”¨åŸŸï¼šå•ä¾‹ã€åŸå‹ã€è¯·æ±‚ã€ä¼šè¯
âœ… å¤šç§æ³¨å…¥æ–¹å¼ï¼šæ„é€ å™¨ã€Setterã€å­—æ®µæ³¨å…¥
âœ… æ¡ä»¶è£…é…ï¼š@ConditionalæŒ‰æ¡ä»¶åˆ›å»ºBean
âœ… å»¶è¿ŸåŠ è½½ï¼š@Lazyå»¶è¿Ÿåˆå§‹åŒ–
```

#### 1.6 äº”ä¸ªåœºæ™¯å¯¹æ¯”æ€»ç»“

| åœºæ™¯ | ä¾èµ–ç®¡ç† | å•ä¾‹ | æµ‹è¯• | ç”Ÿå‘½å‘¨æœŸ | å¾ªç¯ä¾èµ– | ä»£ç é‡ |
|------|---------|-----|------|---------|---------|--------|
| åœºæ™¯0ï¼ˆæ— ä¾èµ–ï¼‰| æ—  | æ—  | ç®€å• | æ—  | æ—  | 10è¡Œ |
| åœºæ™¯1ï¼ˆæ‰‹åŠ¨newï¼‰| ç¡¬ç¼–ç  | æ—  | éš¾ | æ—  | æ—  | 50è¡Œ |
| åœºæ™¯2ï¼ˆå·¥å‚ï¼‰| å·¥å‚ | æ‰‹åŠ¨ | è¾ƒæ˜“ | æ—  | æ—  | 100è¡Œ |
| åœºæ™¯3ï¼ˆç®€å•IoCï¼‰| å®¹å™¨ | è‡ªåŠ¨ | æ˜“ | æ—  | ä¸æ”¯æŒ | 200è¡Œ |
| åœºæ™¯4ï¼ˆSpringï¼‰| å®¹å™¨ | è‡ªåŠ¨ | æ˜“ | å®Œæ•´ | æ”¯æŒ | 20è¡Œ |

---

### äºŒã€IoCå®¹å™¨æ ¸å¿ƒåŸç†ï¼ˆ4500å­—ï¼‰

**ç›®æ ‡**: æ·±åº¦å‰–æSpring IoCå®¹å™¨çš„å®ç°æœºåˆ¶

#### 2.1 IoCå®¹å™¨çš„æ ¸å¿ƒæ¥å£

```java
// BeanFactoryï¼šæœ€åŸºç¡€çš„å®¹å™¨æ¥å£
public interface BeanFactory {
    Object getBean(String name);
    <T> T getBean(Class<T> requiredType);
    boolean containsBean(String name);
    boolean isSingleton(String name);
}

// ApplicationContextï¼šåŠŸèƒ½æ›´å¼ºå¤§çš„å®¹å™¨æ¥å£
public interface ApplicationContext extends BeanFactory {
    String[] getBeanDefinitionNames();
    Environment getEnvironment();
    ApplicationEventPublisher getApplicationEventPublisher();
    Resource[] getResources(String locationPattern);
}

// å±‚çº§å…³ç³»ï¼š
BeanFactoryï¼ˆåŸºç¡€å®¹å™¨ï¼‰
    â†“ æ‰©å±•
ApplicationContextï¼ˆé«˜çº§å®¹å™¨ï¼‰
    â”œâ”€ AnnotationConfigApplicationContextï¼ˆæ³¨è§£é…ç½®ï¼‰
    â”œâ”€ ClassPathXmlApplicationContextï¼ˆXMLé…ç½®ï¼‰
    â””â”€ WebApplicationContextï¼ˆWebåº”ç”¨ï¼‰
```

**BeanFactory vs ApplicationContextå¯¹æ¯”**:
| ç‰¹æ€§ | BeanFactory | ApplicationContext |
|------|------------|-------------------|
| BeanåŠ è½½ | æ‡’åŠ è½½ï¼ˆä½¿ç”¨æ—¶åˆ›å»ºï¼‰| é¥¿æ±‰åŠ è½½ï¼ˆå®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼‰|
| å›½é™…åŒ– | ä¸æ”¯æŒ | æ”¯æŒï¼ˆMessageSourceï¼‰|
| äº‹ä»¶æœºåˆ¶ | ä¸æ”¯æŒ | æ”¯æŒï¼ˆApplicationEventï¼‰|
| AOP | éœ€æ‰‹åŠ¨å¤„ç† | è‡ªåŠ¨å¤„ç†ï¼ˆBeanPostProcessorï¼‰|
| é€‚ç”¨åœºæ™¯ | èµ„æºå—é™ç¯å¢ƒï¼ˆæ‰‹æœºï¼‰| ä¼ä¸šçº§åº”ç”¨ |

#### 2.2 Beançš„å®šä¹‰ä¸æ³¨å†Œ

```java
// Beanå®šä¹‰ï¼šæè¿°Beançš„å…ƒæ•°æ®
public interface BeanDefinition {
    String getBeanClassName();              // ç±»å
    String getScope();                      // ä½œç”¨åŸŸï¼ˆå•ä¾‹/åŸå‹ï¼‰
    boolean isSingleton();
    boolean isPrototype();
    boolean isLazyInit();                   // æ˜¯å¦æ‡’åŠ è½½
    String[] getDependsOn();                // ä¾èµ–çš„Bean
    ConstructorArgumentValues getConstructorArgumentValues();
    MutablePropertyValues getPropertyValues();
}

// Beanå®šä¹‰æ³¨å†Œè¡¨
public interface BeanDefinitionRegistry {
    void registerBeanDefinition(String beanName, BeanDefinition beanDefinition);
    void removeBeanDefinition(String beanName);
    BeanDefinition getBeanDefinition(String beanName);
    boolean containsBeanDefinition(String beanName);
    String[] getBeanDefinitionNames();
}

// æ³¨è§£æ–¹å¼æ³¨å†ŒBean
@Component
@Scope("prototype")
@Lazy
public class UserService {
    // ...
}

// Java Configæ–¹å¼æ³¨å†ŒBean
@Configuration
public class AppConfig {
    @Bean
    @Scope("singleton")
    public UserService userService() {
        return new UserService();
    }
}

// XMLæ–¹å¼æ³¨å†ŒBean
<bean id="userService" class="com.example.UserService" scope="singleton" lazy-init="true">
    <property name="userRepository" ref="userRepository"/>
</bean>
```

#### 2.3 Beançš„ç”Ÿå‘½å‘¨æœŸï¼ˆå®Œæ•´æµç¨‹ï¼‰

```java
// Beanç”Ÿå‘½å‘¨æœŸçš„9ä¸ªé˜¶æ®µ
1. å®ä¾‹åŒ–ï¼ˆInstantiationï¼‰
   â””â”€ createBeanInstance()ï¼šè°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡

2. å±æ€§å¡«å……ï¼ˆPopulate Propertiesï¼‰
   â””â”€ populateBean()ï¼šæ³¨å…¥@Autowiredä¾èµ–

3. Awareæ¥å£å›è°ƒ
   â”œâ”€ BeanNameAware.setBeanName()
   â”œâ”€ BeanFactoryAware.setBeanFactory()
   â””â”€ ApplicationContextAware.setApplicationContext()

4. BeanPostProcessorå‰ç½®å¤„ç†
   â””â”€ postProcessBeforeInitialization()
       â”œâ”€ @PostConstructæ³¨è§£å¤„ç†ï¼ˆCommonAnnotationBeanPostProcessorï¼‰
       â””â”€ å…¶ä»–æ‰©å±•ç‚¹

5. åˆå§‹åŒ–ï¼ˆInitializationï¼‰
   â”œâ”€ InitializingBean.afterPropertiesSet()
   â””â”€ è‡ªå®šä¹‰init-method

6. BeanPostProcessoråç½®å¤„ç†
   â””â”€ postProcessAfterInitialization()
       â”œâ”€ AOPä»£ç†åˆ›å»ºï¼ˆAbstractAutoProxyCreatorï¼‰
       â””â”€ å…¶ä»–æ‰©å±•ç‚¹

7. Beanä½¿ç”¨ï¼ˆIn Useï¼‰
   â””â”€ Beanå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨

8. é”€æ¯å‰å›è°ƒ
   â””â”€ @PreDestroy

9. é”€æ¯ï¼ˆDestructionï¼‰
   â”œâ”€ DisposableBean.destroy()
   â””â”€ è‡ªå®šä¹‰destroy-method
```

**ç”Ÿå‘½å‘¨æœŸæ¼”ç¤ºä»£ç **:
```java
@Component
public class LifecycleBean implements BeanNameAware, BeanFactoryAware,
        ApplicationContextAware, InitializingBean, DisposableBean {

    private String beanName;

    // 1. æ„é€ æ–¹æ³•
    public LifecycleBean() {
        System.out.println("1. æ„é€ æ–¹æ³•æ‰§è¡Œ");
    }

    // 2. ä¾èµ–æ³¨å…¥
    @Autowired
    private UserService userService;

    // 3. BeanNameAware
    @Override
    public void setBeanName(String name) {
        this.beanName = name;
        System.out.println("3. BeanNameAware.setBeanName: " + name);
    }

    // 4. BeanFactoryAware
    @Override
    public void setBeanFactory(BeanFactory beanFactory) {
        System.out.println("4. BeanFactoryAware.setBeanFactory");
    }

    // 5. ApplicationContextAware
    @Override
    public void setApplicationContext(ApplicationContext context) {
        System.out.println("5. ApplicationContextAware.setApplicationContext");
    }

    // 6. @PostConstruct
    @PostConstruct
    public void postConstruct() {
        System.out.println("6. @PostConstructæ‰§è¡Œ");
    }

    // 7. InitializingBean
    @Override
    public void afterPropertiesSet() {
        System.out.println("7. InitializingBean.afterPropertiesSet");
    }

    // 8. init-method
    public void initMethod() {
        System.out.println("8. init-methodæ‰§è¡Œ");
    }

    // 9. @PreDestroy
    @PreDestroy
    public void preDestroy() {
        System.out.println("9. @PreDestroyæ‰§è¡Œ");
    }

    // 10. DisposableBean
    @Override
    public void destroy() {
        System.out.println("10. DisposableBean.destroy");
    }

    // 11. destroy-method
    public void destroyMethod() {
        System.out.println("11. destroy-methodæ‰§è¡Œ");
    }
}

// è¾“å‡ºé¡ºåºï¼š
1. æ„é€ æ–¹æ³•æ‰§è¡Œ
3. BeanNameAware.setBeanName: lifecycleBean
4. BeanFactoryAware.setBeanFactory
5. ApplicationContextAware.setApplicationContext
6. @PostConstructæ‰§è¡Œ
7. InitializingBean.afterPropertiesSet
8. init-methodæ‰§è¡Œ
ï¼ˆBeanä½¿ç”¨ä¸­...ï¼‰
9. @PreDestroyæ‰§è¡Œ
10. DisposableBean.destroy
11. destroy-methodæ‰§è¡Œ
```

#### 2.4 å¾ªç¯ä¾èµ–çš„ä¸‰çº§ç¼“å­˜è§£å†³æ–¹æ¡ˆ

```java
// é—®é¢˜ï¼šAä¾èµ–Bï¼ŒBä¾èµ–A
@Component
public class ServiceA {
    @Autowired
    private ServiceB serviceB;
}

@Component
public class ServiceB {
    @Autowired
    private ServiceA serviceA;
}

// å¦‚æœæ²¡æœ‰ç¼“å­˜æœºåˆ¶ï¼š
åˆ›å»ºA â†’ æ³¨å…¥B â†’ åˆ›å»ºB â†’ æ³¨å…¥A â†’ åˆ›å»ºA â†’ ...ï¼ˆæ­»å¾ªç¯ï¼‰

// Springçš„ä¸‰çº§ç¼“å­˜æœºåˆ¶
public class DefaultSingletonBeanRegistry {
    // ä¸€çº§ç¼“å­˜ï¼šæˆå“Beanï¼ˆå·²å®Œæˆåˆå§‹åŒ–ï¼‰
    private final Map<String, Object> singletonObjects = new ConcurrentHashMap<>();

    // äºŒçº§ç¼“å­˜ï¼šåŠæˆå“Beanï¼ˆå·²å®ä¾‹åŒ–ï¼Œæœªåˆå§‹åŒ–ï¼‰
    private final Map<String, Object> earlySingletonObjects = new ConcurrentHashMap<>();

    // ä¸‰çº§ç¼“å­˜ï¼šBeanå·¥å‚ï¼ˆç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ï¼‰
    private final Map<String, ObjectFactory<?>> singletonFactories = new HashMap<>();

    // è·å–Beanï¼ˆä¸‰çº§ç¼“å­˜æŸ¥æ‰¾ï¼‰
    protected Object getSingleton(String beanName) {
        // 1. ä»ä¸€çº§ç¼“å­˜è·å–ï¼ˆæˆå“ï¼‰
        Object bean = singletonObjects.get(beanName);
        if (bean == null) {
            // 2. ä»äºŒçº§ç¼“å­˜è·å–ï¼ˆåŠæˆå“ï¼‰
            bean = earlySingletonObjects.get(beanName);
            if (bean == null) {
                // 3. ä»ä¸‰çº§ç¼“å­˜è·å–ï¼ˆå·¥å‚ï¼‰
                ObjectFactory<?> factory = singletonFactories.get(beanName);
                if (factory != null) {
                    bean = factory.getObject();
                    // ç§»åˆ°äºŒçº§ç¼“å­˜
                    earlySingletonObjects.put(beanName, bean);
                    singletonFactories.remove(beanName);
                }
            }
        }
        return bean;
    }
}

// å¾ªç¯ä¾èµ–è§£å†³æµç¨‹
1. åˆ›å»ºAï¼š
   â”œâ”€ å®ä¾‹åŒ–Aï¼ˆåŠæˆå“ï¼‰
   â”œâ”€ æ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼šsingletonFactories.put("A", () -> A)
   â””â”€ å¡«å……å±æ€§ï¼šéœ€è¦B

2. åˆ›å»ºBï¼š
   â”œâ”€ å®ä¾‹åŒ–Bï¼ˆåŠæˆå“ï¼‰
   â”œâ”€ æ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼šsingletonFactories.put("B", () -> B)
   â””â”€ å¡«å……å±æ€§ï¼šéœ€è¦A

3. ä»ç¼“å­˜è·å–Aï¼š
   â”œâ”€ ä¸€çº§ç¼“å­˜æ²¡æœ‰ï¼ˆAè¿˜æœªåˆå§‹åŒ–å®Œæˆï¼‰
   â”œâ”€ äºŒçº§ç¼“å­˜æ²¡æœ‰
   â”œâ”€ ä¸‰çº§ç¼“å­˜æœ‰ï¼ˆAçš„å·¥å‚ï¼‰
   â”œâ”€ è°ƒç”¨å·¥å‚åˆ›å»ºAï¼ˆå¦‚éœ€AOPä»£ç†ï¼Œæ­¤æ—¶åˆ›å»ºä»£ç†å¯¹è±¡ï¼‰
   â””â”€ ç§»åˆ°äºŒçº§ç¼“å­˜

4. Bè·å–åˆ°Aï¼ˆåŠæˆå“ï¼‰ï¼š
   â””â”€ Båˆå§‹åŒ–å®Œæˆï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜

5. Aè·å–åˆ°Bï¼ˆæˆå“ï¼‰ï¼š
   â””â”€ Aåˆå§‹åŒ–å®Œæˆï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜

ç»“æœï¼šå¾ªç¯ä¾èµ–è§£å†³ï¼
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ**
```
ä¸€çº§ç¼“å­˜ï¼šå­˜å‚¨å®Œæ•´Beanï¼Œé¿å…é‡å¤åˆ›å»º
äºŒçº§ç¼“å­˜ï¼šå­˜å‚¨åŠæˆå“Beanï¼Œè§£å†³å¾ªç¯ä¾èµ–
ä¸‰çº§ç¼“å­˜ï¼šå­˜å‚¨Beanå·¥å‚ï¼Œæ”¯æŒAOPä»£ç†
  â””â”€ å¦‚æœBeanéœ€è¦AOPå¢å¼ºï¼Œä¸‰çº§ç¼“å­˜å¯ä»¥åœ¨å¾ªç¯ä¾èµ–æ—¶åˆ›å»ºä»£ç†å¯¹è±¡
  â””â”€ å¦‚æœç›´æ¥ç”¨äºŒçº§ç¼“å­˜ï¼Œæ— æ³•åœ¨å¾ªç¯ä¾èµ–æ—¶åˆ›å»ºä»£ç†
```

#### 2.5 ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼

```java
// æ–¹å¼1ï¼šæ„é€ å™¨æ³¨å…¥ï¼ˆæ¨èï¼‰
@Component
public class OrderService {
    private final UserService userService;
    private final ProductService productService;

    // Spring 4.3+å•æ„é€ å™¨å¯çœç•¥@Autowired
    public OrderService(UserService userService, ProductService productService) {
        this.userService = userService;
        this.productService = productService;
    }
}

ä¼˜ç‚¹ï¼š
âœ… ä¾èµ–ä¸å¯å˜ï¼ˆfinalï¼‰
âœ… é¿å…NullPointerException
âœ… å¼ºåˆ¶æ³¨å…¥ï¼ˆç¼ºå°‘ä¾èµ–æ— æ³•åˆ›å»ºå¯¹è±¡ï¼‰
âœ… æ˜“äºæµ‹è¯•ï¼ˆå¯ç›´æ¥newå¯¹è±¡ä¼ å…¥mockä¾èµ–ï¼‰

ç¼ºç‚¹ï¼š
âŒ ä¾èµ–å¤šæ—¶æ„é€ å‡½æ•°è†¨èƒ€

// æ–¹å¼2ï¼šSetteræ³¨å…¥
@Component
public class OrderService {
    private UserService userService;
    private ProductService productService;

    @Autowired
    public void setUserService(UserService userService) {
        this.userService = userService;
    }

    @Autowired
    public void setProductService(ProductService productService) {
        this.productService = productService;
    }
}

ä¼˜ç‚¹ï¼š
âœ… å¯é€‰ä¾èµ–ï¼ˆå¯ä»¥ä¸æ³¨å…¥ï¼‰
âœ… ä¾èµ–å¯å˜ï¼ˆå¯ä»¥é‡æ–°æ³¨å…¥ï¼‰

ç¼ºç‚¹ï¼š
âŒ å¯èƒ½å‡ºç°NullPointerException
âŒ éš¾ä»¥ä¿è¯ä¾èµ–å®Œæ•´æ€§

// æ–¹å¼3ï¼šå­—æ®µæ³¨å…¥ï¼ˆä¸æ¨èï¼‰
@Component
public class OrderService {
    @Autowired
    private UserService userService;

    @Autowired
    private ProductService productService;
}

ä¼˜ç‚¹ï¼š
âœ… ä»£ç ç®€æ´

ç¼ºç‚¹ï¼š
âŒ æ— æ³•ä½¿ç”¨finalï¼ˆä¸å¯å˜ï¼‰
âŒ éš¾ä»¥æµ‹è¯•ï¼ˆéœ€è¦Springå®¹å™¨ï¼‰
âŒ è¿åå°è£…æ€§ï¼ˆé€šè¿‡åå°„æ³¨å…¥ç§æœ‰å­—æ®µï¼‰
âŒ å®¹æ˜“äº§ç”Ÿè¿‡å¤šä¾èµ–ï¼ˆçœ‹ä¸åˆ°æ„é€ å‡½æ•°è†¨èƒ€ï¼‰

// æœ€ä½³å®è·µ
æ¨èä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼š
â”œâ”€ å¿…éœ€ä¾èµ–ï¼šæ„é€ å™¨æ³¨å…¥ï¼ˆfinalï¼‰
â”œâ”€ å¯é€‰ä¾èµ–ï¼šSetteræ³¨å…¥ï¼ˆéfinalï¼‰
â””â”€ é¿å…å­—æ®µæ³¨å…¥
```

---

### ä¸‰ã€æ‰‹å†™ç®€åŒ–ç‰ˆIoCå®¹å™¨ï¼ˆ4000å­—ï¼‰

**ç›®æ ‡**: é€šè¿‡ä»£ç å®ç°åŠ æ·±å¯¹IoCå®¹å™¨çš„ç†è§£

#### 3.1 æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

```java
// ç›®æ ‡åŠŸèƒ½ï¼š
1. Beanæ³¨å†Œä¸æ‰«æ
   â”œâ”€ æ”¯æŒ@Componentæ³¨è§£
   â””â”€ æ”¯æŒåŒ…æ‰«æ

2. ä¾èµ–æ³¨å…¥
   â”œâ”€ æ”¯æŒ@Autowiredæ³¨è§£
   â”œâ”€ æ”¯æŒæ„é€ å™¨æ³¨å…¥
   â””â”€ æ”¯æŒå­—æ®µæ³¨å…¥

3. ç”Ÿå‘½å‘¨æœŸç®¡ç†
   â”œâ”€ æ”¯æŒ@PostConstruct
   â””â”€ æ”¯æŒ@PreDestroy

4. ä½œç”¨åŸŸæ”¯æŒ
   â”œâ”€ å•ä¾‹ï¼ˆé»˜è®¤ï¼‰
   â””â”€ åŸå‹

5. å¾ªç¯ä¾èµ–æ£€æµ‹
   â””â”€ ç®€å•æ£€æµ‹ï¼ˆä¸è§£å†³ï¼ŒåªæŠ›å¼‚å¸¸ï¼‰
```

#### 3.2 æ ¸å¿ƒä»£ç å®ç°

```java
// 1. ç®€æ˜“IoCå®¹å™¨ä¸»ç±»
public class SimpleIoCContainer {
    // Beanå®šä¹‰å­˜å‚¨
    private Map<Class<?>, BeanDefinition> beanDefinitions = new HashMap<>();

    // Beanå®ä¾‹å­˜å‚¨ï¼ˆå•ä¾‹ï¼‰
    private Map<Class<?>, Object> singletonBeans = new ConcurrentHashMap<>();

    // æ­£åœ¨åˆ›å»ºçš„Beanï¼ˆç”¨äºæ£€æµ‹å¾ªç¯ä¾èµ–ï¼‰
    private Set<Class<?>> beansInCreation = new HashSet<>();

    // æ‰«æåŒ…å¹¶æ³¨å†ŒBean
    public void scan(String basePackage) {
        try {
            // 1. æ‰«æåŒ…ä¸‹çš„æ‰€æœ‰ç±»
            String path = basePackage.replace('.', '/');
            ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
            Enumeration<URL> resources = classLoader.getResources(path);

            while (resources.hasMoreElements()) {
                URL resource = resources.nextElement();
                File dir = new File(resource.getFile());

                // 2. éå†æ‰€æœ‰.classæ–‡ä»¶
                for (File file : dir.listFiles()) {
                    if (file.getName().endsWith(".class")) {
                        String className = basePackage + "." + file.getName().replace(".class", "");
                        Class<?> clazz = Class.forName(className);

                        // 3. æ£€æŸ¥æ˜¯å¦æœ‰@Componentæ³¨è§£
                        if (clazz.isAnnotationPresent(Component.class)) {
                            registerBean(clazz);
                        }
                    }
                }
            }
        } catch (Exception e) {
            throw new RuntimeException("åŒ…æ‰«æå¤±è´¥", e);
        }
    }

    // æ³¨å†ŒBeanå®šä¹‰
    private void registerBean(Class<?> clazz) {
        BeanDefinition beanDefinition = new BeanDefinition();
        beanDefinition.setBeanClass(clazz);

        // æ£€æŸ¥ä½œç”¨åŸŸ
        Scope scope = clazz.getAnnotation(Scope.class);
        if (scope != null) {
            beanDefinition.setScope(scope.value());
        } else {
            beanDefinition.setScope("singleton");  // é»˜è®¤å•ä¾‹
        }

        beanDefinitions.put(clazz, beanDefinition);
    }

    // è·å–Bean
    public <T> T getBean(Class<T> clazz) {
        BeanDefinition beanDefinition = beanDefinitions.get(clazz);
        if (beanDefinition == null) {
            throw new RuntimeException("Beanæœªæ³¨å†Œ: " + clazz.getName());
        }

        // å•ä¾‹æ¨¡å¼
        if ("singleton".equals(beanDefinition.getScope())) {
            Object bean = singletonBeans.get(clazz);
            if (bean == null) {
                bean = createBean(clazz, beanDefinition);
                singletonBeans.put(clazz, bean);
            }
            return (T) bean;
        }

        // åŸå‹æ¨¡å¼ï¼ˆæ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡ï¼‰
        return (T) createBean(clazz, beanDefinition);
    }

    // åˆ›å»ºBean
    private Object createBean(Class<?> clazz, BeanDefinition beanDefinition) {
        // å¾ªç¯ä¾èµ–æ£€æµ‹
        if (beansInCreation.contains(clazz)) {
            throw new RuntimeException("æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–: " + clazz.getName());
        }
        beansInCreation.add(clazz);

        try {
            // 1. å®ä¾‹åŒ–
            Object instance = instantiateBean(clazz);

            // 2. å±æ€§æ³¨å…¥
            populateBean(instance, clazz);

            // 3. åˆå§‹åŒ–
            initializeBean(instance, clazz);

            return instance;
        } finally {
            beansInCreation.remove(clazz);
        }
    }

    // å®ä¾‹åŒ–Beanï¼ˆæ„é€ å™¨æ³¨å…¥ï¼‰
    private Object instantiateBean(Class<?> clazz) {
        try {
            // 1. æŸ¥æ‰¾@Autowiredæ„é€ å™¨
            for (Constructor<?> constructor : clazz.getConstructors()) {
                if (constructor.isAnnotationPresent(Autowired.class) ||
                    constructor.getParameterCount() > 0) {

                    // è·å–æ„é€ å™¨å‚æ•°
                    Class<?>[] paramTypes = constructor.getParameterTypes();
                    Object[] params = new Object[paramTypes.length];

                    for (int i = 0; i < paramTypes.length; i++) {
                        params[i] = getBean(paramTypes[i]);  // é€’å½’è·å–ä¾èµ–
                    }

                    return constructor.newInstance(params);
                }
            }

            // 2. æ— å‚æ„é€ å™¨
            return clazz.getDeclaredConstructor().newInstance();

        } catch (Exception e) {
            throw new RuntimeException("å®ä¾‹åŒ–å¤±è´¥: " + clazz.getName(), e);
        }
    }

    // å±æ€§æ³¨å…¥ï¼ˆå­—æ®µæ³¨å…¥ï¼‰
    private void populateBean(Object bean, Class<?> clazz) {
        try {
            // éå†æ‰€æœ‰å­—æ®µ
            for (Field field : clazz.getDeclaredFields()) {
                if (field.isAnnotationPresent(Autowired.class)) {
                    field.setAccessible(true);

                    // è·å–ä¾èµ–Bean
                    Object dependency = getBean(field.getType());

                    // æ³¨å…¥å­—æ®µ
                    field.set(bean, dependency);
                }
            }
        } catch (Exception e) {
            throw new RuntimeException("å±æ€§æ³¨å…¥å¤±è´¥", e);
        }
    }

    // åˆå§‹åŒ–Bean
    private void initializeBean(Object bean, Class<?> clazz) {
        try {
            // æŸ¥æ‰¾@PostConstructæ–¹æ³•
            for (Method method : clazz.getDeclaredMethods()) {
                if (method.isAnnotationPresent(PostConstruct.class)) {
                    method.setAccessible(true);
                    method.invoke(bean);
                }
            }
        } catch (Exception e) {
            throw new RuntimeException("åˆå§‹åŒ–å¤±è´¥", e);
        }
    }

    // é”€æ¯Bean
    public void destroy() {
        for (Object bean : singletonBeans.values()) {
            try {
                // æŸ¥æ‰¾@PreDestroyæ–¹æ³•
                for (Method method : bean.getClass().getDeclaredMethods()) {
                    if (method.isAnnotationPresent(PreDestroy.class)) {
                        method.setAccessible(true);
                        method.invoke(bean);
                    }
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        singletonBeans.clear();
    }
}

// 2. Beanå®šä¹‰
class BeanDefinition {
    private Class<?> beanClass;
    private String scope = "singleton";

    // getters and setters
}

// 3. ç®€åŒ–æ³¨è§£å®šä¹‰
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Component {
}

@Target({ElementType.FIELD, ElementType.CONSTRUCTOR})
@Retention(RetentionPolicy.RUNTIME)
public @interface Autowired {
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PostConstruct {
}

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PreDestroy {
}

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Scope {
    String value() default "singleton";
}
```

#### 3.3 ä½¿ç”¨æ¼”ç¤º

```java
// 1. å®šä¹‰Bean
@Component
public class UserRepository {
    public void save(User user) {
        System.out.println("ä¿å­˜ç”¨æˆ·: " + user);
    }
}

@Component
public class UserService {
    @Autowired
    private UserRepository userRepository;

    @PostConstruct
    public void init() {
        System.out.println("UserServiceåˆå§‹åŒ–");
    }

    public void createUser(User user) {
        userRepository.save(user);
    }

    @PreDestroy
    public void destroy() {
        System.out.println("UserServiceé”€æ¯");
    }
}

@Component
public class OrderService {
    private final UserService userService;

    // æ„é€ å™¨æ³¨å…¥
    @Autowired
    public OrderService(UserService userService) {
        this.userService = userService;
    }

    public void createOrder(Order order) {
        userService.createUser(order.getUser());
        System.out.println("åˆ›å»ºè®¢å•: " + order);
    }
}

// 2. ä½¿ç”¨å®¹å™¨
public class Main {
    public static void main(String[] args) {
        // åˆ›å»ºå®¹å™¨
        SimpleIoCContainer container = new SimpleIoCContainer();

        // æ‰«æåŒ…
        container.scan("com.example.service");

        // è·å–Bean
        OrderService orderService = container.getBean(OrderService.class);

        // ä½¿ç”¨Bean
        Order order = new Order();
        orderService.createOrder(order);

        // é”€æ¯å®¹å™¨
        container.destroy();
    }
}

// è¾“å‡ºï¼š
UserServiceåˆå§‹åŒ–
ä¿å­˜ç”¨æˆ·: User[...]
åˆ›å»ºè®¢å•: Order[...]
UserServiceé”€æ¯
```

#### 3.4 ä¸Spring IoCçš„å·®å¼‚

| ç‰¹æ€§ | ç®€åŒ–ç‰ˆIoC | Spring IoC |
|------|----------|-----------|
| Beanæ‰«æ | ç®€å•æ–‡ä»¶æ‰«æ | ClassPathScanning + ASMå­—èŠ‚ç æ‰«æ |
| ä¾èµ–æ³¨å…¥ | æ„é€ å™¨+å­—æ®µæ³¨å…¥ | æ„é€ å™¨+Setter+å­—æ®µæ³¨å…¥ |
| å¾ªç¯ä¾èµ– | æ£€æµ‹ä½†ä¸è§£å†³ | ä¸‰çº§ç¼“å­˜è§£å†³ |
| ç”Ÿå‘½å‘¨æœŸ | @PostConstruct/@PreDestroy | 9ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µ |
| ä½œç”¨åŸŸ | å•ä¾‹+åŸå‹ | å•ä¾‹+åŸå‹+è¯·æ±‚+ä¼šè¯+è‡ªå®šä¹‰ |
| AOPæ”¯æŒ | æ—  | å®Œæ•´AOPæ”¯æŒ |
| äº‹ä»¶æœºåˆ¶ | æ—  | ApplicationEvent |
| å›½é™…åŒ– | æ—  | MessageSource |
| èµ„æºåŠ è½½ | æ—  | ResourceLoader |
| ä»£ç é‡ | 200è¡Œ | 10ä¸‡+è¡Œ |

---

### å››ã€Spring IoCé«˜çº§ç‰¹æ€§ï¼ˆ3500å­—ï¼‰

#### 4.1 æ¡ä»¶è£…é…ï¼ˆ@Conditionalï¼‰

```java
// é—®é¢˜ï¼šä¸åŒç¯å¢ƒéœ€è¦ä¸åŒé…ç½®
// å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨H2å†…å­˜æ•°æ®åº“
// ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨MySQLæ•°æ®åº“

// ä¼ ç»Ÿæ–¹æ¡ˆï¼šæ‰‹åŠ¨åˆ‡æ¢é…ç½®ï¼ˆå®¹æ˜“å‡ºé”™ï¼‰
@Configuration
public class DataSourceConfig {
    @Bean
    public DataSource dataSource() {
        // éœ€è¦æ‰‹åŠ¨æ³¨é‡Š/åæ³¨é‡Š
        // return new H2DataSource();  // å¼€å‘ç¯å¢ƒ
        return new MySQLDataSource();  // ç”Ÿäº§ç¯å¢ƒ
    }
}

// Springæ–¹æ¡ˆï¼šæ¡ä»¶è£…é…
@Configuration
public class DataSourceConfig {

    @Bean
    @Profile("dev")  // åªåœ¨devç¯å¢ƒç”Ÿæ•ˆ
    public DataSource h2DataSource() {
        return new H2DataSource();
    }

    @Bean
    @Profile("prod")  // åªåœ¨prodç¯å¢ƒç”Ÿæ•ˆ
    public DataSource mySQLDataSource() {
        return new MySQLDataSource();
    }
}

// application.yml
spring:
  profiles:
    active: dev  # åˆ‡æ¢ç¯å¢ƒåªéœ€æ”¹è¿™ä¸€è¡Œ

// æ›´å¼ºå¤§çš„@Conditional
@Configuration
public class DataSourceConfig {

    @Bean
    @ConditionalOnProperty(name = "datasource.type", havingValue = "h2")
    public DataSource h2DataSource() {
        return new H2DataSource();
    }

    @Bean
    @ConditionalOnClass(name = "com.mysql.cj.jdbc.Driver")  // MySQLé©±åŠ¨å­˜åœ¨æ—¶æ‰åˆ›å»º
    public DataSource mySQLDataSource() {
        return new MySQLDataSource();
    }

    @Bean
    @ConditionalOnMissingBean(DataSource.class)  // æ²¡æœ‰å…¶ä»–DataSourceæ—¶æ‰åˆ›å»º
    public DataSource defaultDataSource() {
        return new H2DataSource();
    }
}

// å¸¸ç”¨æ¡ä»¶æ³¨è§£
@ConditionalOnClass          // ç±»è·¯å¾„å­˜åœ¨æŒ‡å®šç±»
@ConditionalOnMissingClass   // ç±»è·¯å¾„ä¸å­˜åœ¨æŒ‡å®šç±»
@ConditionalOnBean           // å®¹å™¨å­˜åœ¨æŒ‡å®šBean
@ConditionalOnMissingBean    // å®¹å™¨ä¸å­˜åœ¨æŒ‡å®šBean
@ConditionalOnProperty       // é…ç½®æ–‡ä»¶å­˜åœ¨æŒ‡å®šå±æ€§
@ConditionalOnExpression     // SpELè¡¨è¾¾å¼ä¸ºtrue
@ConditionalOnJava           // Javaç‰ˆæœ¬åŒ¹é…
@ConditionalOnWebApplication // Webåº”ç”¨ç¯å¢ƒ
```

#### 4.2 å»¶è¿ŸåŠ è½½ï¼ˆ@Lazyï¼‰

```java
// é—®é¢˜ï¼šæŸäº›Beanå¾ˆé‡ï¼ˆåˆå§‹åŒ–æ…¢ï¼‰ï¼Œä½†ä¸ä¸€å®šç”¨åˆ°
@Component
public class HeavyService {
    public HeavyService() {
        // åŠ è½½å¤§é‡æ•°æ®ï¼Œè€—æ—¶5ç§’
        System.out.println("HeavyServiceåˆå§‹åŒ–ä¸­...");
        try {
            Thread.sleep(5000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println("HeavyServiceåˆå§‹åŒ–å®Œæˆ");
    }
}

// ä¼ ç»Ÿæ–¹æ¡ˆï¼šå®¹å™¨å¯åŠ¨æ—¶å°±åˆ›å»ºæ‰€æœ‰å•ä¾‹Bean
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
        // å¯åŠ¨è€—æ—¶5ç§’ï¼ˆå³ä½¿HeavyServiceæœªä½¿ç”¨ï¼‰
    }
}

// å»¶è¿ŸåŠ è½½æ–¹æ¡ˆï¼šä½¿ç”¨æ—¶æ‰åˆ›å»º
@Component
@Lazy  // å»¶è¿ŸåŠ è½½
public class HeavyService {
    // ...
}

@Service
public class UserService {
    @Autowired
    @Lazy  // æ³¨å…¥å»¶è¿ŸåŠ è½½çš„ä»£ç†å¯¹è±¡
    private HeavyService heavyService;

    public void doSomething() {
        // ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰çœŸæ­£åˆ›å»ºHeavyService
        heavyService.process();
    }
}

// å…¨å±€å»¶è¿ŸåŠ è½½ï¼ˆä¸æ¨èï¼‰
spring:
  main:
    lazy-initialization: true  # æ‰€æœ‰Beanå»¶è¿ŸåŠ è½½
```

#### 4.3 å·¥å‚Beanï¼ˆFactoryBeanï¼‰

```java
// é—®é¢˜ï¼šæŸäº›å¯¹è±¡åˆ›å»ºé€»è¾‘å¤æ‚ï¼Œæ— æ³•ç”¨ç®€å•@Beanå®ç°
// ä¾‹å¦‚ï¼šMyBatisçš„SqlSessionFactoryã€Feignçš„åŠ¨æ€ä»£ç†

// FactoryBeanï¼šå·¥å‚Bean
public interface FactoryBean<T> {
    T getObject();              // è¿”å›å®é™…å¯¹è±¡
    Class<?> getObjectType();   // è¿”å›å¯¹è±¡ç±»å‹
    boolean isSingleton();      // æ˜¯å¦å•ä¾‹
}

// ç¤ºä¾‹ï¼šåŠ¨æ€ä»£ç†å·¥å‚
public class ProxyFactoryBean<T> implements FactoryBean<T> {
    private Class<T> interfaceClass;

    public ProxyFactoryBean(Class<T> interfaceClass) {
        this.interfaceClass = interfaceClass;
    }

    @Override
    public T getObject() {
        // åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡
        return (T) Proxy.newProxyInstance(
            interfaceClass.getClassLoader(),
            new Class[]{interfaceClass},
            (proxy, method, args) -> {
                System.out.println("Before: " + method.getName());
                Object result = invokeRealMethod(method, args);
                System.out.println("After: " + method.getName());
                return result;
            }
        );
    }

    @Override
    public Class<?> getObjectType() {
        return interfaceClass;
    }

    @Override
    public boolean isSingleton() {
        return true;
    }

    private Object invokeRealMethod(Method method, Object[] args) {
        // è°ƒç”¨çœŸå®æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼šHTTPè¯·æ±‚ï¼‰
        return "Result";
    }
}

// ä½¿ç”¨FactoryBean
@Configuration
public class AppConfig {
    @Bean
    public ProxyFactoryBean<UserService> userService() {
        return new ProxyFactoryBean<>(UserService.class);
    }
}

// è·å–Bean
ApplicationContext context = ...;
UserService userService = context.getBean(UserService.class);  // è·å–ä»£ç†å¯¹è±¡
ProxyFactoryBean factoryBean = context.getBean("&userService", ProxyFactoryBean.class);  // &å‰ç¼€è·å–å·¥å‚å¯¹è±¡
```

#### 4.4 äº‹ä»¶æœºåˆ¶ï¼ˆApplicationEventï¼‰

```java
// é—®é¢˜ï¼šè§£è€¦ä¸šåŠ¡é€»è¾‘
// åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œåï¼Œéœ€è¦å‘é€é‚®ä»¶ã€å‘é€çŸ­ä¿¡ã€è®°å½•æ—¥å¿—

// ä¼ ç»Ÿæ–¹æ¡ˆï¼šè€¦åˆ
@Service
public class UserService {
    @Autowired
    private EmailService emailService;
    @Autowired
    private SmsService smsService;
    @Autowired
    private LogService logService;

    public void register(User user) {
        // 1. ä¿å­˜ç”¨æˆ·
        saveUser(user);

        // 2. å‘é€é‚®ä»¶
        emailService.sendWelcomeEmail(user);

        // 3. å‘é€çŸ­ä¿¡
        smsService.sendWelcomeSms(user);

        // 4. è®°å½•æ—¥å¿—
        logService.logUserRegister(user);
    }
}

// Springäº‹ä»¶æ–¹æ¡ˆï¼šè§£è€¦
// 1. å®šä¹‰äº‹ä»¶
public class UserRegisterEvent extends ApplicationEvent {
    private User user;

    public UserRegisterEvent(Object source, User user) {
        super(source);
        this.user = user;
    }

    public User getUser() {
        return user;
    }
}

// 2. å‘å¸ƒäº‹ä»¶
@Service
public class UserService {
    @Autowired
    private ApplicationEventPublisher eventPublisher;

    public void register(User user) {
        // 1. ä¿å­˜ç”¨æˆ·
        saveUser(user);

        // 2. å‘å¸ƒäº‹ä»¶ï¼ˆè§£è€¦ï¼‰
        eventPublisher.publishEvent(new UserRegisterEvent(this, user));
    }
}

// 3. ç›‘å¬äº‹ä»¶
@Component
public class EmailListener {
    @EventListener
    public void onUserRegister(UserRegisterEvent event) {
        User user = event.getUser();
        sendWelcomeEmail(user);
    }
}

@Component
public class SmsListener {
    @EventListener
    @Async  // å¼‚æ­¥æ‰§è¡Œ
    public void onUserRegister(UserRegisterEvent event) {
        User user = event.getUser();
        sendWelcomeSms(user);
    }
}

@Component
public class LogListener {
    @EventListener
    @Order(1)  // ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°è¶Šä¼˜å…ˆï¼‰
    public void onUserRegister(UserRegisterEvent event) {
        User user = event.getUser();
        logUserRegister(user);
    }
}

// ä¼˜åŠ¿ï¼š
âœ… è§£è€¦ï¼šUserServiceä¸ä¾èµ–EmailServiceã€SmsService
âœ… æ‰©å±•ï¼šæ–°å¢ç›‘å¬å™¨æ— éœ€ä¿®æ”¹UserService
âœ… å¼‚æ­¥ï¼š@Asyncå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»æµç¨‹
âœ… ä¼˜å…ˆçº§ï¼š@Orderæ§åˆ¶æ‰§è¡Œé¡ºåº
```

---

### äº”ã€æ€»ç»“ä¸æœ€ä½³å®è·µï¼ˆ2500å­—ï¼‰

#### 5.1 IoCå®¹å™¨æ ¸å¿ƒä»·å€¼æ€»ç»“

```
IoCå®¹å™¨è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š
â”œâ”€ ä¾èµ–ç®¡ç†ï¼šä»æ‰‹åŠ¨newåˆ°è‡ªåŠ¨è£…é…
â”œâ”€ ç”Ÿå‘½å‘¨æœŸï¼šç»Ÿä¸€ç®¡ç†Beançš„åˆ›å»ºå’Œé”€æ¯
â”œâ”€ å•ä¾‹æ¨¡å¼ï¼šé¿å…é‡å¤åˆ›å»ºå¯¹è±¡
â”œâ”€ å¾ªç¯ä¾èµ–ï¼šä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–
â””â”€ å¯æµ‹è¯•æ€§ï¼šä¾èµ–æ³¨å…¥è®©æµ‹è¯•å˜ç®€å•

å¤æ‚åº¦å¯¹æ¯”ï¼š
æ‰‹åŠ¨ç®¡ç†ï¼ˆ100è¡Œï¼‰â†’ å·¥å‚æ¨¡å¼ï¼ˆ50è¡Œï¼‰â†’ IoCå®¹å™¨ï¼ˆ20è¡Œï¼‰â†’ Springï¼ˆ10è¡Œï¼‰
```

#### 5.2 ä¾èµ–æ³¨å…¥æœ€ä½³å®è·µ

```java
// âœ… æ¨èï¼šæ„é€ å™¨æ³¨å…¥ï¼ˆå¿…éœ€ä¾èµ–ï¼‰
@Component
public class OrderService {
    private final UserService userService;  // finalä¸å¯å˜
    private final ProductService productService;

    // Spring 4.3+å•æ„é€ å™¨å¯çœç•¥@Autowired
    public OrderService(UserService userService, ProductService productService) {
        this.userService = userService;
        this.productService = productService;
    }
}

// âœ… æ¨èï¼šSetteræ³¨å…¥ï¼ˆå¯é€‰ä¾èµ–ï¼‰
@Component
public class OrderService {
    private NotificationService notificationService;  // å¯é€‰ä¾èµ–

    @Autowired(required = false)  // å¯é€‰æ³¨å…¥
    public void setNotificationService(NotificationService notificationService) {
        this.notificationService = notificationService;
    }
}

// âŒ ä¸æ¨èï¼šå­—æ®µæ³¨å…¥
@Component
public class OrderService {
    @Autowired
    private UserService userService;  // æ— æ³•finalï¼Œéš¾ä»¥æµ‹è¯•
}

// ä¸ºä»€ä¹ˆæ„é€ å™¨æ³¨å…¥æ›´å¥½ï¼Ÿ
1. ä¸å¯å˜æ€§ï¼šfinalä¿è¯ä¾èµ–ä¸è¢«ä¿®æ”¹
2. å®Œæ•´æ€§ï¼šç¼ºå°‘ä¾èµ–æ— æ³•åˆ›å»ºå¯¹è±¡ï¼Œé¿å…NullPointerException
3. å¯æµ‹è¯•æ€§ï¼šå¯ä»¥ç›´æ¥newå¯¹è±¡ä¼ å…¥Mockä¾èµ–
4. æ¸…æ™°æ€§ï¼šä¾èµ–å…³ç³»ä¸€ç›®äº†ç„¶
```

#### 5.3 Beanä½œç”¨åŸŸé€‰æ‹©æŒ‡å—

```java
// å•ä¾‹ï¼ˆé»˜è®¤ï¼‰ï¼šé€‚ç”¨äºæ— çŠ¶æ€Bean
@Component  // é»˜è®¤å•ä¾‹
@Scope("singleton")
public class UserService {
    @Autowired
    private UserRepository userRepository;  // æ— çŠ¶æ€

    public User getUser(Long id) {
        return userRepository.findById(id);
    }
}

// åŸå‹ï¼šé€‚ç”¨äºæœ‰çŠ¶æ€Bean
@Component
@Scope("prototype")  // æ¯æ¬¡getBeanéƒ½åˆ›å»ºæ–°å¯¹è±¡
public class UserForm {
    private String username;
    private String password;

    // æœ‰çŠ¶æ€ï¼Œä¸èƒ½å…±äº«
}

// è¯·æ±‚ä½œç”¨åŸŸï¼šé€‚ç”¨äºWebè¯·æ±‚ç›¸å…³çš„Bean
@Component
@Scope("request")  // æ¯ä¸ªHTTPè¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹
public class RequestContext {
    private String requestId;
    private String userId;
}

// ä¼šè¯ä½œç”¨åŸŸï¼šé€‚ç”¨äºWebä¼šè¯ç›¸å…³çš„Bean
@Component
@Scope("session")  // æ¯ä¸ªHTTPä¼šè¯åˆ›å»ºä¸€ä¸ªå®ä¾‹
public class ShoppingCart {
    private List<Item> items = new ArrayList<>();
}

// ä½œç”¨åŸŸé€‰æ‹©åŸåˆ™ï¼š
é»˜è®¤å•ä¾‹ï¼ˆæ€§èƒ½æœ€å¥½ï¼‰â†’ æœ‰çŠ¶æ€ç”¨åŸå‹ â†’ Webç¯å¢ƒç”¨request/session
```

#### 5.4 å¾ªç¯ä¾èµ–å¤„ç†å»ºè®®

```java
// åœºæ™¯ï¼šAä¾èµ–Bï¼ŒBä¾èµ–A

// æ–¹æ¡ˆ1ï¼šæ„é€ å™¨æ³¨å…¥ï¼ˆSpringæ— æ³•è§£å†³ï¼Œä¼šæŠ›å¼‚å¸¸ï¼‰
@Component
public class ServiceA {
    private final ServiceB serviceB;

    public ServiceA(ServiceB serviceB) {  // å¾ªç¯ä¾èµ–ï¼Œå¯åŠ¨å¤±è´¥
        this.serviceB = serviceB;
    }
}

@Component
public class ServiceB {
    private final ServiceA serviceA;

    public ServiceB(ServiceA serviceA) {  // å¾ªç¯ä¾èµ–ï¼Œå¯åŠ¨å¤±è´¥
        this.serviceA = serviceA;
    }
}

// æ–¹æ¡ˆ2ï¼šå­—æ®µæ³¨å…¥ï¼ˆSpringå¯ä»¥è§£å†³ï¼‰
@Component
public class ServiceA {
    @Autowired
    private ServiceB serviceB;  // å¯ä»¥è§£å†³
}

@Component
public class ServiceB {
    @Autowired
    private ServiceA serviceA;  // å¯ä»¥è§£å†³
}

// æ–¹æ¡ˆ3ï¼šSetteræ³¨å…¥ï¼ˆSpringå¯ä»¥è§£å†³ï¼‰
@Component
public class ServiceA {
    private ServiceB serviceB;

    @Autowired
    public void setServiceB(ServiceB serviceB) {
        this.serviceB = serviceB;
    }
}

// æ–¹æ¡ˆ4ï¼š@Lazyå»¶è¿Ÿæ³¨å…¥ï¼ˆæ¨èï¼‰
@Component
public class ServiceA {
    private final ServiceB serviceB;

    public ServiceA(@Lazy ServiceB serviceB) {  // æ³¨å…¥ä»£ç†å¯¹è±¡
        this.serviceB = serviceB;
    }
}

// æ–¹æ¡ˆ5ï¼šé‡æ„ï¼ˆæœ€ä½³ï¼‰
// å¾ªç¯ä¾èµ–é€šå¸¸æ˜¯è®¾è®¡é—®é¢˜ï¼Œåº”è¯¥é‡æ„
// æå–å…¬å…±é€»è¾‘åˆ°æ–°çš„Service
@Component
public class CommonService {
    // å…¬å…±é€»è¾‘
}

@Component
public class ServiceA {
    @Autowired
    private CommonService commonService;
}

@Component
public class ServiceB {
    @Autowired
    private CommonService commonService;
}

// å»ºè®®ï¼š
âŒ é¿å…å¾ªç¯ä¾èµ–ï¼ˆé‡æ„è®¾è®¡ï¼‰
âœ… å¿…é¡»å¾ªç¯ä¾èµ–æ—¶ç”¨@Lazy
âŒ ä¸è¦ç”¨å­—æ®µæ³¨å…¥ï¼ˆè™½ç„¶èƒ½è§£å†³å¾ªç¯ä¾èµ–ï¼Œä½†ä¸æ¨èï¼‰
```

#### 5.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®

```java
// 1. å»¶è¿ŸåŠ è½½é‡Bean
@Component
@Lazy  // ä¸å¸¸ç”¨çš„é‡Bean
public class HeavyService {
    // ...
}

// 2. ä½¿ç”¨@Scope("prototype")å‡å°‘å†…å­˜å ç”¨
@Component
@Scope("prototype")  // å¤§å¯¹è±¡ç”¨åŸå‹
public class LargeDataHolder {
    private byte[] data = new byte[1024 * 1024 * 10];  // 10MB
}

// 3. é¿å…å¾ªç¯ä¾èµ–ï¼ˆå½±å“å¯åŠ¨æ€§èƒ½ï¼‰
// å¾ªç¯ä¾èµ–éœ€è¦ä¸‰çº§ç¼“å­˜ï¼Œå½±å“æ€§èƒ½

// 4. åˆç†ä½¿ç”¨@ComponentScan
@SpringBootApplication
@ComponentScan(basePackages = "com.example.service")  // æŒ‡å®šæ‰«æåŒ…ï¼Œä¸è¦æ‰«ææ•´ä¸ªé¡¹ç›®
public class App {
}

// 5. ä½¿ç”¨@Conditionalå‡å°‘ä¸å¿…è¦çš„Bean
@Bean
@ConditionalOnProperty(name = "feature.enabled", havingValue = "true")
public FeatureService featureService() {
    return new FeatureService();  // åªåœ¨å¼€å¯åŠŸèƒ½æ—¶æ‰åˆ›å»º
}
```

---

## ğŸ“– æ–‡ç« 3ï¼šã€ŠAOPåŸç†ã€‹- è¯¦ç»†å¤§çº²

### ä¸€ã€å¼•å­ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹çš„å›°å¢ƒï¼ˆ3500å­—ï¼‰

**ç›®æ ‡**: å±•ç¤ºAOPè§£å†³çš„æ ¸å¿ƒé—®é¢˜

#### 1.1 åœºæ™¯ï¼šè®¢å•æœåŠ¡çš„æ¼”è¿›

```java
// ç‰ˆæœ¬1ï¼šçº¯ä¸šåŠ¡é€»è¾‘ï¼ˆç†æƒ³çŠ¶æ€ï¼‰
public class OrderService {
    public Order createOrder(OrderRequest request) {
        // çº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        return orderRepository.save(order);
    }
}

// ç‰ˆæœ¬2ï¼šåŠ å…¥æ—¥å¿—
public class OrderService {
    public Order createOrder(OrderRequest request) {
        log.info("å¼€å§‹åˆ›å»ºè®¢å•: {}", request);  // æ—¥å¿—
        long start = System.currentTimeMillis();

        try {
            Order order = new Order();
            order.setUserId(request.getUserId());
            order.setProductId(request.getProductId());
            return orderRepository.save(order);
        } finally {
            log.info("è®¢å•åˆ›å»ºå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
        }
    }
}

// ç‰ˆæœ¬3ï¼šåŠ å…¥äº‹åŠ¡
public class OrderService {
    public Order createOrder(OrderRequest request) {
        log.info("å¼€å§‹åˆ›å»ºè®¢å•: {}", request);
        long start = System.currentTimeMillis();

        Connection conn = null;
        try {
            conn = getConnection();
            conn.setAutoCommit(false);  // äº‹åŠ¡å¼€å§‹

            Order order = new Order();
            order.setUserId(request.getUserId());
            order.setProductId(request.getProductId());
            orderRepository.save(order, conn);

            conn.commit();  // äº‹åŠ¡æäº¤
            return order;
        } catch (Exception e) {
            if (conn != null) {
                conn.rollback();  // äº‹åŠ¡å›æ»š
            }
            throw e;
        } finally {
            if (conn != null) {
                conn.close();
            }
            log.info("è®¢å•åˆ›å»ºå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
        }
    }
}

// ç‰ˆæœ¬4ï¼šåŠ å…¥æƒé™æ£€æŸ¥
public class OrderService {
    public Order createOrder(OrderRequest request) {
        // æƒé™æ£€æŸ¥
        User user = getCurrentUser();
        if (!user.hasPermission("CREATE_ORDER")) {
            throw new PermissionException("æ— æƒé™");
        }

        log.info("å¼€å§‹åˆ›å»ºè®¢å•: {}", request);
        long start = System.currentTimeMillis();

        Connection conn = null;
        try {
            conn = getConnection();
            conn.setAutoCommit(false);

            Order order = new Order();
            order.setUserId(request.getUserId());
            order.setProductId(request.getProductId());
            orderRepository.save(order, conn);

            conn.commit();
            return order;
        } catch (Exception e) {
            if (conn != null) {
                conn.rollback();
            }
            throw e;
        } finally {
            if (conn != null) {
                conn.close();
            }
            log.info("è®¢å•åˆ›å»ºå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
        }
    }
}

// ç‰ˆæœ¬5ï¼šåŠ å…¥ç¼“å­˜
public class OrderService {
    public Order createOrder(OrderRequest request) {
        // æƒé™æ£€æŸ¥
        User user = getCurrentUser();
        if (!user.hasPermission("CREATE_ORDER")) {
            throw new PermissionException("æ— æƒé™");
        }

        // ç¼“å­˜æ£€æŸ¥
        String cacheKey = "order:" + request.getUserId() + ":" + request.getProductId();
        Order cached = cache.get(cacheKey);
        if (cached != null) {
            return cached;
        }

        log.info("å¼€å§‹åˆ›å»ºè®¢å•: {}", request);
        long start = System.currentTimeMillis();

        Connection conn = null;
        try {
            conn = getConnection();
            conn.setAutoCommit(false);

            Order order = new Order();
            order.setUserId(request.getUserId());
            order.setProductId(request.getProductId());
            orderRepository.save(order, conn);

            conn.commit();

            // å†™å…¥ç¼“å­˜
            cache.put(cacheKey, order);

            return order;
        } catch (Exception e) {
            if (conn != null) {
                conn.rollback();
            }
            throw e;
        } finally {
            if (conn != null) {
                conn.close();
            }
            log.info("è®¢å•åˆ›å»ºå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
        }
    }
}

// ç»Ÿè®¡ï¼š
ç‰ˆæœ¬1ï¼ˆç†æƒ³ï¼‰ï¼š6è¡Œä¸šåŠ¡é€»è¾‘
ç‰ˆæœ¬5ï¼ˆç°å®ï¼‰ï¼š50è¡Œä»£ç 
  â”œâ”€ ä¸šåŠ¡é€»è¾‘ï¼š6è¡Œï¼ˆ12%ï¼‰
  â”œâ”€ æƒé™æ£€æŸ¥ï¼š5è¡Œï¼ˆ10%ï¼‰
  â”œâ”€ æ—¥å¿—è®°å½•ï¼š8è¡Œï¼ˆ16%ï¼‰
  â”œâ”€ äº‹åŠ¡ç®¡ç†ï¼š15è¡Œï¼ˆ30%ï¼‰
  â””â”€ ç¼“å­˜ç®¡ç†ï¼š16è¡Œï¼ˆ32%ï¼‰

é—®é¢˜ï¼š
âŒ ä¸šåŠ¡é€»è¾‘è¢«æ·¹æ²¡åœ¨æ¡†æ¶ä»£ç ä¸­ï¼ˆ88%éä¸šåŠ¡ä»£ç ï¼‰
âŒ æ¯ä¸ªæ–¹æ³•éƒ½è¦é‡å¤å†™æƒé™ã€æ—¥å¿—ã€äº‹åŠ¡ã€ç¼“å­˜ä»£ç 
âŒ æ¨ªåˆ‡å…³æ³¨ç‚¹æ— æ³•å¤ç”¨
âŒ ä¿®æ”¹æ—¥å¿—æ ¼å¼éœ€è¦æ”¹æ‰€æœ‰æ–¹æ³•
```

#### 1.2 ä»€ä¹ˆæ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Ÿ

```
è½¯ä»¶ç³»ç»Ÿçš„ä¸¤ç±»å…³æ³¨ç‚¹ï¼š
â”œâ”€ æ ¸å¿ƒå…³æ³¨ç‚¹ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ï¼šè®¢å•åˆ›å»ºã€æ”¯ä»˜å¤„ç†ã€åº“å­˜æ‰£å‡
â””â”€ æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆæŠ€æœ¯æ€§åŠŸèƒ½ï¼‰ï¼šæ—¥å¿—ã€äº‹åŠ¡ã€æƒé™ã€ç¼“å­˜ã€ç›‘æ§

æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ç‰¹ç‚¹ï¼š
â”œâ”€ ä¸ä¸šåŠ¡é€»è¾‘æ­£äº¤ï¼ˆä¸å±äºæ ¸å¿ƒä¸šåŠ¡ï¼‰
â”œâ”€ æ•£å¸ƒåœ¨å¤šä¸ªæ¨¡å—ï¼ˆæ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦ï¼‰
â”œâ”€ ä»£ç é‡å¤ï¼ˆç±»ä¼¼é€»è¾‘é‡å¤å‡ºç°ï¼‰
â””â”€ éš¾ä»¥ç»´æŠ¤ï¼ˆä¿®æ”¹ä¸€å¤„éœ€è¦æ”¹å¤šå¤„ï¼‰

OOPçš„å±€é™æ€§ï¼š
OOPæ“…é•¿çºµå‘æŠ½è±¡ï¼ˆç»§æ‰¿ã€å°è£…ã€å¤šæ€ï¼‰
OOPä¸æ“…é•¿æ¨ªå‘æŠ½è±¡ï¼ˆæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      UserService               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ—¥å¿— | äº‹åŠ¡ | æƒé™ | ç¼“å­˜ â”‚ â”‚ â† æ¨ªåˆ‡å…³æ³¨ç‚¹
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ä¸šåŠ¡é€»è¾‘               â”‚ â”‚ â† æ ¸å¿ƒå…³æ³¨ç‚¹
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      OrderService              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ—¥å¿— | äº‹åŠ¡ | æƒé™ | ç¼“å­˜ â”‚ â”‚ â† æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆé‡å¤ï¼‰
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ä¸šåŠ¡é€»è¾‘               â”‚ â”‚ â† æ ¸å¿ƒå…³æ³¨ç‚¹
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AOPçš„ç›®æ ‡ï¼š
  å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­æŠ½å–å‡ºæ¥
  å®ç°å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰
```

---

### äºŒã€ä»£ç†æ¨¡å¼ï¼šAOPçš„åŸºç¡€ï¼ˆ4000å­—ï¼‰

**ç›®æ ‡**: ç†è§£AOPçš„å®ç°åŸºç¡€

#### 2.1 é™æ€ä»£ç†

```java
// ç›®æ ‡å¯¹è±¡æ¥å£
public interface UserService {
    void createUser(User user);
}

// ç›®æ ‡å¯¹è±¡å®ç°
public class UserServiceImpl implements UserService {
    @Override
    public void createUser(User user) {
        System.out.println("åˆ›å»ºç”¨æˆ·: " + user);
    }
}

// ä»£ç†å¯¹è±¡ï¼ˆæ‰‹åŠ¨ç¼–å†™ï¼‰
public class UserServiceProxy implements UserService {
    private UserService target;

    public UserServiceProxy(UserService target) {
        this.target = target;
    }

    @Override
    public void createUser(User user) {
        // å‰ç½®å¢å¼ºï¼šæ—¥å¿—
        System.out.println("Before: createUser");
        long start = System.currentTimeMillis();

        try {
            // è°ƒç”¨ç›®æ ‡æ–¹æ³•
            target.createUser(user);

            // åç½®å¢å¼ºï¼šæ—¥å¿—
            System.out.println("After: createUserï¼Œè€—æ—¶: " + (System.currentTimeMillis() - start) + "ms");
        } catch (Exception e) {
            // å¼‚å¸¸å¢å¼ºï¼šæ—¥å¿—
            System.out.println("Exception: createUser - " + e.getMessage());
            throw e;
        }
    }
}

// ä½¿ç”¨ä»£ç†
public class Main {
    public static void main(String[] args) {
        UserService target = new UserServiceImpl();
        UserService proxy = new UserServiceProxy(target);

        proxy.createUser(new User());  // è°ƒç”¨ä»£ç†å¯¹è±¡
    }
}

// è¾“å‡ºï¼š
Before: createUser
åˆ›å»ºç”¨æˆ·: User[...]
After: createUserï¼Œè€—æ—¶: 5ms

é™æ€ä»£ç†çš„ä¼˜ç¼ºç‚¹ï¼š
âœ… å®ç°ç®€å•
âœ… æ˜“äºç†è§£
âŒ æ¯ä¸ªæ¥å£éƒ½è¦å†™ä¸€ä¸ªä»£ç†ç±»ï¼ˆä»£ç è†¨èƒ€ï¼‰
âŒ æ¥å£æ–¹æ³•å¢åŠ ï¼Œä»£ç†ç±»ä¹Ÿè¦ä¿®æ”¹
âŒ ä¸å¤Ÿçµæ´»ï¼ˆæ— æ³•åŠ¨æ€åˆ‡æ¢å¢å¼ºé€»è¾‘ï¼‰
```

#### 2.2 JDKåŠ¨æ€ä»£ç†

```java
// JDKåŠ¨æ€ä»£ç†ï¼šåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†
public class JdkProxyExample {
    public static void main(String[] args) {
        // ç›®æ ‡å¯¹è±¡
        UserService target = new UserServiceImpl();

        // åˆ›å»ºä»£ç†å¯¹è±¡
        UserService proxy = (UserService) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),  // ç±»åŠ è½½å™¨
            target.getClass().getInterfaces(),   // æ¥å£åˆ—è¡¨
            new InvocationHandler() {            // è°ƒç”¨å¤„ç†å™¨
                @Override
                public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                    // å‰ç½®å¢å¼º
                    System.out.println("Before: " + method.getName());
                    long start = System.currentTimeMillis();

                    try {
                        // è°ƒç”¨ç›®æ ‡æ–¹æ³•
                        Object result = method.invoke(target, args);

                        // åç½®å¢å¼º
                        System.out.println("After: " + method.getName() + "ï¼Œè€—æ—¶: " + (System.currentTimeMillis() - start) + "ms");

                        return result;
                    } catch (Exception e) {
                        // å¼‚å¸¸å¢å¼º
                        System.out.println("Exception: " + method.getName() + " - " + e.getMessage());
                        throw e;
                    }
                }
            }
        );

        // ä½¿ç”¨ä»£ç†å¯¹è±¡
        proxy.createUser(new User());
    }
}

// è¾“å‡ºï¼š
Before: createUser
åˆ›å»ºç”¨æˆ·: User[...]
After: createUserï¼Œè€—æ—¶: 5ms

JDKåŠ¨æ€ä»£ç†çš„ä¼˜ç¼ºç‚¹ï¼š
âœ… åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼ˆæ— éœ€æ‰‹åŠ¨ç¼–å†™ï¼‰
âœ… çµæ´»ï¼ˆå¯ä»¥åŠ¨æ€åˆ‡æ¢å¢å¼ºé€»è¾‘ï¼‰
âŒ å¿…é¡»å®ç°æ¥å£ï¼ˆæ— æ³•ä»£ç†æ²¡æœ‰æ¥å£çš„ç±»ï¼‰
âŒ åªèƒ½ä»£ç†æ¥å£æ–¹æ³•ï¼ˆæ— æ³•ä»£ç†ç±»çš„ç§æœ‰æ–¹æ³•ï¼‰

JDKåŠ¨æ€ä»£ç†åŸç†ï¼š
1. Proxy.newProxyInstance()ç”Ÿæˆä»£ç†ç±»å­—èŠ‚ç 
2. ä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£
3. ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨InvocationHandler.invoke()
4. invoke()ä¸­è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å¹¶å¢å¼º
```

#### 2.3 CGLIBåŠ¨æ€ä»£ç†

```java
// CGLIBåŠ¨æ€ä»£ç†ï¼šåŸºäºç»§æ‰¿çš„åŠ¨æ€ä»£ç†
public class CglibProxyExample {
    public static void main(String[] args) {
        // ç›®æ ‡å¯¹è±¡ç±»ï¼ˆæ— éœ€æ¥å£ï¼‰
        class UserService {
            public void createUser(User user) {
                System.out.println("åˆ›å»ºç”¨æˆ·: " + user);
            }
        }

        // åˆ›å»ºCGLIBä»£ç†
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(UserService.class);  // è®¾ç½®çˆ¶ç±»
        enhancer.setCallback(new MethodInterceptor() {  // è®¾ç½®å›è°ƒ
            @Override
            public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
                // å‰ç½®å¢å¼º
                System.out.println("Before: " + method.getName());
                long start = System.currentTimeMillis();

                try {
                    // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
                    Object result = proxy.invokeSuper(obj, args);

                    // åç½®å¢å¼º
                    System.out.println("After: " + method.getName() + "ï¼Œè€—æ—¶: " + (System.currentTimeMillis() - start) + "ms");

                    return result;
                } catch (Exception e) {
                    // å¼‚å¸¸å¢å¼º
                    System.out.println("Exception: " + method.getName() + " - " + e.getMessage());
                    throw e;
                }
            }
        });

        // åˆ›å»ºä»£ç†å¯¹è±¡
        UserService proxy = (UserService) enhancer.create();

        // ä½¿ç”¨ä»£ç†å¯¹è±¡
        proxy.createUser(new User());
    }
}

// è¾“å‡ºï¼š
Before: createUser
åˆ›å»ºç”¨æˆ·: User[...]
After: createUserï¼Œè€—æ—¶: 5ms

CGLIBåŠ¨æ€ä»£ç†çš„ä¼˜ç¼ºç‚¹ï¼š
âœ… æ— éœ€æ¥å£ï¼ˆå¯ä»¥ä»£ç†æ²¡æœ‰æ¥å£çš„ç±»ï¼‰
âœ… çµæ´»ï¼ˆå¯ä»¥åŠ¨æ€åˆ‡æ¢å¢å¼ºé€»è¾‘ï¼‰
âŒ æ— æ³•ä»£ç†finalç±»å’Œfinalæ–¹æ³•
âŒ æ€§èƒ½ç•¥ä½äºJDKåŠ¨æ€ä»£ç†ï¼ˆç”Ÿæˆå­ç±»å­—èŠ‚ç ï¼‰

CGLIBåŠ¨æ€ä»£ç†åŸç†ï¼š
1. Enhancer.create()ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»å­—èŠ‚ç 
2. å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•
3. å­ç±»æ–¹æ³•è°ƒç”¨MethodInterceptor.intercept()
4. intercept()ä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³•å¹¶å¢å¼º
```

#### 2.4 JDKåŠ¨æ€ä»£ç† vs CGLIBå¯¹æ¯”

| ç»´åº¦ | JDKåŠ¨æ€ä»£ç† | CGLIBåŠ¨æ€ä»£ç† |
|------|------------|--------------|
| å®ç°æ–¹å¼ | åŸºäºæ¥å£ï¼ˆProxy+InvocationHandlerï¼‰| åŸºäºç»§æ‰¿ï¼ˆEnhancer+MethodInterceptorï¼‰|
| ä»£ç†å¯¹è±¡ | å®ç°ç›®æ ‡æ¥å£ | ç»§æ‰¿ç›®æ ‡ç±» |
| é™åˆ¶ | å¿…é¡»æœ‰æ¥å£ | ä¸èƒ½ä»£ç†finalç±»/æ–¹æ³• |
| æ€§èƒ½ | ç•¥é«˜ | ç•¥ä½ï¼ˆé¦–æ¬¡åˆ›å»ºæ…¢ï¼‰|
| Springé»˜è®¤ | æœ‰æ¥å£æ—¶ä½¿ç”¨ | æ— æ¥å£æ—¶ä½¿ç”¨ |

---

### ä¸‰ã€Spring AOPæ ¸å¿ƒæ¦‚å¿µï¼ˆ4500å­—ï¼‰

**ç›®æ ‡**: æŒæ¡Spring AOPçš„å®Œæ•´ä½“ç³»

#### 3.1 AOPæ ¸å¿ƒæœ¯è¯­

```java
// 1. Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹çš„æ¨¡å—åŒ–
@Aspect
@Component
public class LoggingAspect {
    // åˆ‡é¢åŒ…å«ï¼šåˆ‡ç‚¹+é€šçŸ¥
}

// 2. Join Pointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼šæ–¹æ³•æ‰§è¡Œç‚¹
// ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æŸä¸ªç‚¹ï¼ˆæ–¹æ³•è°ƒç”¨ã€å¼‚å¸¸æŠ›å‡ºï¼‰

// 3. Pointcutï¼ˆåˆ‡ç‚¹ï¼‰ï¼šåŒ¹é…è¿æ¥ç‚¹çš„è¡¨è¾¾å¼
@Pointcut("execution(* com.example.service.*.*(..))")
public void serviceMethods() {
    // åŒ¹é…serviceåŒ…ä¸‹æ‰€æœ‰æ–¹æ³•
}

// 4. Adviceï¼ˆé€šçŸ¥ï¼‰ï¼šåœ¨åˆ‡ç‚¹æ‰§è¡Œçš„ä»£ç 
@Before("serviceMethods()")
public void logBefore(JoinPoint joinPoint) {
    System.out.println("Before: " + joinPoint.getSignature());
}

// 5. Target Objectï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ï¼šè¢«ä»£ç†çš„å¯¹è±¡
@Service
public class UserService {
    public void createUser(User user) {
        // ç›®æ ‡æ–¹æ³•
    }
}

// 6. AOP Proxyï¼ˆAOPä»£ç†ï¼‰ï¼šä»£ç†å¯¹è±¡
// Springåˆ›å»ºçš„ä»£ç†å¯¹è±¡ï¼ˆJDKåŠ¨æ€ä»£ç†æˆ–CGLIBä»£ç†ï¼‰

// 7. Weavingï¼ˆç»‡å…¥ï¼‰ï¼šå°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡çš„è¿‡ç¨‹
// ç¼–è¯‘æ—¶ç»‡å…¥ï¼šAspectJ
// è¿è¡Œæ—¶ç»‡å…¥ï¼šSpring AOP

// å®Œæ•´ç¤ºä¾‹
@Aspect
@Component
public class LoggingAspect {
    // åˆ‡ç‚¹ï¼šserviceåŒ…ä¸‹æ‰€æœ‰publicæ–¹æ³•
    @Pointcut("execution(public * com.example.service.*.*(..))")
    public void serviceMethods() {
    }

    // å‰ç½®é€šçŸ¥
    @Before("serviceMethods()")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("Before: " + joinPoint.getSignature());
    }

    // åç½®é€šçŸ¥
    @After("serviceMethods()")
    public void logAfter(JoinPoint joinPoint) {
        System.out.println("After: " + joinPoint.getSignature());
    }

    // è¿”å›é€šçŸ¥
    @AfterReturning(pointcut = "serviceMethods()", returning = "result")
    public void logAfterReturning(JoinPoint joinPoint, Object result) {
        System.out.println("AfterReturning: " + joinPoint.getSignature() + ", result=" + result);
    }

    // å¼‚å¸¸é€šçŸ¥
    @AfterThrowing(pointcut = "serviceMethods()", throwing = "ex")
    public void logAfterThrowing(JoinPoint joinPoint, Exception ex) {
        System.out.println("AfterThrowing: " + joinPoint.getSignature() + ", exception=" + ex.getMessage());
    }

    // ç¯ç»•é€šçŸ¥
    @Around("serviceMethods()")
    public Object logAround(ProceedingJoinPoint pjp) throws Throwable {
        System.out.println("Around Before: " + pjp.getSignature());
        long start = System.currentTimeMillis();

        try {
            Object result = pjp.proceed();  // è°ƒç”¨ç›®æ ‡æ–¹æ³•
            System.out.println("Around After: " + pjp.getSignature() + ", è€—æ—¶: " + (System.currentTimeMillis() - start) + "ms");
            return result;
        } catch (Exception e) {
            System.out.println("Around Exception: " + pjp.getSignature() + ", exception=" + e.getMessage());
            throw e;
        }
    }
}
```

#### 3.2 äº”ç§é€šçŸ¥ç±»å‹è¯¦è§£

```java
// ç›®æ ‡æ–¹æ³•
@Service
public class UserService {
    public String createUser(User user) {
        System.out.println("æ‰§è¡Œä¸šåŠ¡é€»è¾‘: createUser");
        if (user.getName() == null) {
            throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        }
        return "success";
    }
}

// åˆ‡é¢
@Aspect
@Component
public class AllAdviceAspect {

    // 1. @Beforeï¼šå‰ç½®é€šçŸ¥ï¼ˆæ–¹æ³•æ‰§è¡Œå‰ï¼‰
    @Before("execution(* com.example.service.UserService.createUser(..))")
    public void before(JoinPoint joinPoint) {
        System.out.println("[@Before] æ–¹æ³•æ‰§è¡Œå‰");
    }

    // 2. @Afterï¼šåç½®é€šçŸ¥ï¼ˆæ–¹æ³•æ‰§è¡Œåï¼Œæ— è®ºæˆåŠŸæˆ–å¼‚å¸¸éƒ½æ‰§è¡Œï¼‰
    @After("execution(* com.example.service.UserService.createUser(..))")
    public void after(JoinPoint joinPoint) {
        System.out.println("[@After] æ–¹æ³•æ‰§è¡Œåï¼ˆfinallyï¼‰");
    }

    // 3. @AfterReturningï¼šè¿”å›é€šçŸ¥ï¼ˆæ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œï¼‰
    @AfterReturning(pointcut = "execution(* com.example.service.UserService.createUser(..))",
                    returning = "result")
    public void afterReturning(JoinPoint joinPoint, Object result) {
        System.out.println("[@AfterReturning] æ–¹æ³•æ­£å¸¸è¿”å›ï¼Œresult=" + result);
    }

    // 4. @AfterThrowingï¼šå¼‚å¸¸é€šçŸ¥ï¼ˆæ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œï¼‰
    @AfterThrowing(pointcut = "execution(* com.example.service.UserService.createUser(..))",
                   throwing = "ex")
    public void afterThrowing(JoinPoint joinPoint, Exception ex) {
        System.out.println("[@AfterThrowing] æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œexception=" + ex.getMessage());
    }

    // 5. @Aroundï¼šç¯ç»•é€šçŸ¥ï¼ˆåŒ…å›´æ–¹æ³•æ‰§è¡Œï¼Œæœ€å¼ºå¤§ï¼‰
    @Around("execution(* com.example.service.UserService.createUser(..))")
    public Object around(ProceedingJoinPoint pjp) throws Throwable {
        System.out.println("[@Around Before] ç¯ç»•é€šçŸ¥-å‰");

        try {
            Object result = pjp.proceed();  // è°ƒç”¨ç›®æ ‡æ–¹æ³•
            System.out.println("[@Around After] ç¯ç»•é€šçŸ¥-å");
            return result;
        } catch (Exception e) {
            System.out.println("[@Around Exception] ç¯ç»•é€šçŸ¥-å¼‚å¸¸");
            throw e;
        }
    }
}

// æ‰§è¡Œé¡ºåºï¼ˆæ­£å¸¸æƒ…å†µï¼‰ï¼š
[@Around Before] ç¯ç»•é€šçŸ¥-å‰
[@Before] æ–¹æ³•æ‰§è¡Œå‰
æ‰§è¡Œä¸šåŠ¡é€»è¾‘: createUser
[@Around After] ç¯ç»•é€šçŸ¥-å
[@After] æ–¹æ³•æ‰§è¡Œåï¼ˆfinallyï¼‰
[@AfterReturning] æ–¹æ³•æ­£å¸¸è¿”å›ï¼Œresult=success

// æ‰§è¡Œé¡ºåºï¼ˆå¼‚å¸¸æƒ…å†µï¼‰ï¼š
[@Around Before] ç¯ç»•é€šçŸ¥-å‰
[@Before] æ–¹æ³•æ‰§è¡Œå‰
æ‰§è¡Œä¸šåŠ¡é€»è¾‘: createUser
[@Around Exception] ç¯ç»•é€šçŸ¥-å¼‚å¸¸
[@After] æ–¹æ³•æ‰§è¡Œåï¼ˆfinallyï¼‰
[@AfterThrowing] æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œexception=ç”¨æˆ·åä¸èƒ½ä¸ºç©º

// é€šçŸ¥æ‰§è¡Œé¡ºåºæ€»ç»“ï¼š
æ­£å¸¸æµç¨‹ï¼š@Around Before â†’ @Before â†’ ç›®æ ‡æ–¹æ³• â†’ @Around After â†’ @After â†’ @AfterReturning
å¼‚å¸¸æµç¨‹ï¼š@Around Before â†’ @Before â†’ ç›®æ ‡æ–¹æ³• â†’ @Around Exception â†’ @After â†’ @AfterThrowing
```

#### 3.3 åˆ‡ç‚¹è¡¨è¾¾å¼è¯¦è§£

```java
// 1. executionï¼šæœ€å¸¸ç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼
// è¯­æ³•ï¼šexecution(modifiers? return-type declaring-type?.method-name(params) throws?)

// 1.1 åŒ¹é…æ‰€æœ‰publicæ–¹æ³•
@Pointcut("execution(public * *(..))")

// 1.2 åŒ¹é…serviceåŒ…ä¸‹æ‰€æœ‰æ–¹æ³•
@Pointcut("execution(* com.example.service.*.*(..))")

// 1.3 åŒ¹é…serviceåŒ…åŠå­åŒ…ä¸‹æ‰€æœ‰æ–¹æ³•
@Pointcut("execution(* com.example.service..*.*(..))")

// 1.4 åŒ¹é…ä»¥createå¼€å¤´çš„æ–¹æ³•
@Pointcut("execution(* create*(..))")

// 1.5 åŒ¹é…è¿”å›Userç±»å‹çš„æ–¹æ³•
@Pointcut("execution(com.example.entity.User *(..))")

// 1.6 åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºLongç±»å‹çš„æ–¹æ³•
@Pointcut("execution(* *(Long, ..))")

// 1.7 åŒ¹é…UserServiceç±»çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("execution(* com.example.service.UserService.*(..))")

// 2. withinï¼šåŒ¹é…æŒ‡å®šç±»å‹å†…çš„æ–¹æ³•
// 2.1 åŒ¹é…UserServiceç±»å†…çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("within(com.example.service.UserService)")

// 2.2 åŒ¹é…serviceåŒ…å†…æ‰€æœ‰ç±»çš„æ–¹æ³•
@Pointcut("within(com.example.service.*)")

// 2.3 åŒ¹é…serviceåŒ…åŠå­åŒ…å†…æ‰€æœ‰ç±»çš„æ–¹æ³•
@Pointcut("within(com.example.service..*)")

// 3. thisï¼šåŒ¹é…ä»£ç†å¯¹è±¡æ˜¯æŒ‡å®šç±»å‹çš„æ–¹æ³•
@Pointcut("this(com.example.service.UserService)")

// 4. targetï¼šåŒ¹é…ç›®æ ‡å¯¹è±¡æ˜¯æŒ‡å®šç±»å‹çš„æ–¹æ³•
@Pointcut("target(com.example.service.UserService)")

// 5. argsï¼šåŒ¹é…å‚æ•°ç±»å‹çš„æ–¹æ³•
// 5.1 åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºUserç±»å‹çš„æ–¹æ³•
@Pointcut("args(com.example.entity.User, ..)")

// 5.2 åŒ¹é…å•ä¸ªå‚æ•°ä¸”å‚æ•°ç±»å‹ä¸ºUserçš„æ–¹æ³•
@Pointcut("args(com.example.entity.User)")

// 6. @annotationï¼šåŒ¹é…æœ‰æŒ‡å®šæ³¨è§£çš„æ–¹æ³•
// 6.1 åŒ¹é…æœ‰@Transactionalæ³¨è§£çš„æ–¹æ³•
@Pointcut("@annotation(org.springframework.transaction.annotation.Transactional)")

// 6.2 è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Loggable {
}

@Pointcut("@annotation(com.example.annotation.Loggable)")

// 7. @withinï¼šåŒ¹é…æœ‰æŒ‡å®šæ³¨è§£çš„ç±»å†…çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("@within(org.springframework.stereotype.Service)")

// 8. @targetï¼šåŒ¹é…ç›®æ ‡å¯¹è±¡æœ‰æŒ‡å®šæ³¨è§£çš„æ–¹æ³•
@Pointcut("@target(org.springframework.stereotype.Service)")

// 9. @argsï¼šåŒ¹é…å‚æ•°æœ‰æŒ‡å®šæ³¨è§£çš„æ–¹æ³•
@Pointcut("@args(com.example.annotation.Valid)")

// 10. beanï¼šåŒ¹é…Spring Beanåç§°ï¼ˆSpring AOPç‰¹æœ‰ï¼‰
// 10.1 åŒ¹é…åç§°ä¸ºuserServiceçš„Bean
@Pointcut("bean(userService)")

// 10.2 åŒ¹é…åç§°ä»¥Serviceç»“å°¾çš„Bean
@Pointcut("bean(*Service)")

// ç»„åˆåˆ‡ç‚¹è¡¨è¾¾å¼
// ä¸ï¼ˆ&&ï¼‰
@Pointcut("execution(* com.example.service.*.*(..)) && @annotation(com.example.annotation.Loggable)")

// æˆ–ï¼ˆ||ï¼‰
@Pointcut("execution(* com.example.service.*.*(..)) || execution(* com.example.controller.*.*(..))")

// éï¼ˆ!ï¼‰
@Pointcut("execution(* com.example.service.*.*(..)) && !execution(* com.example.service.InternalService.*(..))")

// æœ€ä½³å®è·µ
@Aspect
@Component
public class BestPracticeAspect {

    // 1. å®šä¹‰é€šç”¨åˆ‡ç‚¹
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceMethods() {
    }

    @Pointcut("@annotation(com.example.annotation.Loggable)")
    public void loggableMethods() {
    }

    // 2. ç»„åˆåˆ‡ç‚¹
    @Pointcut("serviceMethods() && loggableMethods()")
    public void serviceLoggableMethods() {
    }

    // 3. ä½¿ç”¨åˆ‡ç‚¹
    @Around("serviceLoggableMethods()")
    public Object logAround(ProceedingJoinPoint pjp) throws Throwable {
        // ...
    }
}
```

---

### å››ã€Spring AOPå®æˆ˜ï¼ˆ4000å­—ï¼‰

#### 4.1 æ¡ˆä¾‹1ï¼šç»Ÿä¸€æ—¥å¿—ç®¡ç†

```java
// è¯¦ç»†ä»£ç ç¤ºä¾‹å‚è€ƒä¸Šæ–‡æ–‡ç« 3çš„å®Œæ•´å†…å®¹...
```

#### 4.2 æ¡ˆä¾‹2ï¼šå£°æ˜å¼æƒé™æ§åˆ¶

```java
// è¯¦ç»†ä»£ç ç¤ºä¾‹å‚è€ƒä¸Šæ–‡æ–‡ç« 3çš„å®Œæ•´å†…å®¹...
```

---

### äº”ã€æ€»ç»“ä¸æœ€ä½³å®è·µï¼ˆ2500å­—ï¼‰

#### 5.1 AOPæ ¸å¿ƒä»·å€¼æ€»ç»“

```
AOPè§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š
â”œâ”€ ä»£ç é‡å¤ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹æŠ½å–ä¸ºåˆ‡é¢
â”œâ”€ å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¸šåŠ¡é€»è¾‘ä¸æŠ€æœ¯æ€§åŠŸèƒ½åˆ†ç¦»
â”œâ”€ å¯ç»´æŠ¤æ€§ï¼šä¿®æ”¹æ—¥å¿—/äº‹åŠ¡é€»è¾‘åªéœ€æ”¹ä¸€å¤„
â””â”€ å£°æ˜å¼ç¼–ç¨‹ï¼š@Transactionalã€@Cacheableç­‰æ³¨è§£

å¤æ‚åº¦å¯¹æ¯”ï¼š
æ— AOPï¼ˆ100è¡Œï¼‰â†’ é™æ€ä»£ç†ï¼ˆ50è¡Œï¼‰â†’ åŠ¨æ€ä»£ç†ï¼ˆ30è¡Œï¼‰â†’ Spring AOPï¼ˆ10è¡Œï¼‰
```

#### 5.2 ä½•æ—¶ä½¿ç”¨AOP

**âœ… é€‚åˆä½¿ç”¨AOP**:
- æ—¥å¿—è®°å½•ã€æƒé™æ§åˆ¶ã€äº‹åŠ¡ç®¡ç†
- æ€§èƒ½ç›‘æ§ã€å¼‚å¸¸å¤„ç†ã€ç¼“å­˜ç®¡ç†
- åˆ†å¸ƒå¼é”ã€å‚æ•°æ ¡éªŒ

**âŒ ä¸é€‚åˆä½¿ç”¨AOP**:
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- ç§æœ‰æ–¹æ³•ã€finalæ–¹æ³•
- åŒç±»æ–¹æ³•è°ƒç”¨

---

## ğŸ“– æ–‡ç« 4-6ï¼šæ¡†æ¶è§„åˆ’

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ–‡ç« 4-6çš„è¯¦ç»†å¤§çº²å°†åœ¨åç»­è¿­ä»£ä¸­æŒç»­è¡¥å……å®Œå–„ã€‚

### æ–‡ç« 4ï¼šã€ŠSpring Bootè‡ªåŠ¨é…ç½®åŸç†ã€‹ï¼ˆå¾…è¯¦ç»†å±•å¼€ï¼‰

**æ ¸å¿ƒæ–¹å‘**:
1. ä¼ ç»ŸSpring XMLé…ç½®åœ°ç‹±
2. Spring Bootä¸‰å¤§æ³•å®ï¼ˆè‡ªåŠ¨é…ç½®ã€Starterã€å†…åµŒå®¹å™¨ï¼‰
3. @SpringBootApplicationæ³¨è§£æ‹†è§£
4. è‡ªåŠ¨é…ç½®åŠ è½½æµç¨‹ï¼ˆAutoConfigurationImportSelectorï¼‰
5. æ¡ä»¶è£…é…ä½“ç³»ï¼ˆ@Conditionalç³»åˆ—æ³¨è§£ï¼‰
6. é…ç½®ä¼˜å…ˆçº§ï¼ˆymlã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œï¼‰
7. æ‰‹å†™è‡ªå®šä¹‰Starter

**å¾…è¡¥å……å†…å®¹**:
- æ¯ä¸ªç« èŠ‚çš„è¯¦ç»†ä»£ç ç¤ºä¾‹
- æ¸è¿›å¼åœºæ™¯æ¼”åŒ–
- æ‰‹åŠ¨é…ç½® vs è‡ªåŠ¨é…ç½®çš„å¯¹æ¯”
- å®Œæ•´çš„Starterå¼€å‘æµç¨‹

### æ–‡ç« 5ï¼šã€ŠSpring Cloudå¾®æœåŠ¡æ¶æ„ã€‹ï¼ˆå¾…è¯¦ç»†å±•å¼€ï¼‰

**æ ¸å¿ƒæ–¹å‘**:
1. å•ä½“åº”ç”¨çš„å›°å¢ƒ
2. å¾®æœåŠ¡äº”å¤§æ ¸å¿ƒé—®é¢˜
3. Spring Cloudç»„ä»¶ä½“ç³»
4. å¾®æœåŠ¡æ‹†åˆ†åŸç†ï¼ˆåº·å¨å®šå¾‹ã€DDDï¼‰
5. åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ
6. å¾®æœåŠ¡çš„ä»£ä»·ä¸æƒè¡¡

**å¾…è¡¥å……å†…å®¹**:
- å¾®æœåŠ¡æ¶æ„æ¼”è¿›è¿‡ç¨‹
- æ¯ä¸ªç»„ä»¶çš„è¯¦ç»†å®ç°
- æœåŠ¡æ³¨å†Œå‘ç°çš„åŸç†
- ç†”æ–­é™çº§çš„ç®—æ³•
- é“¾è·¯è¿½è¸ªçš„å®ç°

### æ–‡ç« 6ï¼šã€ŠSpringæºç æ·±åº¦è§£æã€‹ï¼ˆå¾…è¯¦ç»†å±•å¼€ï¼‰

**æ ¸å¿ƒæ–¹å‘**:
1. å¦‚ä½•é˜…è¯»Springæºç 
2. IoCå®¹å™¨å¯åŠ¨æµç¨‹å‰–æ
3. AOPä»£ç†åˆ›å»ºæµç¨‹å‰–æ
4. @Transactionaläº‹åŠ¡ç®¡ç†å‰–æ
5. Springè®¾è®¡æ¨¡å¼ç²¾å
6. ç»ˆå±€æ€è€ƒï¼šSpringçš„æœªæ¥

**å¾…è¡¥å……å†…å®¹**:
- æºç é˜…è¯»å·¥å…·å’Œæ–¹æ³•
- refresh()æ–¹æ³•çš„12ä¸ªæ­¥éª¤è¯¦è§£
- BeanPostProcessoræ‰©å±•ç‚¹
- TransactionInterceptoræ‹¦æˆªå™¨é“¾
- GraalVMåŸç”Ÿç¼–è¯‘ä¼˜åŒ–

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸè®¡åˆ’ï¼ˆ1-2å‘¨ï¼‰
1. âœ… å®Œæˆæ–‡ç« 1-3çš„æ’°å†™ï¼ˆå·²å®Œæˆï¼‰
2. â³ è¡¥å……æ–‡ç« 4çš„è¯¦ç»†å¤§çº²ï¼ˆçº¦10000å­—ï¼‰
3. â³ è¡¥å……æ–‡ç« 5çš„è¯¦ç»†å¤§çº²ï¼ˆçº¦10000å­—ï¼‰
4. â³ è¡¥å……æ–‡ç« 6çš„è¯¦ç»†å¤§çº²ï¼ˆçº¦8000å­—ï¼‰

### ä¸­æœŸè®¡åˆ’ï¼ˆ1-2æœˆï¼‰
1. å®Œæˆæ–‡ç« 4çš„æ’°å†™ï¼ˆçº¦18000å­—ï¼‰
2. å®Œæˆæ–‡ç« 5çš„æ’°å†™ï¼ˆçº¦19000å­—ï¼‰
3. å®Œæˆæ–‡ç« 6çš„æ’°å†™ï¼ˆçº¦15000å­—ï¼‰

### é•¿æœŸè®¡åˆ’ï¼ˆ3-6æœˆï¼‰
1. æ ¹æ®è¯»è€…åé¦ˆä¼˜åŒ–ç³»åˆ—å†…å®¹
2. è¡¥å……æ›´å¤šå®æˆ˜æ¡ˆä¾‹
3. åˆ¶ä½œç³»åˆ—æ–‡ç« çš„æ€ç»´å¯¼å›¾
4. è€ƒè™‘åˆ¶ä½œè§†é¢‘æ•™ç¨‹ç‰ˆæœ¬

---

## ğŸ“Š ç³»åˆ—ç»Ÿè®¡

**å½“å‰è¿›åº¦**:
- å·²å®Œæˆæ–‡ç« ï¼š3ç¯‡ï¼ˆæ–‡ç« 1ã€2ã€3ï¼‰
- å·²å®Œæˆå­—æ•°ï¼š49,000å­—ï¼ˆå®é™…æ–‡ç« ï¼‰+ 3400è¡Œè§„åˆ’æ–‡æ¡£
- å®Œæˆåº¦ï¼š50%ï¼ˆæ–‡ç« æ•°ï¼‰/ 55%ï¼ˆå­—æ•°ï¼‰

**è´¨é‡æŒ‡æ ‡**:
- å¹³å‡å•ç¯‡å­—æ•°ï¼š16,000å­—
- ä»£ç ç¤ºä¾‹æ•°ï¼šæ¯ç¯‡çº¦30+ä¸ª
- å¯¹æ¯”è¡¨æ ¼æ•°ï¼šæ¯ç¯‡çº¦10+ä¸ª
- æ¸è¿›å¼åœºæ™¯ï¼šæ¯ç¯‡5-6ä¸ª

**ç›®æ ‡å—ä¼—è¦†ç›–**:
- åˆçº§å¼€å‘è€…ï¼ˆç†è§£ä¸ºä»€ä¹ˆéœ€è¦Springï¼‰âœ…
- ä¸­çº§å¼€å‘è€…ï¼ˆæŒæ¡IoCã€AOPåŸç†ï¼‰âœ…
- é«˜çº§å¼€å‘è€…ï¼ˆæºç çº§ç†è§£ã€æ¶æ„è®¾è®¡ï¼‰â³

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-11-03
**æ›´æ–°äºº**: Claude
**ç‰ˆæœ¬**: v3.0ï¼ˆå·²å®Œæˆæ–‡ç« 2-3è¯¦ç»†å¤§çº²è¡¥å……ï¼Œæ–‡ç« 4-6æ¡†æ¶è§„åˆ’ï¼‰

**æ–‡æ¡£çŠ¶æ€**:
- âœ… æ€»ä½“è§„åˆ’ï¼šå®Œæˆ
- âœ… æ–‡ç« 1è¯¦ç»†å¤§çº²ï¼šå®Œæˆ
- âœ… æ–‡ç« 2è¯¦ç»†å¤§çº²ï¼šå®Œæˆï¼ˆæœ¬æ¬¡æ–°å¢ï¼Œçº¦1500è¡Œï¼‰
- âœ… æ–‡ç« 3è¯¦ç»†å¤§çº²ï¼šå®Œæˆï¼ˆæœ¬æ¬¡æ–°å¢ï¼Œçº¦700è¡Œï¼‰
- â³ æ–‡ç« 4è¯¦ç»†å¤§çº²ï¼šæ¡†æ¶å·²è§„åˆ’ï¼Œè¯¦ç»†å†…å®¹å¾…è¡¥å……
- â³ æ–‡ç« 5è¯¦ç»†å¤§çº²ï¼šæ¡†æ¶å·²è§„åˆ’ï¼Œè¯¦ç»†å†…å®¹å¾…è¡¥å……
- â³ æ–‡ç« 6è¯¦ç»†å¤§çº²ï¼šæ¡†æ¶å·²è§„åˆ’ï¼Œè¯¦ç»†å†…å®¹å¾…è¡¥å……

**ç³»åˆ—å®šä½**:
æœ¬ç³»åˆ—æ˜¯JavaæŠ€æœ¯ç”Ÿæ€çš„**æ ¸å¿ƒæ·±åº¦ç³»åˆ—**ï¼Œé‡‡ç”¨ç¬¬ä¸€æ€§åŸç†æ€ç»´ï¼Œç³»ç»ŸåŒ–æ‹†è§£Springæ¡†æ¶çš„è®¾è®¡ç†å¿µå’Œå®ç°åŸç†ã€‚ä¸åŒäºä¼ ç»Ÿæ•™ç¨‹çš„"å‘Šè¯‰ä½ æ€ä¹ˆç”¨"ï¼Œæœ¬ç³»åˆ—ä¸“æ³¨äº"ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡"ã€‚

**æ ¸å¿ƒå·®å¼‚**:
- ä¼ ç»Ÿæ•™ç¨‹ï¼šæ•™ä½ é…ç½®XMLã€å†™æ³¨è§£
- æœ¬ç³»åˆ—ï¼šå‘Šè¯‰ä½ ä¸ºä»€ä¹ˆéœ€è¦IoCã€ä¸ºä»€ä¹ˆéœ€è¦AOPã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨é…ç½®

**å†™ä½œå“²å­¦**:
- ç¬¬ä¸€æ€§åŸç†æ€ç»´ï¼šä»æ ¹æœ¬é—®é¢˜å‡ºå‘
- æ¸è¿›å¼å¤æ‚åº¦ï¼šä»ç®€å•åˆ°å¤æ‚é€æ­¥æ¼”è¿›
- å¯¹æ¯”å¼è®ºè¯ï¼šæ‰‹åŠ¨å®ç° vs Springå®ç°
- å®æˆ˜æ¡ˆä¾‹é©±åŠ¨ï¼šçœŸå®ä¸šåŠ¡åœºæ™¯

**é¢„æœŸæ•ˆæœ**:
è¯»è€…é€šè¿‡æœ¬ç³»åˆ—ï¼Œä¸ä»…èƒ½æŒæ¡Springçš„ä½¿ç”¨ï¼Œæ›´èƒ½ç†è§£Springçš„è®¾è®¡æ€æƒ³ï¼ŒåŸ¹å…»ç¬¬ä¸€æ€§åŸç†æ€ç»´æ–¹å¼ï¼Œå…·å¤‡ç‹¬ç«‹æ¶æ„è®¾è®¡èƒ½åŠ›ã€‚
