---
title: "æ¨¡å—6ï¼šéƒ¨ç½²åº”ç”¨åˆ°K8s"
date: 2026-01-29T11:06:00+08:00
draft: false
tags: ["Kubernetes", "é˜¿é‡Œäº‘", "ACK", "SOP", "æ•™ç¨‹", "Deployment"]
categories: ["æŠ€æœ¯"]
series: ["é˜¿é‡Œäº‘ACKéƒ¨ç½²SOP"]
weight: 6
description: "è¯¦ç»†è®²è§£å¦‚ä½•å°†åº”ç”¨éƒ¨ç½²åˆ°Kubernetesé›†ç¾¤ï¼ŒåŒ…æ‹¬Deploymentã€Serviceã€Ingressé…ç½®"
---

## å¯¼èˆª

- **ä¸Šä¸€æ­¥**ï¼š[æ¨¡å—5ï¼šæ„å»ºDockeré•œåƒ](/blog/devops/posts/2026-01-29-ack-sop-05-docker-build/)
- **ä¸‹ä¸€æ­¥**ï¼š[æ¨¡å—7ï¼šæ•…éšœæ’æŸ¥å’Œä¼˜åŒ–](/blog/devops/posts/2026-01-29-ack-sop-07-troubleshooting/)
- **è¿”å›ä¸»ç´¢å¼•**ï¼š[é˜¿é‡Œäº‘ACKéƒ¨ç½²SOP](/blog/devops/posts/2026-01-29-aliyun-ack-deployment-sop/)

---

## æ¨¡å—æ¦‚è¿°

**é¢„è®¡æ—¶é—´**ï¼š30åˆ†é’Ÿ

**æœ¬æ¨¡å—ç›®æ ‡**ï¼š
- âœ… ç†è§£Kubernetesæ ¸å¿ƒèµ„æºï¼ˆNamespaceã€Deploymentã€Serviceã€Ingressï¼‰
- âœ… åˆ›å»ºå®Œæ•´çš„åº”ç”¨é…ç½®æ–‡ä»¶
- âœ… éƒ¨ç½²åº”ç”¨åˆ°Kubernetesé›†ç¾¤
- âœ… é…ç½®å¥åº·æ£€æŸ¥å’Œèµ„æºé™åˆ¶
- âœ… é€šè¿‡åŸŸåè®¿é—®åº”ç”¨
- âœ… éªŒè¯è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨

**æˆæœ¬è¯´æ˜**ï¼š
- æœ¬æ¨¡å—ä¸äº§ç”Ÿé¢å¤–è´¹ç”¨
- ä½¿ç”¨å·²æœ‰çš„ACKé›†ç¾¤å’ŒALBå®ä¾‹

---

## æ­¥éª¤6.1ï¼šç†è§£Kubernetesæ ¸å¿ƒèµ„æº

### ğŸ¬ æ“ä½œè¯´æ˜
åœ¨å¼€å§‹éƒ¨ç½²ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£Kubernetesçš„æ ¸å¿ƒèµ„æºã€‚è¿™äº›èµ„æºæ˜¯éƒ¨ç½²åº”ç”¨çš„åŸºç¡€ï¼Œç†è§£å®ƒä»¬çš„ä½œç”¨å’Œå…³ç³»éå¸¸é‡è¦ã€‚

### ğŸ“ è¯¦ç»†è¯´æ˜

**Kubernetesèµ„æºå±‚çº§å…³ç³»**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ingressï¼ˆå¤–ç½‘è®¿é—®å…¥å£ï¼‰                  â”‚
â”‚  - åŸŸåè·¯ç”±                              â”‚
â”‚  - SSLè¯ä¹¦                               â”‚
â”‚  - ä¸ƒå±‚è´Ÿè½½å‡è¡¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Serviceï¼ˆæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼‰            â”‚
â”‚  - ClusterIPï¼ˆé›†ç¾¤å†…éƒ¨è®¿é—®ï¼‰             â”‚
â”‚  - è‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªPod                 â”‚
â”‚  - æœåŠ¡å‘ç°ï¼ˆé€šè¿‡DNSï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deploymentï¼ˆç®¡ç†Podå‰¯æœ¬ï¼‰                â”‚
â”‚  - å£°æ˜æœŸæœ›çš„å‰¯æœ¬æ•°                      â”‚
â”‚  - è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†Pod                     â”‚
â”‚  - æ»šåŠ¨æ›´æ–°å’Œå›æ»š                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Podï¼ˆæœ€å°éƒ¨ç½²å•å…ƒï¼‰                      â”‚
â”‚  - è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨                    â”‚
â”‚  - å…±äº«ç½‘ç»œå’Œå­˜å‚¨                        â”‚
â”‚  - ç”Ÿå‘½å‘¨æœŸç®¡ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Containerï¼ˆå®¹å™¨ï¼‰                        â”‚
â”‚  - è¿è¡ŒDockeré•œåƒ                        â”‚
â”‚  - éš”ç¦»çš„è¿è¡Œç¯å¢ƒ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒèµ„æºè¯¦è§£**

**1. Namespaceï¼ˆå‘½åç©ºé—´ï¼‰**

ä½œç”¨ï¼š
- èµ„æºéš”ç¦»ï¼šä¸åŒçš„åº”ç”¨æˆ–ç¯å¢ƒä½¿ç”¨ä¸åŒçš„Namespace
- æƒé™æ§åˆ¶ï¼šå¯ä»¥ä¸ºä¸åŒçš„Namespaceè®¾ç½®ä¸åŒçš„æƒé™
- èµ„æºé…é¢ï¼šå¯ä»¥é™åˆ¶æ¯ä¸ªNamespaceçš„èµ„æºä½¿ç”¨é‡

ç¤ºä¾‹åœºæ™¯ï¼š
- `dev`ï¼šå¼€å‘ç¯å¢ƒ
- `test`ï¼šæµ‹è¯•ç¯å¢ƒ
- `prod`ï¼šç”Ÿäº§ç¯å¢ƒ

**2. Deploymentï¼ˆéƒ¨ç½²ï¼‰**

ä½œç”¨ï¼š
- ç®¡ç†Podå‰¯æœ¬ï¼šå£°æ˜æœŸæœ›çš„å‰¯æœ¬æ•°ï¼ŒKubernetesè‡ªåŠ¨ç»´æŠ¤
- æ»šåŠ¨æ›´æ–°ï¼šæ›´æ–°åº”ç”¨æ—¶ï¼Œé€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬ï¼Œä¸ä¸­æ–­æœåŠ¡
- è‡ªåŠ¨æ¢å¤ï¼šPodæ•…éšœæ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°çš„Podæ›¿æ¢

å…³é”®é…ç½®ï¼š
- `replicas`ï¼šå‰¯æœ¬æ•°ï¼ˆå»ºè®®è‡³å°‘2ä¸ªï¼Œå®ç°é«˜å¯ç”¨ï¼‰
- `image`ï¼šDockeré•œåƒåœ°å€
- `resources`ï¼šèµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ï¼‰
- `livenessProbe`ï¼šå­˜æ´»æ¢é’ˆï¼ˆæ£€æµ‹åº”ç”¨æ˜¯å¦å¥åº·ï¼‰
- `readinessProbe`ï¼šå°±ç»ªæ¢é’ˆï¼ˆæ£€æµ‹åº”ç”¨æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ï¼‰

**3. Serviceï¼ˆæœåŠ¡ï¼‰**

ä½œç”¨ï¼š
- æœåŠ¡å‘ç°ï¼šä¸ºPodæä¾›ç¨³å®šçš„è®¿é—®åœ°å€ï¼ˆPodçš„IPä¼šå˜åŒ–ï¼‰
- è´Ÿè½½å‡è¡¡ï¼šè‡ªåŠ¨å°†æµé‡åˆ†å‘åˆ°å¤šä¸ªPod
- ç«¯å£æ˜ å°„ï¼šå°†Serviceç«¯å£æ˜ å°„åˆ°Podç«¯å£

Serviceç±»å‹ï¼š
- `ClusterIP`ï¼šé›†ç¾¤å†…éƒ¨è®¿é—®ï¼ˆé»˜è®¤ï¼Œæœ€å¸¸ç”¨ï¼‰
- `NodePort`ï¼šé€šè¿‡èŠ‚ç‚¹IP+ç«¯å£è®¿é—®ï¼ˆä¸æ¨èï¼‰
- `LoadBalancer`ï¼šé€šè¿‡äº‘å‚å•†çš„è´Ÿè½½å‡è¡¡å™¨è®¿é—®ï¼ˆæˆæœ¬é«˜ï¼‰

**4. Ingressï¼ˆå…¥å£ï¼‰**

ä½œç”¨ï¼š
- ä¸ƒå±‚è·¯ç”±ï¼šåŸºäºåŸŸåå’Œè·¯å¾„è·¯ç”±åˆ°ä¸åŒçš„Service
- SSLç»ˆæ­¢ï¼šåœ¨Ingresså±‚å¤„ç†HTTPSï¼Œåç«¯ä½¿ç”¨HTTP
- ç»Ÿä¸€å…¥å£ï¼šä¸€ä¸ªIngresså¯ä»¥ç®¡ç†å¤šä¸ªåŸŸåå’ŒæœåŠ¡

å…³é”®é…ç½®ï¼š
- `host`ï¼šåŸŸå
- `path`ï¼šè·¯å¾„è§„åˆ™
- `backend`ï¼šåç«¯Service
- `tls`ï¼šSSLè¯ä¹¦é…ç½®

**5. ConfigMapå’ŒSecret**

ä½œç”¨ï¼š
- `ConfigMap`ï¼šå­˜å‚¨é…ç½®æ–‡ä»¶ï¼ˆæ˜æ–‡ï¼‰
- `Secret`ï¼šå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆBase64ç¼–ç ï¼‰

ä½¿ç”¨åœºæ™¯ï¼š
- æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- APIå¯†é’¥
- é…ç½®æ–‡ä»¶

### âœ… éªŒè¯ç‚¹
- ç†è§£Namespaceçš„ä½œç”¨
- ç†è§£Deploymentç®¡ç†Podçš„æ–¹å¼
- ç†è§£Serviceæä¾›ç¨³å®šè®¿é—®çš„åŸç†
- ç†è§£Ingressçš„è·¯ç”±åŠŸèƒ½

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šä¸ºä»€ä¹ˆéœ€è¦Serviceï¼Ÿç›´æ¥è®¿é—®Podä¸è¡Œå—ï¼Ÿ**
- ç­”ï¼šPodçš„IPä¼šå˜åŒ–
- Podé‡å¯åï¼ŒIPä¼šæ”¹å˜
- Serviceæä¾›ç¨³å®šçš„ClusterIP
- Serviceè‡ªåŠ¨æ›´æ–°åç«¯Podåˆ—è¡¨

**é—®é¢˜2ï¼šDeploymentå’ŒPodæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
- ç­”ï¼šDeploymentæ˜¯ç®¡ç†è€…ï¼ŒPodæ˜¯è¢«ç®¡ç†è€…
- ä¸è¦ç›´æ¥åˆ›å»ºPodï¼Œåº”è¯¥é€šè¿‡Deploymentåˆ›å»º
- Deploymentå¯ä»¥è‡ªåŠ¨æ¢å¤æ•…éšœçš„Pod
- Deploymentæ”¯æŒæ»šåŠ¨æ›´æ–°å’Œå›æ»š

**é—®é¢˜3ï¼šä¸ºä»€ä¹ˆè¦é…ç½®èµ„æºé™åˆ¶ï¼Ÿ**
- ç­”ï¼šé˜²æ­¢èµ„æºè€—å°½
- ä¸€ä¸ªPodå ç”¨è¿‡å¤šèµ„æºï¼Œä¼šå½±å“å…¶ä»–Pod
- èµ„æºé™åˆ¶å¯ä»¥ä¿è¯é›†ç¾¤ç¨³å®šæ€§
- Kubernetesæ ¹æ®èµ„æºé™åˆ¶è¿›è¡Œè°ƒåº¦

**é—®é¢˜4ï¼šå¥åº·æ£€æŸ¥æœ‰ä»€ä¹ˆç”¨ï¼Ÿ**
- ç­”ï¼šè‡ªåŠ¨æ£€æµ‹åº”ç”¨çŠ¶æ€
- livenessProbeï¼šåº”ç”¨ä¸å¥åº·æ—¶ï¼Œè‡ªåŠ¨é‡å¯Pod
- readinessProbeï¼šåº”ç”¨æœªå°±ç»ªæ—¶ï¼Œä¸è½¬å‘æµé‡
- æé«˜åº”ç”¨çš„å¯ç”¨æ€§

### ğŸ’¡ å°è´´å£«
- ğŸ¯ å»ºè®®å…ˆç†è§£èµ„æºå…³ç³»ï¼Œå†å¼€å§‹é…ç½®
- ğŸ“š Kuberneteså®˜æ–¹æ–‡æ¡£æ˜¯æœ€å¥½çš„å­¦ä¹ èµ„æº
- ğŸ” ä½¿ç”¨ `kubectl explain` å‘½ä»¤æŸ¥çœ‹èµ„æºå­—æ®µè¯´æ˜

---

## æ­¥éª¤6.2ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„

### ğŸ¬ æ“ä½œè¯´æ˜
ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„Kubernetesé…ç½®æ–‡ä»¶ã€‚è‰¯å¥½çš„ç›®å½•ç»“æ„å¯ä»¥è®©é…ç½®æ–‡ä»¶æ›´æ˜“äºç®¡ç†ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•**
- åœ¨æœ¬åœ°ç”µè„‘ä¸Šï¼Œåˆ›å»ºé¡¹ç›®ç›®å½•ï¼š
  ```bash
  mkdir -p ~/my-app-k8s
  cd ~/my-app-k8s
  ```

**ç¬¬2æ­¥ï¼šåˆ›å»ºå­ç›®å½•**
- åˆ›å»ºä¸åŒç±»å‹èµ„æºçš„å­ç›®å½•ï¼š
  ```bash
  mkdir -p base
  mkdir -p overlays/dev
  mkdir -p overlays/prod
  ```
- ç›®å½•è¯´æ˜ï¼š
  - `base/`ï¼šåŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±ç”¨ï¼‰
  - `overlays/dev/`ï¼šå¼€å‘ç¯å¢ƒç‰¹å®šé…ç½®
  - `overlays/prod/`ï¼šç”Ÿäº§ç¯å¢ƒç‰¹å®šé…ç½®

**ç¬¬3æ­¥ï¼šæŸ¥çœ‹ç›®å½•ç»“æ„**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  tree .
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  .
  â”œâ”€â”€ base
  â””â”€â”€ overlays
      â”œâ”€â”€ dev
      â””â”€â”€ prod
  ```

### âœ… éªŒè¯ç‚¹
- é¡¹ç›®ç›®å½•å·²åˆ›å»º
- å­ç›®å½•ç»“æ„æ¸…æ™°

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šä¸ºä»€ä¹ˆè¦åˆ†baseå’Œoverlaysï¼Ÿ**
- ç­”ï¼šè¿™æ˜¯Kustomizeçš„ç›®å½•ç»“æ„
- baseå­˜æ”¾é€šç”¨é…ç½®
- overlayså­˜æ”¾ç¯å¢ƒç‰¹å®šé…ç½®
- å¯ä»¥é¿å…é…ç½®é‡å¤

**é—®é¢˜2ï¼šä¸ä½¿ç”¨Kustomizeå¯ä»¥å—ï¼Ÿ**
- ç­”ï¼šå¯ä»¥
- å¯ä»¥ç›´æ¥åœ¨baseç›®å½•åˆ›å»ºæ‰€æœ‰é…ç½®æ–‡ä»¶
- ä½†ä½¿ç”¨Kustomizeå¯ä»¥æ›´å¥½åœ°ç®¡ç†å¤šç¯å¢ƒé…ç½®

### ğŸ’¡ å°è´´å£«
- ğŸ“ è‰¯å¥½çš„ç›®å½•ç»“æ„æ˜¯é¡¹ç›®ç®¡ç†çš„åŸºç¡€
- ğŸ”„ åç»­å¯ä»¥ä½¿ç”¨Gitç®¡ç†è¿™äº›é…ç½®æ–‡ä»¶

---

## æ­¥éª¤6.3ï¼šåˆ›å»ºNamespaceé…ç½®

### ğŸ¬ æ“ä½œè¯´æ˜
é¦–å…ˆåˆ›å»ºNamespaceé…ç½®æ–‡ä»¶ã€‚Namespaceç”¨äºéš”ç¦»ä¸åŒçš„åº”ç”¨æˆ–ç¯å¢ƒï¼Œæ˜¯Kubernetesèµ„æºç®¡ç†çš„åŸºç¡€ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šåˆ›å»ºnamespace.yamlæ–‡ä»¶**
- åœ¨baseç›®å½•åˆ›å»ºæ–‡ä»¶ï¼š
  ```bash
  cat > base/namespace.yaml << 'EOF'
  apiVersion: v1
  kind: Namespace
  metadata:
    name: my-app
    labels:
      name: my-app
      env: production
  EOF
  ```

**ç¬¬2æ­¥ï¼šç†è§£é…ç½®å†…å®¹**

```yaml
apiVersion: v1              # APIç‰ˆæœ¬
kind: Namespace             # èµ„æºç±»å‹
metadata:                   # å…ƒæ•°æ®
  name: my-app              # Namespaceåç§°ï¼ˆå¿…é¡»å”¯ä¸€ï¼‰
  labels:                   # æ ‡ç­¾ï¼ˆç”¨äºç­›é€‰å’Œç®¡ç†ï¼‰
    name: my-app            # åº”ç”¨åç§°æ ‡ç­¾
    env: production         # ç¯å¢ƒæ ‡ç­¾
```

**ç¬¬3æ­¥ï¼šéªŒè¯YAMLè¯­æ³•**
- è¿è¡Œå‘½ä»¤æ£€æŸ¥è¯­æ³•ï¼š
  ```bash
  kubectl apply --dry-run=client -f base/namespace.yaml
  ```
- å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¯´æ˜è¯­æ³•æ­£ç¡®

### âœ… éªŒè¯ç‚¹
- namespace.yamlæ–‡ä»¶å·²åˆ›å»º
- YAMLè¯­æ³•æ­£ç¡®
- æ–‡ä»¶å†…å®¹ç¬¦åˆé¢„æœŸ

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šNamespaceåç§°æœ‰ä»€ä¹ˆé™åˆ¶ï¼Ÿ**
- ç­”ï¼šå¿…é¡»ç¬¦åˆDNSè§„èŒƒ
- åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦
- ä¸èƒ½ä»¥è¿å­—ç¬¦å¼€å¤´æˆ–ç»“å°¾
- é•¿åº¦ä¸è¶…è¿‡63ä¸ªå­—ç¬¦

**é—®é¢˜2ï¼šå¯ä»¥ä¸åˆ›å»ºNamespaceå—ï¼Ÿ**
- ç­”ï¼šå¯ä»¥ä½¿ç”¨defaultå‘½åç©ºé—´
- ä½†ä¸æ¨èï¼Œç”Ÿäº§ç¯å¢ƒåº”è¯¥åˆ›å»ºç‹¬ç«‹çš„Namespace
- ä¾¿äºèµ„æºéš”ç¦»å’Œæƒé™ç®¡ç†

**é—®é¢˜3ï¼šæ ‡ç­¾æœ‰ä»€ä¹ˆç”¨ï¼Ÿ**
- ç­”ï¼šç”¨äºç­›é€‰å’Œç®¡ç†èµ„æº
- å¯ä»¥é€šè¿‡æ ‡ç­¾æŸ¥è¯¢èµ„æº
- å¯ä»¥åŸºäºæ ‡ç­¾è®¾ç½®æƒé™
- å¯ä»¥åŸºäºæ ‡ç­¾ç»Ÿè®¡æˆæœ¬

### ğŸ’¡ å°è´´å£«
- ğŸ·ï¸ å»ºè®®ä¸ºæ‰€æœ‰èµ„æºæ·»åŠ ç»Ÿä¸€çš„æ ‡ç­¾
- ğŸ“ æ ‡ç­¾å‘½åè¦æœ‰æ„ä¹‰ï¼Œä¾¿äºç†è§£

---

## æ­¥éª¤6.4ï¼šåˆ›å»ºDeploymenté…ç½®

### ğŸ¬ æ“ä½œè¯´æ˜
ç°åœ¨åˆ›å»ºDeploymenté…ç½®æ–‡ä»¶ã€‚è¿™æ˜¯æœ€æ ¸å¿ƒçš„é…ç½®ï¼Œå®šä¹‰äº†åº”ç”¨å¦‚ä½•è¿è¡Œï¼ŒåŒ…æ‹¬é•œåƒã€å‰¯æœ¬æ•°ã€èµ„æºé™åˆ¶ã€å¥åº·æ£€æŸ¥ç­‰ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šåˆ›å»ºdeployment.yamlæ–‡ä»¶**
- åœ¨baseç›®å½•åˆ›å»ºæ–‡ä»¶ï¼š
  ```bash
  cat > base/deployment.yaml << 'EOF'
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: my-app
    namespace: my-app
    labels:
      app: my-app
  spec:
    # å‰¯æœ¬æ•°ï¼š2ä¸ªPodå®ç°é«˜å¯ç”¨
    replicas: 2

    # é€‰æ‹©å™¨ï¼šåŒ¹é…å“ªäº›Podå±äºè¿™ä¸ªDeployment
    selector:
      matchLabels:
        app: my-app

    # Podæ¨¡æ¿
    template:
      metadata:
        labels:
          app: my-app
          version: v1.0.0
      spec:
        # å®¹å™¨åˆ—è¡¨
        containers:
        - name: my-app
          # é•œåƒåœ°å€ï¼ˆæ›¿æ¢ä¸ºä½ çš„é•œåƒï¼‰
          image: registry.cn-hangzhou.aliyuncs.com/my-namespace/my-app:v1.0.0

          # é•œåƒæ‹‰å–ç­–ç•¥
          imagePullPolicy: Always

          # å®¹å™¨ç«¯å£
          ports:
          - name: http
            containerPort: 8080
            protocol: TCP

          # ç¯å¢ƒå˜é‡
          env:
          - name: PORT
            value: "8080"
          - name: ENV
            value: "production"

          # èµ„æºé™åˆ¶
          resources:
            # è¯·æ±‚èµ„æºï¼ˆè°ƒåº¦æ—¶ä¿è¯çš„èµ„æºï¼‰
            requests:
              cpu: 100m        # 0.1æ ¸CPU
              memory: 128Mi    # 128MBå†…å­˜
            # é™åˆ¶èµ„æºï¼ˆæœ€å¤§å¯ä½¿ç”¨çš„èµ„æºï¼‰
            limits:
              cpu: 500m        # 0.5æ ¸CPU
              memory: 512Mi    # 512MBå†…å­˜

          # å­˜æ´»æ¢é’ˆï¼ˆæ£€æµ‹åº”ç”¨æ˜¯å¦å¥åº·ï¼‰
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 30  # å¯åŠ¨å30ç§’å¼€å§‹æ£€æµ‹
            periodSeconds: 10        # æ¯10ç§’æ£€æµ‹ä¸€æ¬¡
            timeoutSeconds: 5        # è¶…æ—¶æ—¶é—´5ç§’
            failureThreshold: 3      # è¿ç»­å¤±è´¥3æ¬¡è®¤ä¸ºä¸å¥åº·

          # å°±ç»ªæ¢é’ˆï¼ˆæ£€æµ‹åº”ç”¨æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ï¼‰
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10  # å¯åŠ¨å10ç§’å¼€å§‹æ£€æµ‹
            periodSeconds: 5         # æ¯5ç§’æ£€æµ‹ä¸€æ¬¡
            timeoutSeconds: 3        # è¶…æ—¶æ—¶é—´3ç§’
            failureThreshold: 3      # è¿ç»­å¤±è´¥3æ¬¡è®¤ä¸ºæœªå°±ç»ª

        # é•œåƒæ‹‰å–å¯†é’¥
        imagePullSecrets:
        - name: acr-secret
  EOF
  ```

**ç¬¬2æ­¥ï¼šç†è§£å…³é”®é…ç½®**

**å‰¯æœ¬æ•°é…ç½®**ï¼š
```yaml
replicas: 2
```
- 2ä¸ªå‰¯æœ¬å¯ä»¥å®ç°åŸºæœ¬çš„é«˜å¯ç”¨
- ä¸€ä¸ªPodæ•…éšœæ—¶ï¼Œå¦ä¸€ä¸ªPodç»§ç»­æœåŠ¡
- ç”Ÿäº§ç¯å¢ƒå»ºè®®è‡³å°‘2ä¸ªå‰¯æœ¬

**èµ„æºé™åˆ¶é…ç½®**ï¼š
```yaml
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi
```
- `requests`ï¼šè°ƒåº¦æ—¶ä¿è¯çš„èµ„æºï¼ŒKubernetesä¼šæ‰¾æœ‰è¶³å¤Ÿèµ„æºçš„èŠ‚ç‚¹
- `limits`ï¼šæœ€å¤§å¯ä½¿ç”¨çš„èµ„æºï¼Œè¶…è¿‡ä¼šè¢«é™åˆ¶æˆ–æ€æ­»
- CPUå•ä½ï¼š`m`è¡¨ç¤ºæ¯«æ ¸ï¼Œ1000m = 1æ ¸
- å†…å­˜å•ä½ï¼š`Mi`è¡¨ç¤ºMiBï¼Œ`Gi`è¡¨ç¤ºGiB

**å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```yaml
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
```
- `livenessProbe`ï¼šå­˜æ´»æ¢é’ˆï¼Œå¤±è´¥ä¼šé‡å¯Pod
- `readinessProbe`ï¼šå°±ç»ªæ¢é’ˆï¼Œå¤±è´¥ä¼šä»Serviceç§»é™¤
- `initialDelaySeconds`ï¼šå¯åŠ¨åå¤šä¹…å¼€å§‹æ£€æµ‹ï¼ˆç»™åº”ç”¨å¯åŠ¨æ—¶é—´ï¼‰
- `periodSeconds`ï¼šæ£€æµ‹é—´éš”

**ç¬¬3æ­¥ï¼šä¿®æ”¹é•œåƒåœ°å€**
- å°†é•œåƒåœ°å€æ›¿æ¢ä¸ºä½ çš„é•œåƒï¼š
  ```bash
  # ä½¿ç”¨sedå‘½ä»¤æ›¿æ¢
  sed -i '' 's|registry.cn-hangzhou.aliyuncs.com/my-namespace/my-app:v1.0.0|ä½ çš„é•œåƒåœ°å€|g' base/deployment.yaml
  ```
- æˆ–è€…æ‰‹åŠ¨ç¼–è¾‘æ–‡ä»¶

**ç¬¬4æ­¥ï¼šéªŒè¯YAMLè¯­æ³•**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl apply --dry-run=client -f base/deployment.yaml
  ```

### âœ… éªŒè¯ç‚¹
- deployment.yamlæ–‡ä»¶å·²åˆ›å»º
- é•œåƒåœ°å€å·²ä¿®æ”¹ä¸ºä½ çš„é•œåƒ
- YAMLè¯­æ³•æ­£ç¡®
- ç†è§£æ¯ä¸ªé…ç½®é¡¹çš„ä½œç”¨

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šrequestså’Œlimitsæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
- ç­”ï¼šrequestsæ˜¯ä¿è¯ï¼Œlimitsæ˜¯é™åˆ¶
- requestsï¼šè°ƒåº¦æ—¶ä½¿ç”¨ï¼Œä¿è¯Podèƒ½åˆ†é…åˆ°è¿™ä¹ˆå¤šèµ„æº
- limitsï¼šè¿è¡Œæ—¶ä½¿ç”¨ï¼Œè¶…è¿‡ä¼šè¢«é™åˆ¶
- å»ºè®®ï¼šrequestsè®¾ç½®ä¸ºæ­£å¸¸ä½¿ç”¨é‡ï¼Œlimitsè®¾ç½®ä¸ºå³°å€¼

**é—®é¢˜2ï¼šå¦‚ä½•ç¡®å®šèµ„æºé™åˆ¶çš„å€¼ï¼Ÿ**
- ç­”ï¼šå…ˆè®¾ç½®ä¸€ä¸ªåˆç†çš„å€¼ï¼Œç„¶åè§‚å¯Ÿ
- å¯ä»¥å…ˆè®¾ç½®è¾ƒå¤§çš„å€¼ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åæŸ¥çœ‹å®é™…ä½¿ç”¨é‡
- ä½¿ç”¨ `kubectl top pod` æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
- æ ¹æ®å®é™…ä½¿ç”¨é‡è°ƒæ•´

**é—®é¢˜3ï¼šlivenessProbeå’ŒreadinessProbeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
- ç­”ï¼šä½œç”¨ä¸åŒ
- livenessProbeï¼šæ£€æµ‹åº”ç”¨æ˜¯å¦å¥åº·ï¼Œå¤±è´¥ä¼šé‡å¯Pod
- readinessProbeï¼šæ£€æµ‹åº”ç”¨æ˜¯å¦å°±ç»ªï¼Œå¤±è´¥ä¼šä»Serviceç§»é™¤
- é€šå¸¸ä¸¤è€…é…ç½®ç›¸åŒï¼Œä½†initialDelaySecondsä¸åŒ

**é—®é¢˜4ï¼šä¸ºä»€ä¹ˆè¦è®¾ç½®imagePullPolicyä¸ºAlwaysï¼Ÿ**
- ç­”ï¼šç¡®ä¿ä½¿ç”¨æœ€æ–°çš„é•œåƒ
- å¦‚æœä½¿ç”¨latestæ ‡ç­¾ï¼Œå»ºè®®è®¾ç½®ä¸ºAlways
- å¦‚æœä½¿ç”¨æ˜ç¡®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è®¾ç½®ä¸ºIfNotPresent

**é—®é¢˜5ï¼šå¥åº·æ£€æŸ¥å¤±è´¥ä¼šæ€æ ·ï¼Ÿ**
- ç­”ï¼šå–å†³äºæ¢é’ˆç±»å‹
- livenessProbeå¤±è´¥ï¼šPodä¼šè¢«é‡å¯
- readinessProbeå¤±è´¥ï¼šPodä¼šä»Serviceç§»é™¤ï¼Œä¸æ¥æ”¶æµé‡
- è¿ç»­å¤±è´¥failureThresholdæ¬¡æ‰ä¼šè§¦å‘

### ğŸ’¡ å°è´´å£«
- ğŸ¯ èµ„æºé™åˆ¶å¾ˆé‡è¦ï¼Œé˜²æ­¢å•ä¸ªPodè€—å°½èŠ‚ç‚¹èµ„æº
- ğŸ¥ å¥åº·æ£€æŸ¥æ˜¯é«˜å¯ç”¨çš„å…³é”®ï¼ŒåŠ¡å¿…é…ç½®
- ğŸ“Š å»ºè®®å…ˆè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´èµ„æºé™åˆ¶
- ğŸ”„ ä½¿ç”¨æ˜ç¡®çš„ç‰ˆæœ¬å·ï¼Œä¸è¦ä½¿ç”¨latestæ ‡ç­¾

---

## æ­¥éª¤6.5ï¼šåˆ›å»ºServiceé…ç½®

### ğŸ¬ æ“ä½œè¯´æ˜
ç°åœ¨åˆ›å»ºServiceé…ç½®æ–‡ä»¶ã€‚Serviceä¸ºPodæä¾›ç¨³å®šçš„è®¿é—®åœ°å€å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œæ˜¯åº”ç”¨å¯¹å¤–æä¾›æœåŠ¡çš„åŸºç¡€ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šåˆ›å»ºservice.yamlæ–‡ä»¶**
- åœ¨baseç›®å½•åˆ›å»ºæ–‡ä»¶ï¼š
  ```bash
  cat > base/service.yaml << 'EOF'
  apiVersion: v1
  kind: Service
  metadata:
    name: my-app
    namespace: my-app
    labels:
      app: my-app
  spec:
    # Serviceç±»å‹ï¼šClusterIPï¼ˆé›†ç¾¤å†…éƒ¨è®¿é—®ï¼‰
    type: ClusterIP

    # é€‰æ‹©å™¨ï¼šåŒ¹é…å“ªäº›Pod
    selector:
      app: my-app

    # ç«¯å£é…ç½®
    ports:
    - name: http
      protocol: TCP
      port: 80          # Serviceç«¯å£
      targetPort: 8080  # Podç«¯å£
  EOF
  ```

**ç¬¬2æ­¥ï¼šç†è§£é…ç½®å†…å®¹**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-app          # Serviceåç§°
  namespace: my-app     # æ‰€å±å‘½åç©ºé—´
spec:
  type: ClusterIP       # Serviceç±»å‹
  selector:             # é€‰æ‹©å™¨ï¼ˆåŒ¹é…Podçš„æ ‡ç­¾ï¼‰
    app: my-app
  ports:
  - port: 80            # Serviceç«¯å£ï¼ˆå…¶ä»–æœåŠ¡è®¿é—®è¿™ä¸ªç«¯å£ï¼‰
    targetPort: 8080    # Podç«¯å£ï¼ˆæµé‡è½¬å‘åˆ°Podçš„è¿™ä¸ªç«¯å£ï¼‰
```

**Serviceå·¥ä½œåŸç†**ï¼š
1. Serviceåˆ›å»ºåï¼Œä¼šåˆ†é…ä¸€ä¸ªClusterIPï¼ˆå¦‚ï¼š10.96.1.100ï¼‰
2. å…¶ä»–Podå¯ä»¥é€šè¿‡ClusterIPæˆ–Serviceåç§°è®¿é—®
3. Serviceä¼šè‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°æ‰€æœ‰åŒ¹é…selectorçš„Pod
4. Podå¢åŠ æˆ–å‡å°‘æ—¶ï¼ŒServiceè‡ªåŠ¨æ›´æ–°åç«¯åˆ—è¡¨

**ç¬¬3æ­¥ï¼šéªŒè¯YAMLè¯­æ³•**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl apply --dry-run=client -f base/service.yaml
  ```

### âœ… éªŒè¯ç‚¹
- service.yamlæ–‡ä»¶å·²åˆ›å»º
- selectoræ ‡ç­¾å’ŒDeploymentçš„Podæ ‡ç­¾ä¸€è‡´
- ç«¯å£æ˜ å°„é…ç½®æ­£ç¡®

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šä¸ºä»€ä¹ˆé€‰æ‹©ClusterIPç±»å‹ï¼Ÿ**
- ç­”ï¼šClusterIPæ˜¯æœ€å¸¸ç”¨çš„ç±»å‹
- åªåœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œå®‰å…¨æ€§é«˜
- å¤–éƒ¨è®¿é—®é€šè¿‡Ingressï¼Œæ›´çµæ´»
- NodePortå’ŒLoadBalancerç±»å‹æˆæœ¬é«˜æˆ–ä¸å®‰å…¨

**é—®é¢˜2ï¼šselectorå¦‚ä½•åŒ¹é…Podï¼Ÿ**
- ç­”ï¼šé€šè¿‡æ ‡ç­¾åŒ¹é…
- Serviceçš„selectorå¿…é¡»å’ŒDeploymentçš„Podæ ‡ç­¾ä¸€è‡´
- æœ¬ä¾‹ä¸­éƒ½æ˜¯ `app: my-app`
- å¦‚æœæ ‡ç­¾ä¸åŒ¹é…ï¼ŒServiceæ— æ³•æ‰¾åˆ°Pod

**é—®é¢˜3ï¼športå’ŒtargetPortæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
- ç­”ï¼športæ˜¯Serviceç«¯å£ï¼ŒtargetPortæ˜¯Podç«¯å£
- å…¶ä»–æœåŠ¡è®¿é—®Serviceçš„port
- Serviceå°†æµé‡è½¬å‘åˆ°Podçš„targetPort
- å¯ä»¥ä¸åŒï¼Œæ¯”å¦‚Serviceç”¨80ï¼ŒPodç”¨8080

**é—®é¢˜4ï¼šå¦‚ä½•æµ‹è¯•Serviceæ˜¯å¦å·¥ä½œï¼Ÿ**
- ç­”ï¼šåœ¨é›†ç¾¤å†…éƒ¨æµ‹è¯•
- åˆ›å»ºä¸€ä¸ªä¸´æ—¶Podï¼š
  ```bash
  kubectl run test --image=busybox -it --rm -- sh
  ```
- åœ¨Podå†…è®¿é—®Serviceï¼š
  ```bash
  wget -O- http://my-app.my-app.svc.cluster.local
  ```

### ğŸ’¡ å°è´´å£«
- ğŸ¯ Serviceåç§°ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°DNS
- ğŸ” å®Œæ•´åŸŸåæ ¼å¼ï¼š`<service-name>.<namespace>.svc.cluster.local`
- ğŸ“ åŒä¸€å‘½åç©ºé—´å†…å¯ä»¥ç›´æ¥ä½¿ç”¨Serviceåç§°è®¿é—®

---

## æ­¥éª¤6.6ï¼šåˆ›å»ºIngressé…ç½®

### ğŸ¬ æ“ä½œè¯´æ˜
ç°åœ¨åˆ›å»ºIngressé…ç½®æ–‡ä»¶ã€‚Ingressæ˜¯åº”ç”¨å¯¹å¤–æä¾›æœåŠ¡çš„å…¥å£ï¼Œé…ç½®åŸŸåã€SSLè¯ä¹¦å’Œè·¯ç”±è§„åˆ™ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šåˆ›å»ºingress.yamlæ–‡ä»¶**
- åœ¨baseç›®å½•åˆ›å»ºæ–‡ä»¶ï¼š
  ```bash
  cat > base/ingress.yaml << 'EOF'
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: my-app
    namespace: my-app
    annotations:
      # ä½¿ç”¨ALB Ingress Controller
      kubernetes.io/ingress.class: alb

      # è‡ªåŠ¨ç­¾å‘SSLè¯ä¹¦
      cert-manager.io/cluster-issuer: letsencrypt-prod

      # ç›‘å¬ç«¯å£ï¼šHTTP 80 å’Œ HTTPS 443
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'

      # HTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
      alb.ingress.kubernetes.io/ssl-redirect: "true"

      # å¥åº·æ£€æŸ¥é…ç½®
      alb.ingress.kubernetes.io/healthcheck-enabled: "true"
      alb.ingress.kubernetes.io/healthcheck-path: "/health"
      alb.ingress.kubernetes.io/healthcheck-protocol: "HTTP"
      alb.ingress.kubernetes.io/healthcheck-interval-seconds: "10"
      alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
      alb.ingress.kubernetes.io/healthy-threshold-count: "2"
      alb.ingress.kubernetes.io/unhealthy-threshold-count: "3"
  spec:
    # TLSé…ç½®
    tls:
    - hosts:
      - www.example.com  # æ›¿æ¢ä¸ºä½ çš„åŸŸå
      secretName: my-app-tls

    # è·¯ç”±è§„åˆ™
    rules:
    - host: www.example.com  # æ›¿æ¢ä¸ºä½ çš„åŸŸå
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: my-app
              port:
                number: 80
  EOF
  ```

**ç¬¬2æ­¥ï¼šä¿®æ”¹åŸŸå**
- å°†åŸŸåæ›¿æ¢ä¸ºä½ çš„åŸŸåï¼š
  ```bash
  sed -i '' 's/www.example.com/ä½ çš„åŸŸå/g' base/ingress.yaml
  ```

**ç¬¬3æ­¥ï¼šç†è§£å…³é”®é…ç½®**

**Ingressæ³¨è§£ï¼ˆAnnotationsï¼‰**ï¼š
```yaml
annotations:
  kubernetes.io/ingress.class: alb
  cert-manager.io/cluster-issuer: letsencrypt-prod
  alb.ingress.kubernetes.io/ssl-redirect: "true"
```
- `ingress.class`ï¼šæŒ‡å®šä½¿ç”¨ALB Ingress Controller
- `cluster-issuer`ï¼šè‡ªåŠ¨ç­¾å‘SSLè¯ä¹¦
- `ssl-redirect`ï¼šHTTPè‡ªåŠ¨è·³è½¬åˆ°HTTPS

**TLSé…ç½®**ï¼š
```yaml
tls:
- hosts:
  - www.example.com
  secretName: my-app-tls
```
- `hosts`ï¼šéœ€è¦SSLè¯ä¹¦çš„åŸŸå
- `secretName`ï¼šè¯ä¹¦å­˜å‚¨çš„Secretåç§°ï¼ˆcert-managerè‡ªåŠ¨åˆ›å»ºï¼‰

**è·¯ç”±è§„åˆ™**ï¼š
```yaml
rules:
- host: www.example.com
  http:
    paths:
    - path: /
      pathType: Prefix
      backend:
        service:
          name: my-app
          port:
            number: 80
```
- `host`ï¼šåŸŸå
- `path`ï¼šè·¯å¾„ï¼ˆ/è¡¨ç¤ºæ‰€æœ‰è·¯å¾„ï¼‰
- `pathType`ï¼šè·¯å¾„åŒ¹é…ç±»å‹ï¼ˆPrefixè¡¨ç¤ºå‰ç¼€åŒ¹é…ï¼‰
- `backend`ï¼šåç«¯Service

**ç¬¬4æ­¥ï¼šéªŒè¯YAMLè¯­æ³•**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl apply --dry-run=client -f base/ingress.yaml
  ```

### âœ… éªŒè¯ç‚¹
- ingress.yamlæ–‡ä»¶å·²åˆ›å»º
- åŸŸåå·²ä¿®æ”¹ä¸ºä½ çš„åŸŸå
- YAMLè¯­æ³•æ­£ç¡®

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼špathTypeæœ‰å“ªäº›é€‰é¡¹ï¼Ÿ**
- ç­”ï¼šä¸‰ç§ç±»å‹
- `Prefix`ï¼šå‰ç¼€åŒ¹é…ï¼ˆæœ€å¸¸ç”¨ï¼‰
- `Exact`ï¼šç²¾ç¡®åŒ¹é…
- `ImplementationSpecific`ï¼šç”±Ingress Controllerå†³å®š

**é—®é¢˜2ï¼šå¦‚ä½•é…ç½®å¤šä¸ªåŸŸåï¼Ÿ**
- ç­”ï¼šåœ¨rulesä¸­æ·»åŠ å¤šä¸ªhost
  ```yaml
  rules:
  - host: www.example.com
    http:
      paths:
      - path: /
        backend:
          service:
            name: web-service
  - host: api.example.com
    http:
      paths:
      - path: /
        backend:
          service:
            name: api-service
  ```

**é—®é¢˜3ï¼šå¦‚ä½•é…ç½®è·¯å¾„è·¯ç”±ï¼Ÿ**
- ç­”ï¼šåœ¨pathsä¸­æ·»åŠ å¤šä¸ªè·¯å¾„
  ```yaml
  paths:
  - path: /api
    backend:
      service:
        name: api-service
  - path: /web
    backend:
      service:
        name: web-service
  ```

**é—®é¢˜4ï¼šSSLè¯ä¹¦å¤šä¹…ç­¾å‘ï¼Ÿ**
- ç­”ï¼šé€šå¸¸2-3åˆ†é’Ÿ
- cert-managerä¼šè‡ªåŠ¨å‘Let's Encryptç”³è¯·è¯ä¹¦
- å¯ä»¥æŸ¥çœ‹Certificateèµ„æºçš„çŠ¶æ€
- è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸï¼Œä¸ç”¨æ‹…å¿ƒè¿‡æœŸ

### ğŸ’¡ å°è´´å£«
- ğŸ”’ SSLè¯ä¹¦å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
- ğŸŒ ä¸€ä¸ªIngresså¯ä»¥ç®¡ç†å¤šä¸ªåŸŸå
- ğŸ“ å¥åº·æ£€æŸ¥é…ç½®å¾ˆé‡è¦ï¼Œç¡®ä¿æµé‡åªè½¬å‘åˆ°å¥åº·çš„Pod

---

## æ­¥éª¤6.7ï¼šåº”ç”¨æ‰€æœ‰é…ç½®

### ğŸ¬ æ“ä½œè¯´æ˜
ç°åœ¨æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å°†å®ƒä»¬åº”ç”¨åˆ°Kubernetesé›†ç¾¤ã€‚è¿™ä¸€æ­¥ä¼šåˆ›å»ºæ‰€æœ‰èµ„æºï¼Œå¯åŠ¨åº”ç”¨ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šæŸ¥çœ‹æ‰€æœ‰é…ç½®æ–‡ä»¶**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  ls -lh base/
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  deployment.yaml
  ingress.yaml
  namespace.yaml
  service.yaml
  ```

**ç¬¬2æ­¥ï¼šåº”ç”¨Namespace**
- å…ˆåˆ›å»ºNamespaceï¼š
  ```bash
  kubectl apply -f base/namespace.yaml
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  namespace/my-app created
  ```

**ç¬¬3æ­¥ï¼šåˆ›å»ºé•œåƒæ‹‰å–å¯†é’¥**
- å¦‚æœè¿˜æ²¡æœ‰åˆ›å»ºï¼Œç°åœ¨åˆ›å»ºï¼š
  ```bash
  kubectl create secret docker-registry acr-secret \
    --docker-server=registry.cn-hangzhou.aliyuncs.com \
    --docker-username=your-username \
    --docker-password=your-password \
    --docker-email=your-email@example.com \
    -n my-app
  ```
- æ›¿æ¢ä¸ºä½ çš„ACRå‡­è¯

**ç¬¬4æ­¥ï¼šåº”ç”¨Deployment**
- åˆ›å»ºDeploymentï¼š
  ```bash
  kubectl apply -f base/deployment.yaml
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  deployment.apps/my-app created
  ```

**ç¬¬5æ­¥ï¼šåº”ç”¨Service**
- åˆ›å»ºServiceï¼š
  ```bash
  kubectl apply -f base/service.yaml
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  service/my-app created
  ```

**ç¬¬6æ­¥ï¼šåº”ç”¨Ingress**
- åˆ›å»ºIngressï¼š
  ```bash
  kubectl apply -f base/ingress.yaml
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  ingress.networking.k8s.io/my-app created
  ```

**ç¬¬7æ­¥ï¼šä¸€æ¬¡æ€§åº”ç”¨æ‰€æœ‰é…ç½®ï¼ˆå¯é€‰ï¼‰**
- ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§åº”ç”¨æ‰€æœ‰é…ç½®ï¼š
  ```bash
  kubectl apply -f base/
  ```
- è¿™ä¼šåº”ç”¨baseç›®å½•ä¸‹çš„æ‰€æœ‰YAMLæ–‡ä»¶

### âœ… éªŒè¯ç‚¹
- æ‰€æœ‰èµ„æºéƒ½å·²åˆ›å»º
- æ²¡æœ‰æŠ¥é”™ä¿¡æ¯

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šapplyå’Œcreateæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
- ç­”ï¼šapplyæ˜¯å£°æ˜å¼ï¼Œcreateæ˜¯å‘½ä»¤å¼
- applyï¼šå¦‚æœèµ„æºå­˜åœ¨å°±æ›´æ–°ï¼Œä¸å­˜åœ¨å°±åˆ›å»º
- createï¼šå¦‚æœèµ„æºå­˜åœ¨ä¼šæŠ¥é”™
- å»ºè®®ä½¿ç”¨apply

**é—®é¢˜2ï¼šå¯ä»¥ä¿®æ”¹é…ç½®åé‡æ–°applyå—ï¼Ÿ**
- ç­”ï¼šå¯ä»¥
- ä¿®æ”¹YAMLæ–‡ä»¶åï¼Œé‡æ–°è¿è¡Œkubectl apply
- Kubernetesä¼šè‡ªåŠ¨æ›´æ–°èµ„æº
- Deploymentä¼šæ»šåŠ¨æ›´æ–°Pod

**é—®é¢˜3ï¼šå¦‚ä½•æŸ¥çœ‹applyçš„è¯¦ç»†è¿‡ç¨‹ï¼Ÿ**
- ç­”ï¼šä½¿ç”¨--vå‚æ•°
  ```bash
  kubectl apply -f base/ --v=8
  ```
- æ•°å­—è¶Šå¤§ï¼Œè¾“å‡ºè¶Šè¯¦ç»†

### ğŸ’¡ å°è´´å£«
- ğŸ”„ å»ºè®®ä½¿ç”¨Gitç®¡ç†é…ç½®æ–‡ä»¶
- ğŸ“ æ¯æ¬¡ä¿®æ”¹åéƒ½è¦applyæ‰èƒ½ç”Ÿæ•ˆ
- ğŸ¯ å¯ä»¥ä½¿ç”¨kubectl diffæŸ¥çœ‹å˜æ›´

---

## æ­¥éª¤6.8ï¼šæŸ¥çœ‹PodçŠ¶æ€

### ğŸ¬ æ“ä½œè¯´æ˜
åº”ç”¨å·²ç»éƒ¨ç½²äº†ï¼Œç°åœ¨æˆ‘ä»¬æŸ¥çœ‹Podçš„çŠ¶æ€ï¼Œç¡®è®¤Podæ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚è¿™æ˜¯éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸçš„ç¬¬ä¸€æ­¥ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šæŸ¥çœ‹Podåˆ—è¡¨**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl get pods -n my-app
  ```
- åˆå§‹çŠ¶æ€å¯èƒ½æ˜¯ï¼š
  ```
  NAME                      READY   STATUS              RESTARTS   AGE
  my-app-7d9f8c6b5d-abc12   0/1     ContainerCreating   0          10s
  my-app-7d9f8c6b5d-def34   0/1     ContainerCreating   0          10s
  ```

**ç¬¬2æ­¥ï¼šç­‰å¾…Podå¯åŠ¨**
- ç­‰å¾…çº¦30-60ç§’ï¼Œå†æ¬¡æŸ¥çœ‹ï¼š
  ```bash
  kubectl get pods -n my-app
  ```
- æœ€ç»ˆåº”è¯¥çœ‹åˆ°ï¼š
  ```
  NAME                      READY   STATUS    RESTARTS   AGE
  my-app-7d9f8c6b5d-abc12   1/1     Running   0          1m
  my-app-7d9f8c6b5d-def34   1/1     Running   0          1m
  ```

**ç¬¬3æ­¥ï¼šæŒç»­ç›‘æ§PodçŠ¶æ€**
- ä½¿ç”¨watchå‘½ä»¤æŒç»­ç›‘æ§ï¼š
  ```bash
  kubectl get pods -n my-app -w
  ```
- æŒ‰Ctrl+Cåœæ­¢ç›‘æ§

**ç¬¬4æ­¥ï¼šæŸ¥çœ‹Podè¯¦æƒ…**
- é€‰æ‹©ä¸€ä¸ªPodï¼ŒæŸ¥çœ‹è¯¦æƒ…ï¼š
  ```bash
  kubectl describe pod <Podåç§°> -n my-app
  ```
- å¯ä»¥çœ‹åˆ°ï¼š
  - Podçš„äº‹ä»¶ï¼ˆEventsï¼‰
  - å®¹å™¨çŠ¶æ€
  - èµ„æºä½¿ç”¨æƒ…å†µ
  - å¥åº·æ£€æŸ¥ç»“æœ

**ç¬¬5æ­¥ï¼šæŸ¥çœ‹Podæ—¥å¿—**
- æŸ¥çœ‹Podçš„æ—¥å¿—ï¼š
  ```bash
  kubectl logs <Podåç§°> -n my-app
  ```
- åº”è¯¥çœ‹åˆ°åº”ç”¨çš„å¯åŠ¨æ—¥å¿—ï¼š
  ```
  2026/01/29 03:00:00 Server starting on port 8080
  ```

**ç¬¬6æ­¥ï¼šæŸ¥çœ‹æ‰€æœ‰Podçš„æ—¥å¿—**
- æŸ¥çœ‹æ‰€æœ‰Podçš„æ—¥å¿—ï¼š
  ```bash
  kubectl logs -l app=my-app -n my-app
  ```
- `-l app=my-app`ï¼šé€šè¿‡æ ‡ç­¾é€‰æ‹©Pod

**ç¬¬7æ­¥ï¼šå®æ—¶æŸ¥çœ‹æ—¥å¿—**
- å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆç±»ä¼¼tail -fï¼‰ï¼š
  ```bash
  kubectl logs -f <Podåç§°> -n my-app
  ```
- æŒ‰Ctrl+Cåœæ­¢

### âœ… éªŒè¯ç‚¹
- 2ä¸ªPodéƒ½åœ¨è¿è¡Œï¼ˆSTATUSä¸ºRunningï¼‰
- READYæ˜¾ç¤ºä¸º1/1
- RESTARTSä¸º0ï¼ˆæ²¡æœ‰é‡å¯ï¼‰
- æ—¥å¿—æ˜¾ç¤ºåº”ç”¨æ­£å¸¸å¯åŠ¨

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šPodä¸€ç›´æ˜¯ContainerCreatingçŠ¶æ€ï¼Ÿ**
- ç­”ï¼šå¯èƒ½æ˜¯é•œåƒæ‹‰å–æ…¢
- æŸ¥çœ‹Podè¯¦æƒ…ï¼š
  ```bash
  kubectl describe pod <Podåç§°> -n my-app
  ```
- åœ¨Eventséƒ¨åˆ†æŸ¥çœ‹è¿›åº¦
- å¦‚æœè¶…è¿‡5åˆ†é’Ÿï¼Œå¯èƒ½æ˜¯é•œåƒæ‹‰å–å¤±è´¥

**é—®é¢˜2ï¼šPodçŠ¶æ€æ˜¯ImagePullBackOffï¼Ÿ**
- ç­”ï¼šé•œåƒæ‹‰å–å¤±è´¥
- å¸¸è§åŸå› ï¼š
  - é•œåƒåœ°å€é”™è¯¯
  - é•œåƒæ‹‰å–å¯†é’¥é”™è¯¯
  - é•œåƒä¸å­˜åœ¨
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼š
  ```bash
  kubectl describe pod <Podåç§°> -n my-app | grep -A 10 Events
  ```

**é—®é¢˜3ï¼šPodçŠ¶æ€æ˜¯CrashLoopBackOffï¼Ÿ**
- ç­”ï¼šåº”ç”¨å¯åŠ¨å¤±è´¥
- æŸ¥çœ‹æ—¥å¿—ï¼š
  ```bash
  kubectl logs <Podåç§°> -n my-app
  ```
- å¸¸è§åŸå› ï¼š
  - åº”ç”¨ä»£ç é”™è¯¯
  - ç«¯å£é…ç½®é”™è¯¯
  - ç¯å¢ƒå˜é‡ç¼ºå¤±

**é—®é¢˜4ï¼šPodçŠ¶æ€æ˜¯Pendingï¼Ÿ**
- ç­”ï¼šæ— æ³•è°ƒåº¦
- æŸ¥çœ‹è¯¦æƒ…ï¼š
  ```bash
  kubectl describe pod <Podåç§°> -n my-app
  ```
- å¸¸è§åŸå› ï¼š
  - èµ„æºä¸è¶³ï¼ˆCPUæˆ–å†…å­˜ï¼‰
  - èŠ‚ç‚¹ä¸å¯ç”¨
  - é•œåƒæ‹‰å–å¯†é’¥ä¸å­˜åœ¨

**é—®é¢˜5ï¼šå¦‚ä½•æŸ¥çœ‹ä¹‹å‰çš„æ—¥å¿—ï¼Ÿ**
- ç­”ï¼šä½¿ç”¨--previouså‚æ•°
  ```bash
  kubectl logs <Podåç§°> -n my-app --previous
  ```
- æŸ¥çœ‹Podé‡å¯å‰çš„æ—¥å¿—

### ğŸ’¡ å°è´´å£«
- ğŸ” describeå‘½ä»¤æ˜¯æ’æŸ¥é—®é¢˜çš„åˆ©å™¨
- ğŸ“ æ—¥å¿—æ˜¯äº†è§£åº”ç”¨çŠ¶æ€çš„æœ€ä½³æ–¹å¼
- â° ç»™åº”ç”¨è¶³å¤Ÿçš„å¯åŠ¨æ—¶é—´ï¼ˆ30-60ç§’ï¼‰
- ğŸ¯ å¦‚æœPodä¸€ç›´ä¸æ­£å¸¸ï¼Œå‚è€ƒæ¨¡å—7çš„æ•…éšœæ’æŸ¥

---

## æ­¥éª¤6.9ï¼šæŸ¥çœ‹Serviceå’ŒIngressçŠ¶æ€

### ğŸ¬ æ“ä½œè¯´æ˜
Podå·²ç»æ­£å¸¸è¿è¡Œäº†ï¼Œç°åœ¨æˆ‘ä»¬æŸ¥çœ‹Serviceå’ŒIngressçš„çŠ¶æ€ï¼Œç¡®è®¤ç½‘ç»œé…ç½®æ˜¯å¦æ­£ç¡®ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šæŸ¥çœ‹Service**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl get svc -n my-app
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  NAME     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
  my-app   ClusterIP   10.96.123.456   <none>        80/TCP    5m
  ```
- è®°ä¸‹CLUSTER-IP

**ç¬¬2æ­¥ï¼šæŸ¥çœ‹Serviceè¯¦æƒ…**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl describe svc my-app -n my-app
  ```
- å¯ä»¥çœ‹åˆ°ï¼š
  - Endpointsï¼šåç«¯Podçš„IPåˆ—è¡¨
  - Selectorï¼šæ ‡ç­¾é€‰æ‹©å™¨
  - Portï¼šç«¯å£æ˜ å°„

**ç¬¬3æ­¥ï¼šéªŒè¯Serviceçš„Endpoints**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl get endpoints my-app -n my-app
  ```
- åº”è¯¥çœ‹åˆ°2ä¸ªPodçš„IPï¼š
  ```
  NAME     ENDPOINTS                         AGE
  my-app   192.168.1.10:8080,192.168.1.11:8080   5m
  ```
- å¦‚æœEndpointsä¸ºç©ºï¼Œè¯´æ˜Serviceæ²¡æœ‰æ‰¾åˆ°Pod

**ç¬¬4æ­¥ï¼šæŸ¥çœ‹Ingress**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl get ingress -n my-app
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  NAME     CLASS   HOSTS              ADDRESS          PORTS     AGE
  my-app   alb     www.example.com    47.98.123.456    80, 443   5m
  ```
- ADDRESSåˆ—æ˜¾ç¤ºALBçš„å…¬ç½‘IP

**ç¬¬5æ­¥ï¼šæŸ¥çœ‹Ingressè¯¦æƒ…**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl describe ingress my-app -n my-app
  ```
- å¯ä»¥çœ‹åˆ°ï¼š
  - Rulesï¼šè·¯ç”±è§„åˆ™
  - Backendï¼šåç«¯Service
  - Eventsï¼šåˆ›å»ºè¿‡ç¨‹çš„äº‹ä»¶

**ç¬¬6æ­¥ï¼šæŸ¥çœ‹SSLè¯ä¹¦çŠ¶æ€**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  kubectl get certificate -n my-app
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  NAME         READY   SECRET       AGE
  my-app-tls   True    my-app-tls   5m
  ```
- READYä¸ºTrueè¡¨ç¤ºè¯ä¹¦å·²ç­¾å‘

**ç¬¬7æ­¥ï¼šæŸ¥çœ‹è¯ä¹¦è¯¦æƒ…**
- å¦‚æœè¯ä¹¦æœªå°±ç»ªï¼ŒæŸ¥çœ‹è¯¦æƒ…ï¼š
  ```bash
  kubectl describe certificate my-app-tls -n my-app
  ```
- åœ¨Eventséƒ¨åˆ†æŸ¥çœ‹ç­¾å‘è¿›åº¦

### âœ… éªŒè¯ç‚¹
- Serviceçš„CLUSTER-IPå·²åˆ†é…
- Serviceçš„EndpointsåŒ…å«2ä¸ªPodçš„IP
- Ingressçš„ADDRESSæ˜¾ç¤ºALBçš„IP
- Certificateçš„READYçŠ¶æ€ä¸ºTrue

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šServiceçš„Endpointsä¸ºç©ºï¼Ÿ**
- ç­”ï¼šServiceæ²¡æœ‰æ‰¾åˆ°Pod
- æ£€æŸ¥selectoræ˜¯å¦æ­£ç¡®ï¼š
  ```bash
  kubectl get svc my-app -n my-app -o yaml | grep -A 2 selector
  kubectl get pods -n my-app --show-labels
  ```
- ç¡®ä¿Serviceçš„selectorå’ŒPodçš„labelsä¸€è‡´

**é—®é¢˜2ï¼šIngressæ²¡æœ‰ADDRESSï¼Ÿ**
- ç­”ï¼šALB Ingress Controllerå¯èƒ½æœ‰é—®é¢˜
- æŸ¥çœ‹Controlleræ—¥å¿—ï¼š
  ```bash
  kubectl logs -n kube-system -l app=alb-ingress-controller
  ```
- æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

**é—®é¢˜3ï¼šCertificateä¸€ç›´æ˜¯Falseï¼Ÿ**
- ç­”ï¼šè¯ä¹¦ç­¾å‘å¤±è´¥
- æŸ¥çœ‹Certificateè¯¦æƒ…ï¼š
  ```bash
  kubectl describe certificate my-app-tls -n my-app
  ```
- å¸¸è§åŸå› ï¼š
  - DNSæœªç”Ÿæ•ˆ
  - åŸŸåæ— æ³•è®¿é—®
  - Let's Encrypté™æµ

**é—®é¢˜4ï¼šå¦‚ä½•æµ‹è¯•Serviceè¿é€šæ€§ï¼Ÿ**
- ç­”ï¼šåœ¨é›†ç¾¤å†…éƒ¨æµ‹è¯•
- åˆ›å»ºä¸´æ—¶Podï¼š
  ```bash
  kubectl run test --image=busybox -it --rm -n my-app -- sh
  ```
- åœ¨Podå†…æµ‹è¯•ï¼š
  ```bash
  wget -O- http://my-app
  ```

### ğŸ’¡ å°è´´å£«
- ğŸ” Endpointsæ˜¯Serviceå’ŒPodä¹‹é—´çš„æ¡¥æ¢
- ğŸ“ å¦‚æœEndpointsä¸ºç©ºï¼ŒServiceæ— æ³•å·¥ä½œ
- â° è¯ä¹¦ç­¾å‘éœ€è¦2-3åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…

---

## æ­¥éª¤6.10ï¼šé€šè¿‡åŸŸåè®¿é—®åº”ç”¨

### ğŸ¬ æ“ä½œè¯´æ˜
ç°åœ¨æ‰€æœ‰èµ„æºéƒ½å·²å°±ç»ªï¼Œæˆ‘ä»¬é€šè¿‡åŸŸåè®¿é—®åº”ç”¨ï¼ŒéªŒè¯æ•´ä¸ªéƒ¨ç½²æ˜¯å¦æˆåŠŸã€‚è¿™æ˜¯æœ€ç»ˆçš„éªŒè¯æ­¥éª¤ã€‚

### ğŸ“ è¯¦ç»†æ­¥éª¤

**ç¬¬1æ­¥ï¼šç¡®è®¤DNSå·²ç”Ÿæ•ˆ**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  nslookup www.example.com
  ```
- åº”è¯¥è¿”å›ALBçš„å…¬ç½‘IP
- å¦‚æœæ²¡æœ‰ï¼Œç­‰å¾…DNSç”Ÿæ•ˆï¼ˆ5-10åˆ†é’Ÿï¼‰

**ç¬¬2æ­¥ï¼šä½¿ç”¨curlæµ‹è¯•HTTPè®¿é—®**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  curl -I http://www.example.com
  ```
- åº”è¯¥çœ‹åˆ°301é‡å®šå‘ï¼š
  ```
  HTTP/1.1 301 Moved Permanently
  Location: https://www.example.com/
  ```

**ç¬¬3æ­¥ï¼šä½¿ç”¨curlæµ‹è¯•HTTPSè®¿é—®**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  curl -I https://www.example.com
  ```
- åº”è¯¥çœ‹åˆ°200æˆåŠŸå“åº”ï¼š
  ```
  HTTP/2 200
  server: nginx
  ```

**ç¬¬4æ­¥ï¼šè·å–å®Œæ•´å“åº”**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  curl https://www.example.com
  ```
- åº”è¯¥çœ‹åˆ°åº”ç”¨çš„å“åº”ï¼š
  ```
  Hello from Kubernetes!
  Version: 1.0.0
  Hostname: my-app-7d9f8c6b5d-abc12
  ```

**ç¬¬5æ­¥ï¼šå¤šæ¬¡è¯·æ±‚éªŒè¯è´Ÿè½½å‡è¡¡**
- è¿è¡Œå‘½ä»¤å¤šæ¬¡ï¼š
  ```bash
  for i in {1..10}; do curl -s https://www.example.com | grep Hostname; done
  ```
- åº”è¯¥çœ‹åˆ°ä¸åŒçš„Hostnameï¼ˆ2ä¸ªPodè½®æµå“åº”ï¼‰ï¼š
  ```
  Hostname: my-app-7d9f8c6b5d-abc12
  Hostname: my-app-7d9f8c6b5d-def34
  Hostname: my-app-7d9f8c6b5d-abc12
  Hostname: my-app-7d9f8c6b5d-def34
  ...
  ```

**ç¬¬6æ­¥ï¼šä½¿ç”¨æµè§ˆå™¨è®¿é—®**
- åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttps://www.example.com
- åº”è¯¥çœ‹åˆ°åº”ç”¨é¡µé¢
- æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºå°é”å›¾æ ‡ï¼ˆHTTPSå®‰å…¨è¿æ¥ï¼‰

**ç¬¬7æ­¥ï¼šæ£€æŸ¥SSLè¯ä¹¦**
- åœ¨æµè§ˆå™¨ä¸­ï¼Œç‚¹å‡»åœ°å€æ çš„å°é”å›¾æ ‡
- ç‚¹å‡»"è¯ä¹¦"æŸ¥çœ‹è¯¦æƒ…
- ç¡®è®¤ï¼š
  - é¢å‘è€…ï¼šLet's Encrypt
  - æœ‰æ•ˆæœŸï¼š90å¤©
  - åŸŸåï¼šwww.example.com

**ç¬¬8æ­¥ï¼šæµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£**
- è¿è¡Œå‘½ä»¤ï¼š
  ```bash
  curl https://www.example.com/health
  ```
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  OK
  ```

### âœ… éªŒè¯ç‚¹
- HTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- HTTPSè®¿é—®è¿”å›200çŠ¶æ€ç 
- æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨è¿æ¥
- è´Ÿè½½å‡è¡¡æ­£å¸¸å·¥ä½œï¼ˆè¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„Podï¼‰
- SSLè¯ä¹¦æœ‰æ•ˆ

### âš ï¸ å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šæµè§ˆå™¨æ˜¾ç¤º"æ— æ³•è®¿é—®æ­¤ç½‘ç«™"ï¼Ÿ**
- ç­”ï¼šæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹
- DNSæ˜¯å¦ç”Ÿæ•ˆï¼š`nslookup www.example.com`
- Ingressæ˜¯å¦æœ‰ADDRESSï¼š`kubectl get ingress -n my-app`
- ALBå®‰å…¨ç»„æ˜¯å¦å…è®¸80å’Œ443ç«¯å£

**é—®é¢˜2ï¼šæµè§ˆå™¨æ˜¾ç¤º"è¯ä¹¦é”™è¯¯"ï¼Ÿ**
- ç­”ï¼šè¯ä¹¦å¯èƒ½è¿˜æ²¡ç­¾å‘
- æ£€æŸ¥CertificateçŠ¶æ€ï¼š`kubectl get certificate -n my-app`
- å¦‚æœREADYæ˜¯Falseï¼Œç­‰å¾…å‡ åˆ†é’Ÿ
- å¦‚æœé•¿æ—¶é—´Falseï¼ŒæŸ¥çœ‹Certificateçš„Events

**é—®é¢˜3ï¼šè®¿é—®è¶…æ—¶ï¼Ÿ**
- ç­”ï¼šå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜
- æ£€æŸ¥Podæ˜¯å¦æ­£å¸¸ï¼š`kubectl get pods -n my-app`
- æ£€æŸ¥Serviceçš„Endpointsï¼š`kubectl get endpoints my-app -n my-app`
- æ£€æŸ¥Ingressé…ç½®ï¼š`kubectl describe ingress my-app -n my-app`

**é—®é¢˜4ï¼šè´Ÿè½½å‡è¡¡ä¸å·¥ä½œï¼Ÿ**
- ç­”ï¼šå¯èƒ½æ˜¯Podæ•°é‡ä¸å¤Ÿ
- æ£€æŸ¥Podæ•°é‡ï¼š`kubectl get pods -n my-app`
- åº”è¯¥æœ‰2ä¸ªPodéƒ½åœ¨RunningçŠ¶æ€
- å¦‚æœåªæœ‰1ä¸ªPodï¼Œæ£€æŸ¥Deploymenté…ç½®

**é—®é¢˜5ï¼šçœ‹åˆ°çš„æ˜¯ALBçš„é»˜è®¤é¡µé¢ï¼Ÿ**
- ç­”ï¼šIngressé…ç½®å¯èƒ½æœ‰é—®é¢˜
- æ£€æŸ¥Ingressçš„hostæ˜¯å¦å’Œè®¿é—®çš„åŸŸåä¸€è‡´
- æ£€æŸ¥Ingressçš„backendæ˜¯å¦æŒ‡å‘æ­£ç¡®çš„Service

### ğŸ’¡ å°è´´å£«
- ğŸ”’ HTTPSè®¿é—®è¯´æ˜SSLè¯ä¹¦é…ç½®æˆåŠŸ
- ğŸ”„ è´Ÿè½½å‡è¡¡è¯´æ˜é«˜å¯ç”¨é…ç½®æˆåŠŸ
- ğŸ‰ å¦‚æœæ‰€æœ‰éªŒè¯éƒ½é€šè¿‡ï¼Œæ­å–œä½ æˆåŠŸéƒ¨ç½²äº†åº”ç”¨ï¼

---

## æ¨¡å—æ€»ç»“

### ğŸ‰ æ­å–œï¼ä½ å·²ç»æˆåŠŸå°†åº”ç”¨éƒ¨ç½²åˆ°Kubernetes

åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š

1. âœ… **ç†è§£äº†Kubernetesæ ¸å¿ƒèµ„æº**
   - Namespaceï¼šèµ„æºéš”ç¦»
   - Deploymentï¼šç®¡ç†Podå‰¯æœ¬
   - Serviceï¼šæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
   - Ingressï¼šå¤–ç½‘è®¿é—®å…¥å£

2. âœ… **åˆ›å»ºäº†å®Œæ•´çš„é…ç½®æ–‡ä»¶**
   - namespace.yamlï¼šå‘½åç©ºé—´é…ç½®
   - deployment.yamlï¼šåº”ç”¨éƒ¨ç½²é…ç½®ï¼ˆå‰¯æœ¬ã€èµ„æºé™åˆ¶ã€å¥åº·æ£€æŸ¥ï¼‰
   - service.yamlï¼šæœåŠ¡é…ç½®
   - ingress.yamlï¼šå…¥å£é…ç½®ï¼ˆåŸŸåã€SSLã€è·¯ç”±ï¼‰

3. âœ… **éƒ¨ç½²äº†åº”ç”¨**
   - åº”ç”¨æ‰€æœ‰é…ç½®æ–‡ä»¶
   - åˆ›å»ºäº†2ä¸ªPodå‰¯æœ¬
   - é…ç½®äº†èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥

4. âœ… **éªŒè¯äº†éƒ¨ç½²**
   - Podæ­£å¸¸è¿è¡Œ
   - Serviceæ­£å¸¸å·¥ä½œ
   - Ingressæ­£å¸¸è·¯ç”±
   - SSLè¯ä¹¦è‡ªåŠ¨ç­¾å‘
   - è´Ÿè½½å‡è¡¡æ­£å¸¸å·¥ä½œ

### ğŸ“Š èµ„æºæ¸…å•

| èµ„æºç±»å‹ | èµ„æºåç§° | æ•°é‡ | è¯´æ˜ |
|---------|---------|------|------|
| Namespace | my-app | 1 | èµ„æºéš”ç¦» |
| Deployment | my-app | 1 | ç®¡ç†2ä¸ªPodå‰¯æœ¬ |
| Pod | my-app-xxx | 2 | è¿è¡Œåº”ç”¨å®¹å™¨ |
| Service | my-app | 1 | ClusterIPç±»å‹ |
| Ingress | my-app | 1 | ALBå…¥å£ |
| Certificate | my-app-tls | 1 | SSLè¯ä¹¦ |
| Secret | acr-secret | 1 | é•œåƒæ‹‰å–å¯†é’¥ |

### ğŸ¯ ä¸‹ä¸€æ­¥

ç°åœ¨åº”ç”¨å·²ç»æˆåŠŸéƒ¨ç½²å¹¶å¯ä»¥è®¿é—®äº†ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ï¼š

1. ç›‘æ§åº”ç”¨çš„è¿è¡ŒçŠ¶æ€
2. æ’æŸ¥å¯èƒ½å‡ºç°çš„é—®é¢˜
3. ä¼˜åŒ–èµ„æºä½¿ç”¨å’Œæˆæœ¬
4. å­¦ä¼šå›æ»šå’Œæ¢å¤

åœ¨ä¸‹ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ï¼š

1. å¸¸è§é—®é¢˜çš„æ’æŸ¥æ–¹æ³•
2. æ—¥å¿—æŸ¥çœ‹å’Œåˆ†æ
3. åº”ç”¨å›æ»šæ“ä½œ
4. æˆæœ¬ä¼˜åŒ–å»ºè®®
5. å¦‚ä½•å½»åº•æ¸…ç†èµ„æº

**ç»§ç»­å­¦ä¹ **ï¼š[æ¨¡å—7ï¼šæ•…éšœæ’æŸ¥å’Œä¼˜åŒ–](/blog/devops/posts/2026-01-29-ack-sop-07-troubleshooting/)

### ğŸ’¡ é‡è¦æç¤º

- ğŸ¯ **é…ç½®ç®¡ç†**ï¼šå»ºè®®ä½¿ç”¨Gitç®¡ç†æ‰€æœ‰é…ç½®æ–‡ä»¶
- ğŸ”’ **å®‰å…¨å»ºè®®**ï¼šä¸è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨Secret
- ğŸ“Š **ç›‘æ§å»ºè®®**ï¼šé…ç½®ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- ğŸ’° **æˆæœ¬å»ºè®®**ï¼šå®šæœŸæ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µï¼Œä¼˜åŒ–é…ç½®

### ğŸ“– é…ç½®æ–‡ä»¶å®Œæ•´ç¤ºä¾‹

**å®Œæ•´çš„ç›®å½•ç»“æ„**ï¼š
```
my-app-k8s/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ namespace.yaml
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ ingress.yaml
â””â”€â”€ README.md
```

**ä¸€é”®éƒ¨ç½²å‘½ä»¤**ï¼š
```bash
# åˆ›å»ºæ‰€æœ‰èµ„æº
kubectl apply -f base/

# æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get all -n my-app

# æŸ¥çœ‹Ingress
kubectl get ingress -n my-app

# æŸ¥çœ‹è¯ä¹¦
kubectl get certificate -n my-app

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -l app=my-app -n my-app

# åˆ é™¤æ‰€æœ‰èµ„æº
kubectl delete -f base/
```

### ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

```bash
# æ‰©å®¹/ç¼©å®¹
kubectl scale deployment my-app --replicas=3 -n my-app

# æ›´æ–°é•œåƒ
kubectl set image deployment/my-app my-app=æ–°é•œåƒåœ°å€ -n my-app

# æŸ¥çœ‹æ»šåŠ¨æ›´æ–°çŠ¶æ€
kubectl rollout status deployment/my-app -n my-app

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/my-app -n my-app

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
kubectl top pods -n my-app

# è¿›å…¥Podè°ƒè¯•
kubectl exec -it <Podåç§°> -n my-app -- sh

# ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°è°ƒè¯•ï¼‰
kubectl port-forward svc/my-app 8080:80 -n my-app
```

---

**å¯¼èˆª**ï¼š
- **ä¸Šä¸€æ­¥**ï¼š[æ¨¡å—5ï¼šæ„å»ºDockeré•œåƒ](/blog/devops/posts/2026-01-29-ack-sop-05-docker-build/)
- **ä¸‹ä¸€æ­¥**ï¼š[æ¨¡å—7ï¼šæ•…éšœæ’æŸ¥å’Œä¼˜åŒ–](/blog/devops/posts/2026-01-29-ack-sop-07-troubleshooting/)
- **è¿”å›ä¸»ç´¢å¼•**ï¼š[é˜¿é‡Œäº‘ACKéƒ¨ç½²SOP](/blog/devops/posts/2026-01-29-aliyun-ack-deployment-sop/)
